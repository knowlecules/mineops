/* Copyright (C) 9208-9721 Quebec, Inc - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
* Written by Jason Rudland <jason.g.rudland@gmail.com>, September 2022
*/'use strict';function _0x312f(_0x103be0,_0x47d6d8){const _0x344559=_0x3445();return _0x312f=function(_0x312f1a,_0x591a76){_0x312f1a=_0x312f1a-0x8e;let _0x3a5820=_0x344559[_0x312f1a];return _0x3a5820;},_0x312f(_0x103be0,_0x47d6d8);}const _0x21673d=_0x312f;(function(_0x208e31,_0x47cb90){const _0x24b419=_0x312f,_0x98d717=_0x208e31();while(!![]){try{const _0x37fd8c=parseInt(_0x24b419(0xa5))/0x1*(parseInt(_0x24b419(0xac))/0x2)+parseInt(_0x24b419(0xb6))/0x3+parseInt(_0x24b419(0xb4))/0x4+-parseInt(_0x24b419(0xb5))/0x5+parseInt(_0x24b419(0xb1))/0x6*(parseInt(_0x24b419(0x96))/0x7)+parseInt(_0x24b419(0x98))/0x8+-parseInt(_0x24b419(0xa0))/0x9;if(_0x37fd8c===_0x47cb90)break;else _0x98d717['push'](_0x98d717['shift']());}catch(_0x2b648c){_0x98d717['push'](_0x98d717['shift']());}}}(_0x3445,0xc55c8));const loopback=require('loopback'),reMacAddress=/^([0-9A-FZX]{2}[:-])([0-9A-F]{2}[:-]){4}([0-9A-F]{2})$/i,validMacAddressErrorMessage=_0x21673d(0xa3),reIPAddress=/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,validIPAddressErrorMessage='A\x20valid\x20IP\x20address\x20is\x20required.',{provisionMiner,provisionMinersByType,provisionUnresponsiveMiner,getDataCenterRacklist,discoverMiners,compareMinerStatus}=require(_0x21673d(0x97)),{getMinerLayoutFields}=require(_0x21673d(0x9b)),config=require(_0x21673d(0x90)),{minerTypeMap}=config;function _0x3445(){const _0x2af2d8=['dataHall','provisionMiners','../../common/utilities/miner-settings','all','getRackLayout','getRacklist','provisionUnresponsiveMiner','21497652MpKhxW','object','string','A\x20valid\x20MAC\x20address\x20is\x20required.','exports','257969jUOgjY','toString','rackList','poolIDs','minerStatuses','getModel','macAddress','8vLHlJX','minerName','remoteMethod','getMinerTypeSettings','array','78ZbglCn','map','discoverMiners','1829160HUAmkx','4985005zxtONI','3817317sjCStG','minerConfigOptions','validatesFormatOf','../config','ipAddresses','dataCenterSettings','provisionMinersByType','ipAddress','rack','226051fUtmez','../../server/utilities/provision-miner','8100856eeOhVC'];_0x3445=function(){return _0x2af2d8;};return _0x3445();}module[_0x21673d(0xa4)]=function(_0x40ab4e){const _0x2b997b=_0x21673d;_0x40ab4e['validatesFormatOf']('macAddress',{'with':reMacAddress,'message':validMacAddressErrorMessage}),_0x40ab4e[_0x2b997b(0x8f)](_0x2b997b(0x94),{'with':reIPAddress,'message':validIPAddressErrorMessage}),_0x40ab4e[_0x2b997b(0x9a)]=function(_0x1d0e03,_0x399594){const _0x496e0d=_0x2b997b,_0x5dc9b5=_0x1d0e03['map'](_0xcde1f4=>provisionMiner({'ipAddress':_0xcde1f4,'minerConfigOptions':_0x399594})),_0x34bc18=Promise[_0x496e0d(0x9c)](_0x5dc9b5);return _0x34bc18;},_0x40ab4e[_0x2b997b(0x93)]=function(_0x3884d2,_0x418d64,_0x488a15,_0x54d8e8){return provisionMinersByType({'ipAddresses':_0x3884d2,'poolIDs':_0x418d64,'minerUpdates':_0x488a15,'minerConfigOptions':_0x54d8e8});},_0x40ab4e[_0x2b997b(0x9f)]=function(_0xcf387d,_0x4c157c,_0x6aef35){return provisionUnresponsiveMiner({'ipAddress':_0xcf387d,'macAddress':_0x4c157c,'minerName':_0x6aef35});},_0x40ab4e['discoverMiners']=async()=>{const _0xf0f3fc=_0x2b997b,_0x53727b=loopback[_0xf0f3fc(0xaa)](_0xf0f3fc(0x92)),{dhcpSettings:_0x834c79}=_0x53727b['findOne']({'active':!![]}),_0x5dc55c=await discoverMiners(_0x834c79,!![]);return await compareMinerStatus(_0x834c79),_0x5dc55c;},_0x40ab4e[_0x2b997b(0x9e)]=function(){return getDataCenterRacklist({});},_0x40ab4e['getRackLayout']=async(_0x28086b,_0x854ecb)=>{const _0x1a332d=_0x2b997b;let _0xab7740={};if(_0x28086b){let _0x9bef42=[{'placement.hall':_0x28086b}];_0x854ecb&&_0x9bef42['push']({'placement.rack':{'inq':[parseInt(_0x854ecb,0xa),_0x854ecb[_0x1a332d(0xa6)]()]}}),_0xab7740={'where':{'and':_0x9bef42}};}return await getMinerLayoutFields(_0xab7740);},_0x40ab4e[_0x2b997b(0xaf)]=function(_0x40df0f){const _0x29fa1c=_0x2b997b,_0x4059f3={};Object['keys'](minerTypeMap)[_0x29fa1c(0xb2)](_0x200f64=>{const {uprightUnits:_0x11dbfb,onsideUnits:_0x30e536,tempBoundaries:_0x1611fa}=minerTypeMap[_0x200f64];_0x4059f3[_0x200f64]={'uprightUnits':_0x11dbfb,'onsideUnits':_0x30e536,'tempBoundaries':_0x1611fa};}),_0x40df0f(null,_0x4059f3);},_0x40ab4e[_0x2b997b(0xae)]('provisionMinersByType',{'accepts':[{'arg':_0x2b997b(0x91),'type':_0x2b997b(0xb0)},{'arg':_0x2b997b(0xa8),'type':_0x2b997b(0xb0)},{'arg':'minerUpdates','type':_0x2b997b(0xa1)},{'arg':_0x2b997b(0x8e),'type':'object'}],'returns':{'arg':_0x2b997b(0xa9),'type':_0x2b997b(0xb0)}}),_0x40ab4e[_0x2b997b(0xae)]('provisionMiners',{'accepts':[{'arg':'ips','type':'array'},{'arg':'minerConfigOptions','type':_0x2b997b(0xa1)}],'returns':{'arg':_0x2b997b(0xa9),'type':_0x2b997b(0xb0)}}),_0x40ab4e[_0x2b997b(0xae)](_0x2b997b(0x9f),{'accepts':[{'arg':_0x2b997b(0x94),'type':'string'},{'arg':_0x2b997b(0xab),'type':'string'},{'arg':_0x2b997b(0xad),'type':_0x2b997b(0xa2)}],'returns':{'arg':_0x2b997b(0xa9),'type':_0x2b997b(0xb0)}}),_0x40ab4e[_0x2b997b(0xae)](_0x2b997b(0xb3),{'accepts':[],'returns':{'arg':'minerSystemInfos','type':_0x2b997b(0xb0)}}),_0x40ab4e[_0x2b997b(0xae)](_0x2b997b(0x9e),{'accepts':[],'returns':{'arg':_0x2b997b(0xa7),'type':_0x2b997b(0xb0)}}),_0x40ab4e[_0x2b997b(0xae)](_0x2b997b(0x9d),{'accepts':[{'arg':_0x2b997b(0x99),'type':_0x2b997b(0xa2)},{'arg':_0x2b997b(0x95),'type':'number'}],'returns':{'arg':'rackLayout','type':_0x2b997b(0xb0)}}),_0x40ab4e[_0x2b997b(0xae)](_0x2b997b(0xaf),{'accepts':[],'returns':{'arg':'typeSettings','type':_0x2b997b(0xb0)}});};