/* Copyright (C) 9208-9721 Quebec, Inc - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
* Written by Jason Rudland <jason.g.rudland@gmail.com>, September 2022
*/'use strict';function _0x5611(){const _0x1b4329=['1744688DYVwYs','provisionUnresponsiveMiner','discoverMiners','A\x20valid\x20IP\x20address\x20is\x20required.','exports','provisionMiners','toString','1111056pppZWE','validatesFormatOf','ipAddress','89645JpmCYR','minerConfigOptions','getRacklist','remoteMethod','8zNmBWd','map','dataHall','5UWjoIG','provisionMinersByType','getRackLayout','ipAddresses','all','minerName','loopback','minerStatuses','../../server/utilities/provision-miner','2147772amtkhM','string','getMinerTypeSettings','1431829ISwrzG','rackLayout','dataCenterSettings','minerSystemInfos','findOne','push','../../common/utilities/miner-settings','array','number','ips','typeSettings','object','macAddress','1745046PLMvse','51422PSXXRw'];_0x5611=function(){return _0x1b4329;};return _0x5611();}const _0x1d09dd=_0x33c0;(function(_0x8884c4,_0x5500bf){const _0x3149b6=_0x33c0,_0x59c876=_0x8884c4();while(!![]){try{const _0xcb4224=parseInt(_0x3149b6(0x1f8))/0x1*(-parseInt(_0x3149b6(0x1e6))/0x2)+-parseInt(_0x3149b6(0x1ee))/0x3+parseInt(_0x3149b6(0x1e7))/0x4+-parseInt(_0x3149b6(0x1f1))/0x5+parseInt(_0x3149b6(0x201))/0x6+parseInt(_0x3149b6(0x204))/0x7*(-parseInt(_0x3149b6(0x1f5))/0x8)+parseInt(_0x3149b6(0x1e5))/0x9;if(_0xcb4224===_0x5500bf)break;else _0x59c876['push'](_0x59c876['shift']());}catch(_0x443086){_0x59c876['push'](_0x59c876['shift']());}}}(_0x5611,0x41195));function _0x33c0(_0x1ded34,_0x133460){const _0x56119d=_0x5611();return _0x33c0=function(_0x33c034,_0x5ec3a9){_0x33c034=_0x33c034-0x1d9;let _0xa5bd68=_0x56119d[_0x33c034];return _0xa5bd68;},_0x33c0(_0x1ded34,_0x133460);}const loopback=require(_0x1d09dd(0x1fe)),reMacAddress=/^([0-9A-FZX]{2}[:-])([0-9A-F]{2}[:-]){4}([0-9A-F]{2})$/i,validMacAddressErrorMessage='A\x20valid\x20MAC\x20address\x20is\x20required.',reIPAddress=/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,validIPAddressErrorMessage=_0x1d09dd(0x1ea),{provisionMiner,provisionMinersByType,provisionUnresponsiveMiner,getDataCenterRacklist,discoverMiners,compareMinerStatus}=require(_0x1d09dd(0x200)),{getMinerLayoutFields}=require(_0x1d09dd(0x1de)),config=require('../config'),{minerTypeMap}=config;module[_0x1d09dd(0x1eb)]=function(_0x532f05){const _0x15d472=_0x1d09dd;_0x532f05['validatesFormatOf'](_0x15d472(0x1e4),{'with':reMacAddress,'message':validMacAddressErrorMessage}),_0x532f05[_0x15d472(0x1ef)](_0x15d472(0x1f0),{'with':reIPAddress,'message':validIPAddressErrorMessage}),_0x532f05[_0x15d472(0x1ec)]=function(_0x1ee7b7,_0x280b46){const _0x56333c=_0x15d472,_0xdd6899=_0x1ee7b7[_0x56333c(0x1f6)](_0x4d07b4=>provisionMiner({'ipAddress':_0x4d07b4,'minerConfigOptions':_0x280b46})),_0x45cbe1=Promise[_0x56333c(0x1fc)](_0xdd6899);return _0x45cbe1;},_0x532f05[_0x15d472(0x1f9)]=function(_0x1e9a63,_0x2cc364,_0x4a1589,_0x38b57d){return provisionMinersByType({'ipAddresses':_0x1e9a63,'poolIDs':_0x2cc364,'minerUpdates':_0x4a1589,'minerConfigOptions':_0x38b57d});},_0x532f05[_0x15d472(0x1e8)]=function(_0x52c6ce,_0x4af4f7,_0x10828f){return provisionUnresponsiveMiner({'ipAddress':_0x52c6ce,'macAddress':_0x4af4f7,'minerName':_0x10828f});},_0x532f05['discoverMiners']=async()=>{const _0x13cdf9=_0x15d472,_0x75bdf7=loopback['getModel'](_0x13cdf9(0x1da)),{dhcpSettings:_0x43ad59}=_0x75bdf7[_0x13cdf9(0x1dc)]({'active':!![]}),_0x30f0d5=await discoverMiners(_0x43ad59,!![]);return await compareMinerStatus(_0x43ad59),_0x30f0d5;},_0x532f05[_0x15d472(0x1f3)]=function(){return getDataCenterRacklist({});},_0x532f05[_0x15d472(0x1fa)]=async(_0x348f10,_0x29349a)=>{const _0x1c5bdd=_0x15d472;let _0x1fba77={};if(_0x348f10){let _0x94a8bd=[{'placement.hall':_0x348f10}];_0x29349a&&_0x94a8bd[_0x1c5bdd(0x1dd)]({'placement.rack':{'inq':[parseInt(_0x29349a,0xa),_0x29349a[_0x1c5bdd(0x1ed)]()]}}),_0x1fba77={'where':{'and':_0x94a8bd}};}return await getMinerLayoutFields(_0x1fba77);},_0x532f05[_0x15d472(0x203)]=function(_0x87d6ec){const _0x2c4d3c=_0x15d472,_0x50962c={};Object['keys'](minerTypeMap)[_0x2c4d3c(0x1f6)](_0x300168=>{const {uprightUnits:_0x457a85,onsideUnits:_0x137025,tempBoundaries:_0xecd9bf}=minerTypeMap[_0x300168];_0x50962c[_0x300168]={'uprightUnits':_0x457a85,'onsideUnits':_0x137025,'tempBoundaries':_0xecd9bf};}),_0x87d6ec(null,_0x50962c);},_0x532f05[_0x15d472(0x1f4)]('provisionMinersByType',{'accepts':[{'arg':_0x15d472(0x1fb),'type':_0x15d472(0x1df)},{'arg':'poolIDs','type':'array'},{'arg':'minerUpdates','type':_0x15d472(0x1e3)},{'arg':_0x15d472(0x1f2),'type':'object'}],'returns':{'arg':_0x15d472(0x1ff),'type':_0x15d472(0x1df)}}),_0x532f05['remoteMethod'](_0x15d472(0x1ec),{'accepts':[{'arg':_0x15d472(0x1e1),'type':_0x15d472(0x1df)},{'arg':_0x15d472(0x1f2),'type':'object'}],'returns':{'arg':_0x15d472(0x1ff),'type':_0x15d472(0x1df)}}),_0x532f05['remoteMethod'](_0x15d472(0x1e8),{'accepts':[{'arg':_0x15d472(0x1f0),'type':_0x15d472(0x202)},{'arg':'macAddress','type':_0x15d472(0x202)},{'arg':_0x15d472(0x1fd),'type':_0x15d472(0x202)}],'returns':{'arg':'minerStatuses','type':_0x15d472(0x1df)}}),_0x532f05['remoteMethod'](_0x15d472(0x1e9),{'accepts':[],'returns':{'arg':_0x15d472(0x1db),'type':_0x15d472(0x1df)}}),_0x532f05['remoteMethod']('getRacklist',{'accepts':[],'returns':{'arg':'rackList','type':_0x15d472(0x1df)}}),_0x532f05['remoteMethod'](_0x15d472(0x1fa),{'accepts':[{'arg':_0x15d472(0x1f7),'type':_0x15d472(0x202)},{'arg':'rack','type':_0x15d472(0x1e0)}],'returns':{'arg':_0x15d472(0x1d9),'type':_0x15d472(0x1df)}}),_0x532f05[_0x15d472(0x1f4)](_0x15d472(0x203),{'accepts':[],'returns':{'arg':_0x15d472(0x1e2),'type':'array'}});};