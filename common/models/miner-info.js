/* Copyright (C) 9208-9721 Quebec, Inc - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
* Written by Jason Rudland <jason.g.rudland@gmail.com>, September 2022
*/'use strict';const _0x2df91d=_0x2eb1;function _0x421c(){const _0xe1de94=['dataCenterSettings','typeSettings','rackList','A\x20valid\x20MAC\x20address\x20is\x20required.','array','dataHall','1638673tMViST','minerSystemInfos','getRackLayout','8iksJVE','63McgrqQ','exports','3969288AmZfBN','22XRhFTI','47656140uVTbkZ','ipAddresses','8783690wlpvBX','1009698ylOQzW','minerName','../config','findOne','string','ipAddress','object','3641732cQewzV','getMinerTypeSettings','number','macAddress','10rLUpWg','27UOOrhO','all','../../server/utilities/provision-miner','keys','provisionUnresponsiveMiner','loopback','getModel','ips','validatesFormatOf','provisionMiners','remoteMethod','provisionMinersByType','poolIDs','map','../../common/utilities/miner-settings','minerStatuses','getRacklist','770598OSPwfL','minerConfigOptions'];_0x421c=function(){return _0xe1de94;};return _0x421c();}(function(_0xf8593a,_0x29cca6){const _0x55c922=_0x2eb1,_0x1c00c4=_0xf8593a();while(!![]){try{const _0x244fbe=-parseInt(_0x55c922(0x9a))/0x1+-parseInt(_0x55c922(0x9d))/0x2*(-parseInt(_0x55c922(0xa5))/0x3)+-parseInt(_0x55c922(0xac))/0x4*(parseInt(_0x55c922(0x80))/0x5)+-parseInt(_0x55c922(0x92))/0x6*(parseInt(_0x55c922(0x9e))/0x7)+parseInt(_0x55c922(0xa0))/0x8*(-parseInt(_0x55c922(0x81))/0x9)+parseInt(_0x55c922(0xa4))/0xa*(parseInt(_0x55c922(0xa1))/0xb)+parseInt(_0x55c922(0xa2))/0xc;if(_0x244fbe===_0x29cca6)break;else _0x1c00c4['push'](_0x1c00c4['shift']());}catch(_0x5324d1){_0x1c00c4['push'](_0x1c00c4['shift']());}}}(_0x421c,0xecebc));function _0x2eb1(_0x1149e7,_0x58a471){const _0x421c0c=_0x421c();return _0x2eb1=function(_0x2eb137,_0x9f2769){_0x2eb137=_0x2eb137-0x7f;let _0x281a8b=_0x421c0c[_0x2eb137];return _0x281a8b;},_0x2eb1(_0x1149e7,_0x58a471);}const loopback=require(_0x2df91d(0x86)),reMacAddress=/^([0-9A-FZX]{2}[:-])([0-9A-F]{2}[:-]){4}([0-9A-F]{2})$/i,validMacAddressErrorMessage=_0x2df91d(0x97),reIPAddress=/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,validIPAddressErrorMessage='A\x20valid\x20IP\x20address\x20is\x20required.',{provisionMiner,provisionMinersByType,provisionUnresponsiveMiner,getDataCenterRacklist,discoverMiners,compareMinerStatus}=require(_0x2df91d(0x83)),{getMinerLayoutFields}=require(_0x2df91d(0x8f)),config=require(_0x2df91d(0xa7)),{minerTypeMap}=config;module[_0x2df91d(0x9f)]=function(_0x3f89ab){const _0x1c237b=_0x2df91d;_0x3f89ab[_0x1c237b(0x89)]('macAddress',{'with':reMacAddress,'message':validMacAddressErrorMessage}),_0x3f89ab[_0x1c237b(0x89)](_0x1c237b(0xaa),{'with':reIPAddress,'message':validIPAddressErrorMessage}),_0x3f89ab[_0x1c237b(0x8a)]=function(_0x472f40,_0x5e5051){const _0x485451=_0x1c237b,_0x333d37=_0x472f40[_0x485451(0x8e)](_0x585ef7=>provisionMiner({'ipAddress':_0x585ef7,'minerConfigOptions':_0x5e5051})),_0x4e2e8b=Promise[_0x485451(0x82)](_0x333d37);return _0x4e2e8b;},_0x3f89ab[_0x1c237b(0x8c)]=function(_0x4a7791,_0x7b05ee,_0x146974,_0x3e37c7){return provisionMinersByType({'ipAddresses':_0x4a7791,'poolIDs':_0x7b05ee,'minerUpdates':_0x146974,'minerConfigOptions':_0x3e37c7});},_0x3f89ab[_0x1c237b(0x85)]=function(_0x140401,_0x449e90,_0x437890){return provisionUnresponsiveMiner({'ipAddress':_0x140401,'macAddress':_0x449e90,'minerName':_0x437890});},_0x3f89ab['discoverMiners']=async()=>{const _0x9867a9=_0x1c237b,_0x3402f0=loopback[_0x9867a9(0x87)](_0x9867a9(0x94)),{dhcpSettings:_0x458f9a}=_0x3402f0[_0x9867a9(0xa8)]({'active':!![]}),_0x2c0d99=await discoverMiners(_0x458f9a,!![]);return await compareMinerStatus(_0x458f9a),_0x2c0d99;},_0x3f89ab[_0x1c237b(0x91)]=function(){return getDataCenterRacklist({});},_0x3f89ab[_0x1c237b(0x9c)]=async(_0x47a20d,_0x3b4c67)=>{let _0x36701b={};if(_0x47a20d){let _0x1a19be=[{'placement.hall':_0x47a20d}];_0x3b4c67&&_0x1a19be['push']({'placement.rack':{'inq':[parseInt(_0x3b4c67,0xa),_0x3b4c67['toString']()]}}),_0x36701b={'where':{'and':_0x1a19be}};}return await getMinerLayoutFields(_0x36701b);},_0x3f89ab[_0x1c237b(0xad)]=function(_0x3f29a8){const _0xfb1e28=_0x1c237b,_0xce0b92={};Object[_0xfb1e28(0x84)](minerTypeMap)[_0xfb1e28(0x8e)](_0x5d198c=>{const {uprightUnits:_0x5547a5,onsideUnits:_0x4a375d,tempBoundaries:_0x35c435}=minerTypeMap[_0x5d198c];_0xce0b92[_0x5d198c]={'uprightUnits':_0x5547a5,'onsideUnits':_0x4a375d,'tempBoundaries':_0x35c435};}),_0x3f29a8(null,_0xce0b92);},_0x3f89ab['remoteMethod'](_0x1c237b(0x8c),{'accepts':[{'arg':_0x1c237b(0xa3),'type':'array'},{'arg':_0x1c237b(0x8d),'type':_0x1c237b(0x98)},{'arg':'minerUpdates','type':'object'},{'arg':_0x1c237b(0x93),'type':_0x1c237b(0xab)}],'returns':{'arg':_0x1c237b(0x90),'type':_0x1c237b(0x98)}}),_0x3f89ab[_0x1c237b(0x8b)](_0x1c237b(0x8a),{'accepts':[{'arg':_0x1c237b(0x88),'type':'array'},{'arg':_0x1c237b(0x93),'type':_0x1c237b(0xab)}],'returns':{'arg':_0x1c237b(0x90),'type':_0x1c237b(0x98)}}),_0x3f89ab['remoteMethod'](_0x1c237b(0x85),{'accepts':[{'arg':_0x1c237b(0xaa),'type':_0x1c237b(0xa9)},{'arg':_0x1c237b(0x7f),'type':'string'},{'arg':_0x1c237b(0xa6),'type':_0x1c237b(0xa9)}],'returns':{'arg':_0x1c237b(0x90),'type':_0x1c237b(0x98)}}),_0x3f89ab[_0x1c237b(0x8b)]('discoverMiners',{'accepts':[],'returns':{'arg':_0x1c237b(0x9b),'type':_0x1c237b(0x98)}}),_0x3f89ab[_0x1c237b(0x8b)](_0x1c237b(0x91),{'accepts':[],'returns':{'arg':_0x1c237b(0x96),'type':_0x1c237b(0x98)}}),_0x3f89ab['remoteMethod'](_0x1c237b(0x9c),{'accepts':[{'arg':_0x1c237b(0x99),'type':_0x1c237b(0xa9)},{'arg':'rack','type':_0x1c237b(0xae)}],'returns':{'arg':'rackLayout','type':_0x1c237b(0x98)}}),_0x3f89ab[_0x1c237b(0x8b)](_0x1c237b(0xad),{'accepts':[],'returns':{'arg':_0x1c237b(0x95),'type':'array'}});};