/* Copyright (C) 9208-9721 Quebec, Inc - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
* Written by Jason Rudland <jason.g.rudland@gmail.com>, September 2022
*/'use strict';const _0x5172cf=_0x185d;(function(_0x861a57,_0x2e3681){const _0xab7fdd=_0x185d,_0x161da2=_0x861a57();while(!![]){try{const _0x3fc268=parseInt(_0xab7fdd(0x88))/0x1*(parseInt(_0xab7fdd(0x86))/0x2)+parseInt(_0xab7fdd(0x97))/0x3+-parseInt(_0xab7fdd(0x8d))/0x4*(-parseInt(_0xab7fdd(0x84))/0x5)+parseInt(_0xab7fdd(0x7f))/0x6+-parseInt(_0xab7fdd(0xa4))/0x7+-parseInt(_0xab7fdd(0x91))/0x8+-parseInt(_0xab7fdd(0x9a))/0x9;if(_0x3fc268===_0x2e3681)break;else _0x161da2['push'](_0x161da2['shift']());}catch(_0x471a7c){_0x161da2['push'](_0x161da2['shift']());}}}(_0x5c9f,0x65e92));function _0x185d(_0x2f6f1d,_0x158aa4){const _0x5c9f16=_0x5c9f();return _0x185d=function(_0x185d49,_0x541574){_0x185d49=_0x185d49-0x79;let _0x1aa750=_0x5c9f16[_0x185d49];return _0x1aa750;},_0x185d(_0x2f6f1d,_0x158aa4);}const loopback=require(_0x5172cf(0x7d)),reMacAddress=/^([0-9A-FZX]{2}[:-])([0-9A-F]{2}[:-]){4}([0-9A-F]{2})$/i,validMacAddressErrorMessage=_0x5172cf(0x82),reIPAddress=/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,validIPAddressErrorMessage='A\x20valid\x20IP\x20address\x20is\x20required.',{provisionMiner,provisionMinersByType,provisionUnresponsiveMiner,getDataCenterRacklist,discoverMiners,compareMinerStatus}=require(_0x5172cf(0x8c)),{getMinerLayoutFields}=require('../../common/utilities/miner-settings'),config=require(_0x5172cf(0x90)),{minerTypeMap}=config;function _0x5c9f(){const _0x5bc5d8=['push','4006890ahkxQt','getRackLayout','keys','rackList','getMinerTypeSettings','object','map','minerUpdates','minerSystemInfos','poolIDs','3481275lcrVIa','exports','toString','macAddress','ips','provisionUnresponsiveMiner','validatesFormatOf','minerConfigOptions','loopback','array','1302864yfprJo','minerName','provisionMinersByType','A\x20valid\x20MAC\x20address\x20is\x20required.','all','5sXxXFV','findOne','802WrvhVz','number','1690kbEQVr','typeSettings','rackLayout','remoteMethod','../../server/utilities/provision-miner','2212060ONVnRQ','minerStatuses','discoverMiners','../config','3651024aiDkzs','ipAddress','string','ipAddresses','provisionMiners','dataCenterSettings','1105470fdIUXA','rack'];_0x5c9f=function(){return _0x5bc5d8;};return _0x5c9f();}module[_0x5172cf(0xa5)]=function(_0x95600f){const _0x209895=_0x5172cf;_0x95600f[_0x209895(0x7b)](_0x209895(0xa7),{'with':reMacAddress,'message':validMacAddressErrorMessage}),_0x95600f['validatesFormatOf'](_0x209895(0x92),{'with':reIPAddress,'message':validIPAddressErrorMessage}),_0x95600f['provisionMiners']=function(_0x23a959,_0x515406){const _0x19fcf1=_0x209895,_0x473644=_0x23a959['map'](_0x3249ed=>provisionMiner({'ipAddress':_0x3249ed,'minerConfigOptions':_0x515406})),_0xe507d8=Promise[_0x19fcf1(0x83)](_0x473644);return _0xe507d8;},_0x95600f[_0x209895(0x81)]=function(_0x891144,_0x4c7f69,_0x288819,_0x35aaf2){return provisionMinersByType({'ipAddresses':_0x891144,'poolIDs':_0x4c7f69,'minerUpdates':_0x288819,'minerConfigOptions':_0x35aaf2});},_0x95600f[_0x209895(0x7a)]=function(_0x555f45,_0x137cba,_0x2bd27a){return provisionUnresponsiveMiner({'ipAddress':_0x555f45,'macAddress':_0x137cba,'minerName':_0x2bd27a});},_0x95600f[_0x209895(0x8f)]=async()=>{const _0x391bf7=_0x209895,_0xbd841b=loopback['getModel'](_0x391bf7(0x96)),{dhcpSettings:_0x1c11f7}=_0xbd841b[_0x391bf7(0x85)]({'active':!![]}),_0x2c6c8e=await discoverMiners(_0x1c11f7,!![]);return await compareMinerStatus(_0x1c11f7),_0x2c6c8e;},_0x95600f['getRacklist']=function(){return getDataCenterRacklist({});},_0x95600f[_0x209895(0x9b)]=async(_0x428318,_0x38c1af)=>{const _0x536a89=_0x209895;let _0x31b714={};if(_0x428318){let _0x42110a=[{'placement.hall':_0x428318}];_0x38c1af&&_0x42110a[_0x536a89(0x99)]({'placement.rack':{'inq':[parseInt(_0x38c1af,0xa),_0x38c1af[_0x536a89(0xa6)]()]}}),_0x31b714={'where':{'and':_0x42110a}};}return await getMinerLayoutFields(_0x31b714);},_0x95600f[_0x209895(0x9e)]=function(_0x587ec2){const _0x30c74a=_0x209895,_0x514271={};Object[_0x30c74a(0x9c)](minerTypeMap)[_0x30c74a(0xa0)](_0xa04cb9=>{const {uprightUnits:_0x2506e5,onsideUnits:_0x33e38e,tempBoundaries:_0xbe08c3}=minerTypeMap[_0xa04cb9];_0x514271[_0xa04cb9]={'uprightUnits':_0x2506e5,'onsideUnits':_0x33e38e,'tempBoundaries':_0xbe08c3};}),_0x587ec2(null,_0x514271);},_0x95600f['remoteMethod'](_0x209895(0x81),{'accepts':[{'arg':_0x209895(0x94),'type':_0x209895(0x7e)},{'arg':_0x209895(0xa3),'type':_0x209895(0x7e)},{'arg':_0x209895(0xa1),'type':_0x209895(0x9f)},{'arg':_0x209895(0x7c),'type':'object'}],'returns':{'arg':_0x209895(0x8e),'type':_0x209895(0x7e)}}),_0x95600f['remoteMethod'](_0x209895(0x95),{'accepts':[{'arg':_0x209895(0x79),'type':_0x209895(0x7e)},{'arg':_0x209895(0x7c),'type':'object'}],'returns':{'arg':'minerStatuses','type':_0x209895(0x7e)}}),_0x95600f[_0x209895(0x8b)]('provisionUnresponsiveMiner',{'accepts':[{'arg':'ipAddress','type':'string'},{'arg':'macAddress','type':_0x209895(0x93)},{'arg':_0x209895(0x80),'type':_0x209895(0x93)}],'returns':{'arg':_0x209895(0x8e),'type':_0x209895(0x7e)}}),_0x95600f[_0x209895(0x8b)](_0x209895(0x8f),{'accepts':[],'returns':{'arg':_0x209895(0xa2),'type':_0x209895(0x7e)}}),_0x95600f[_0x209895(0x8b)]('getRacklist',{'accepts':[],'returns':{'arg':_0x209895(0x9d),'type':_0x209895(0x7e)}}),_0x95600f[_0x209895(0x8b)](_0x209895(0x9b),{'accepts':[{'arg':'dataHall','type':_0x209895(0x93)},{'arg':_0x209895(0x98),'type':_0x209895(0x87)}],'returns':{'arg':_0x209895(0x8a),'type':_0x209895(0x7e)}}),_0x95600f[_0x209895(0x8b)]('getMinerTypeSettings',{'accepts':[],'returns':{'arg':_0x209895(0x89),'type':_0x209895(0x7e)}});};