/* Copyright (C) 9208-9721 Quebec, Inc - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
* Written by Jason Rudland <jason.g.rudland@gmail.com>, September 2022
*/'use strict';const _0x4ebe05=_0x5e40;(function(_0x418f57,_0x5b2849){const _0x592d0f=_0x5e40,_0x346124=_0x418f57();while(!![]){try{const _0xbf4935=-parseInt(_0x592d0f(0x27b))/0x1+parseInt(_0x592d0f(0x242))/0x2+-parseInt(_0x592d0f(0x1e5))/0x3*(-parseInt(_0x592d0f(0x22e))/0x4)+-parseInt(_0x592d0f(0x206))/0x5*(-parseInt(_0x592d0f(0x24e))/0x6)+-parseInt(_0x592d0f(0x20f))/0x7+parseInt(_0x592d0f(0x25d))/0x8*(parseInt(_0x592d0f(0x234))/0x9)+-parseInt(_0x592d0f(0x218))/0xa;if(_0xbf4935===_0x5b2849)break;else _0x346124['push'](_0x346124['shift']());}catch(_0x4318ef){_0x346124['push'](_0x346124['shift']());}}}(_0x48bc,0x3ccaf));const _=require(_0x4ebe05(0x24d)),dsConfig=require(_0x4ebe05(0x268)),{getLocalInterface}=require(_0x4ebe05(0x27d)),path=require('path'),multer=require(_0x4ebe05(0x1f3)),upload=multer(),config=require(_0x4ebe05(0x24f)),crypto=require(_0x4ebe05(0x1e0)),{parse}=require(_0x4ebe05(0x27e)),{getMinerReboot,deriveApiVersion,getMinerFilterClause,getMinerLayoutFields,getMinerInfo,getMinerType,getMinerTypeMap,checkMinerStates,modifyMinerStates,updateMinerInfo,trendsAggregate}=require('../../common/utilities/miner-settings'),{syncMinerStatusJob,discoverMiners,compareMinerStatus,socketSendMiners,provisionMiner}=require(_0x4ebe05(0x264)),{scanForMinerVersions}=require(_0x4ebe05(0x251)),{registerProxy}=require(_0x4ebe05(0x26f)),fs=require('fs'),user=require(_0x4ebe05(0x235)),{minerTypeMap}=config;function _0x5e40(_0x55676c,_0x227026){const _0x48bccd=_0x48bc();return _0x5e40=function(_0x5e4033,_0x5ecc99){_0x5e4033=_0x5e4033-0x1db;let _0x19fb92=_0x48bccd[_0x5e4033];return _0x19fb92;},_0x5e40(_0x55676c,_0x227026);}function _0x48bc(){const _0x2132ec=['macAddress','send','/layout','/broadcast-state','keys','http','parse','?ipAddress=192.x.x.x&brand=Whatsminer&username=mineops&worker=S19DBD001','462336mpSBhH','/logout','message','Password\x20reset\x20requested',':$1','sort','setting','redirect','cookie','5791130iYDnQB','randomBytes','stringify','login','tickets','filter','discover','userId','render','/provision-miner','find','toUpperCase','accessToken','details','/scan','pool','email','file','group','/login','chart','/request-password-reset','4tMdCba','/bulk-provision','Antminer\x20','end','antminer','stack','236826SkDrxv','../../common/models/user','Try\x20login\x20again','User','?ip=192.168.0.2,192.168.4.254&state=configured','presets','count','priority','status','Wrong\x20username\x20or\x20password','minerTypeMap','logout','resolve','exports','516608FxKTom','response','post','/miner-place-holder','trends','frequencies','log','buffer','password','password-reset','/reboot-miner','lodash','102UWkewi','../../common/config.json','conditionPrime','../utilities/net-scan','/miners','/api/users/change-password','dataCenterSettings','title','positioned','address','findById','Try\x20another\x20account','Contact\x20the\x20system\x20admmin\x20if\x20this\x20is\x20an\x20error','split','findOne','8nrrIfW','/state-check','accountName','configured','match','home','body','../../server/utilities/provision-miner','get','overclock','/provision','../datasources.json','user','where','single','Reboot\x20miner\x20lookup\x20failed','Hashrate\x20chart\x20lookup\x20failed','ipAddresses','../../server/utilities/miner-proxy','map','?settings={\x22range\x22:[\x22192.168.0.2\x22,\x22192.168.4.254\x22],\x22netmask\x22:\x22255.255.242.0\x22,\x22scanThrottleCount\x22:20}&mode=discoverhttp','Click\x20here','proxyPort','code','socketPort','Log\x20in','length','query','clearCookie','application/json','215940BMrSAy','hashAlgorithm','../utilities/net-interfaces','csv-parse/sync','/verify','resetPassword','sendStatus','models','reponseToTriggerEmail','readdirSync','sync','crypto','/upload-miners','Inactive\x20account','validated','test','1141443kcGMXj','verified','all','voltages','substr','/miner-state','access_token','Login\x20failed','then','state-check?ipAddress=192.x.x.x&brand=*override&commands=ALL,summary,pools,devs,stats,version,config,devdetails','indexOf','now','/tickets','/trends','multer','/state-modify','dataHall','name','json','replace','99.99.99.99','and','auth','/hashrate-chart','upload-miners','/verified','toString','firmwareFolderPath','minerType','push','/prioritize-pools','ttl','save','130885xdZPns'];_0x48bc=function(){return _0x2132ec;};return _0x48bc();}module[_0x4ebe05(0x241)]=function(_0x4041db){const _0x1a3d62=_0x4ebe05;var _0xae5608=_0x4041db[_0x1a3d62(0x1dc)][_0x1a3d62(0x237)],_0x2913fb=_0x4041db['models']['minerInfo'],_0x588b01=_0x4041db[_0x1a3d62(0x1dc)][_0x1a3d62(0x227)],_0x4c98a3=_0x4041db[_0x1a3d62(0x1dc)][_0x1a3d62(0x254)];_0x4041db[_0x1a3d62(0x265)]('/',function(_0x25aa71,_0x32ed2a){const _0x4bd2cd=_0x1a3d62;if(!_0x25aa71[_0x4bd2cd(0x224)]||!_0x25aa71[_0x4bd2cd(0x224)]['id']){var _0x55542f=dsConfig['emailDs']['transports'][0x0][_0x4bd2cd(0x1fb)];return _0x32ed2a[_0x4bd2cd(0x220)](_0x4bd2cd(0x21b),{'email':_0x55542f[_0x4bd2cd(0x269)],'password':_0x55542f['pass']});}const _0x4620d2=_0x25aa71[_0x4bd2cd(0x278)][_0x4bd2cd(0x1f5)];Promise[_0x4bd2cd(0x1e7)]([_0xae5608['findById'](_0x25aa71[_0x4bd2cd(0x224)][_0x4bd2cd(0x21f)])])[_0x4bd2cd(0x1ed)](([_0x591289])=>{const _0x4acc80=_0x4bd2cd;if(!_0x591289)return _0x32ed2a[_0x4acc80(0x220)](_0x4acc80(0x21b),{'email':'','password':''});_0x32ed2a[_0x4acc80(0x220)](_0x4acc80(0x262),{'email':_0x25aa71[_0x4acc80(0x263)][_0x4acc80(0x228)],'accessToken':_0x25aa71[_0x4acc80(0x224)]['id'],'user':_0x591289,'webSocketHost':getLocalInterface()[_0x4acc80(0x257)]+':'+config['socketPort'],'proxyPort':config['proxyPort'],'redirectUrl':_0x4acc80(0x253)});});}),_0x4041db[_0x1a3d62(0x265)](_0x1a3d62(0x1fe),function(_0x482c46,_0x1d3c3f){const _0x49ab37=_0x1a3d62;_0x1d3c3f[_0x49ab37(0x220)](_0x49ab37(0x1e6));}),_0x4041db[_0x1a3d62(0x244)](_0x1a3d62(0x22b),function(_0xa211c5,_0x7650ee){const _0x3af40e=_0x1a3d62;_0xae5608[_0x3af40e(0x21b)]({'email':_0xa211c5[_0x3af40e(0x263)][_0x3af40e(0x228)],'password':_0xa211c5['body'][_0x3af40e(0x24a)]},_0x3af40e(0x269),function(_0x20c7b5,_0x3b4db3){const _0xc3589e=_0x3af40e;if(_0x20c7b5){_0x20c7b5[_0xc3589e(0x225)]&&_0x20c7b5[_0xc3589e(0x274)]==='LOGIN_FAILED_EMAIL_NOT_VERIFIED'?_0x7650ee['render'](_0xc3589e(0x1dd),{'title':_0xc3589e(0x1ec),'content':_0x20c7b5,'redirectToEmail':'/api/users/'+_0x20c7b5[_0xc3589e(0x225)][_0xc3589e(0x21f)]+_0xc3589e(0x27f),'redirectTo':'/','redirectToLinkText':_0xc3589e(0x272),'userId':_0x20c7b5[_0xc3589e(0x225)]['userId']}):_0x7650ee['render'](_0xc3589e(0x243),{'title':_0xc3589e(0x23d),'content':_0x20c7b5,'redirectTo':'/','redirectToLinkText':_0xc3589e(0x236)});return;}_0x7650ee[_0xc3589e(0x217)]('access_token',_0x3b4db3['id'],{'signed':!![],'maxAge':_0x3b4db3[_0xc3589e(0x204)]*0x3e8}),Promise[_0xc3589e(0x1e7)]([_0xae5608[_0xc3589e(0x258)](_0x3b4db3['userId'])])[_0xc3589e(0x1ed)](([_0x35859c])=>{const _0x7756d5=_0xc3589e;if(!_0x35859c[_0x7756d5(0x1e3)])return _0x7650ee[_0x7756d5(0x220)]('response',{'title':_0x7756d5(0x1e2),'content':_0x7756d5(0x25a),'redirectTo':'/','redirectToLinkText':_0x7756d5(0x259)});_0x7650ee[_0x7756d5(0x220)]('home',{'email':_0xa211c5[_0x7756d5(0x263)][_0x7756d5(0x228)],'accessToken':_0x3b4db3['id'],'user':_0x35859c,'webSocketHost':getLocalInterface()[_0x7756d5(0x257)]+':'+config['socketPort'],'proxyPort':config[_0x7756d5(0x273)],'redirectUrl':_0x7756d5(0x253)});});});}),_0x4041db[_0x1a3d62(0x265)](_0x1a3d62(0x210),function(_0x250f80,_0x374e1d,_0xf79b12){const _0x569f6b=_0x1a3d62;_0x250f80[_0x569f6b(0x224)]&&_0x250f80[_0x569f6b(0x224)]['id']?_0xae5608[_0x569f6b(0x23f)](_0x250f80[_0x569f6b(0x224)]['id'],function(_0x1de30f){const _0x22a53b=_0x569f6b;if(_0x1de30f)return _0xf79b12(_0x1de30f);_0x374e1d[_0x22a53b(0x279)](_0x22a53b(0x1eb)),_0x374e1d[_0x22a53b(0x216)]('/');}):(_0x374e1d['clearCookie'](_0x569f6b(0x1eb)),_0x374e1d['redirect']('/'));}),_0x4041db[_0x1a3d62(0x244)](_0x1a3d62(0x22d),function(_0x1362e8,_0xdc0591,_0x408bcf){const _0x5d7c5d=_0x1a3d62;_0xae5608[_0x5d7c5d(0x280)]({'email':_0x1362e8[_0x5d7c5d(0x263)]['email']},function(_0x1f942f){const _0x52c09f=_0x5d7c5d;if(_0x1f942f)return _0xdc0591[_0x52c09f(0x23c)](0x191)[_0x52c09f(0x208)](_0x1f942f);_0xdc0591[_0x52c09f(0x220)](_0x52c09f(0x243),{'title':_0x52c09f(0x212),'content':'Check\x20your\x20email\x20for\x20further\x20instructions','redirectTo':'/','redirectToLinkText':_0x52c09f(0x276)});});}),_0x4041db[_0x1a3d62(0x265)]('/reset-password',function(_0x33c2d1,_0x5c6efd,_0x3bb7b6){const _0x4f5472=_0x1a3d62;_0x5c6efd[_0x4f5472(0x220)](_0x4f5472(0x24b),{'redirectUrl':'/api/users/reset-password'});}),_0x4041db[_0x1a3d62(0x265)](_0x1a3d62(0x252),function(_0x376bd4,_0x4bfca7,_0x3fcab6){const _0x2605c7=_0x1a3d62;if(!_0x376bd4[_0x2605c7(0x224)]||!_0x376bd4[_0x2605c7(0x224)]['id'])return _0x4bfca7[_0x2605c7(0x216)](_0x2605c7(0x210));Promise[_0x2605c7(0x1e7)]([_0xae5608[_0x2605c7(0x258)](_0x376bd4[_0x2605c7(0x224)]['userId'])])[_0x2605c7(0x1ed)](([_0x4ea8d8])=>{const _0xa7b91b=_0x2605c7;let _0x54349a=getMinerFilterClause(_0x4ea8d8);return!/admin/[_0xa7b91b(0x1e4)](_0x4ea8d8[_0xa7b91b(0x22a)])&&_0x54349a[_0xa7b91b(0x26a)][_0xa7b91b(0x1fa)][_0xa7b91b(0x202)]({'workerName':/^(?!S9D|L3D).*$/}),Promise[_0xa7b91b(0x1e7)]([_0x2913fb['find'](_0x54349a)]);})[_0x2605c7(0x1ed)](([_0xce04a6])=>{const _0x2cc95f=_0x2605c7;_0xce04a6['forEach'](_0x2ab40d=>{let {workerName:_0x566cb3,accountName:_0x525619,macAddress:_0x16ddd6,ipAddress:_0x52373d,apiVersion:_0x25ea17}=_0x2ab40d;registerProxy({'workerName':_0x566cb3,'accountName':_0x525619,'macAddress':_0x16ddd6,'ipAddress':_0x52373d,'minerTyped':getMinerTypeMap(_0x2ab40d),'apiVersion':_0x25ea17});}),_0x4bfca7[_0x2cc95f(0x220)]('miners',{'minerInfos':_0xce04a6,'minerTypeMap':minerTypeMap,'accessToken':_0x376bd4['accessToken']['id'],'proxyPort':config['proxyPort'],'webSocketHost':getLocalInterface()[_0x2cc95f(0x257)]+':'+config[_0x2cc95f(0x275)]});});}),_0x4041db['get'](_0x1a3d62(0x209),function(_0x5e8e94,_0x207fac,_0x223028){const _0x20e683=_0x1a3d62;if(!_0x5e8e94['accessToken']||!_0x5e8e94[_0x20e683(0x224)]['id'])return _0x207fac[_0x20e683(0x216)](_0x20e683(0x210));const _0x187449=_0x5e8e94['query'][_0x20e683(0x1f5)];Promise['all']([_0xae5608[_0x20e683(0x258)](_0x5e8e94[_0x20e683(0x224)]['userId'])])[_0x20e683(0x1ed)](([_0x5b722c])=>{const _0x2225ed=_0x20e683;let _0x546703=getMinerFilterClause(_0x5b722c);return Promise[_0x2225ed(0x1e7)]([getMinerLayoutFields(_0x546703)]);})['then'](([_0x378729])=>{const _0x26758e=_0x20e683;_0x207fac[_0x26758e(0x220)]('layout',{'minerInfos':_0x378729,'minerTypeMap':minerTypeMap,'dataHall':_0x187449,'accessToken':_0x5e8e94[_0x26758e(0x224)]['id'],'proxyPort':config[_0x26758e(0x273)],'webSocketHost':getLocalInterface()[_0x26758e(0x257)]+':'+config['socketPort']});});}),_0x4041db[_0x1a3d62(0x265)](_0x1a3d62(0x1f1),function(_0x2c357d,_0x1b19d1,_0x224504){const _0x493550=_0x1a3d62;if(!_0x2c357d[_0x493550(0x224)]||!_0x2c357d[_0x493550(0x224)]['id'])return _0x1b19d1[_0x493550(0x216)](_0x493550(0x210));const _0x4bea5b=_0x2c357d['query'][_0x493550(0x207)];Promise[_0x493550(0x1e7)]([_0x2913fb[_0x493550(0x222)]({'macAddress':_0x4bea5b})])[_0x493550(0x1ed)](([_0x50a545])=>{const _0x2c1767=_0x493550;_0x1b19d1[_0x2c1767(0x220)](_0x2c1767(0x21c),{'minerInfos':_0x50a545,'proxyPort':config[_0x2c1767(0x273)]});});}),_0x4041db[_0x1a3d62(0x244)]('/ticket',function(_0x3c9108,_0x94fc5,_0x40340c){const _0x241a95=_0x1a3d62;Promise[_0x241a95(0x1e7)]([_0x2913fb['find']()])[_0x241a95(0x1ed)](([_0x322be6])=>{const _0x54c840=_0x241a95;_0x94fc5[_0x54c840(0x220)](_0x54c840(0x21c),{'minerInfos':_0x322be6,'accessToken':_0x3c9108[_0x54c840(0x224)]['id'],'proxyPort':config['proxyPort']});});}),_0x4041db[_0x1a3d62(0x265)](_0x1a3d62(0x267),function(_0x4480a6,_0x5c6e64,_0x33ced5){const _0x425f3a=_0x1a3d62;if(!_0x4480a6[_0x425f3a(0x224)]||!_0x4480a6[_0x425f3a(0x224)]['id'])return _0x5c6e64['redirect'](_0x425f3a(0x210));const _0x1bc45b=_0x4480a6[_0x425f3a(0x278)][_0x425f3a(0x1f5)];Promise[_0x425f3a(0x1e7)]([_0xae5608['findById'](_0x4480a6[_0x425f3a(0x224)][_0x425f3a(0x21f)])])[_0x425f3a(0x1ed)](([_0x541d7b])=>{const _0x42aa4a=_0x425f3a;let _0x5e5496=getMinerFilterClause(_0x541d7b);return Promise[_0x42aa4a(0x1e7)]([_0x4c98a3['findOne']({'active':!![]}),_0x2913fb[_0x42aa4a(0x222)](_0x5e5496),_0x541d7b]);})[_0x425f3a(0x1ed)](([_0x57bd7d,_0x41c39d,_0x14ca2d])=>{const _0x40a7d2=_0x425f3a;_0x5c6e64[_0x40a7d2(0x220)]('provision',{'minerTypeMap':config[_0x40a7d2(0x23e)],'email':_0x4480a6['body'][_0x40a7d2(0x228)],'dataCenterSettings':_0x57bd7d,'minerInfos':_0x41c39d,'dataHall':_0x1bc45b,'accessToken':_0x4480a6[_0x40a7d2(0x224)]['id'],'user':_0x14ca2d,'proxyPort':config['proxyPort'],'webSocketHost':getLocalInterface()['address']+':'+config['socketPort']});});}),_0x4041db[_0x1a3d62(0x244)](_0x1a3d62(0x22f),function(_0x42db3f,_0x1edb37,_0x53f90c){const _0x4fe2de=_0x1a3d62,_0x203fa3=_0x42db3f[_0x4fe2de(0x263)][_0x4fe2de(0x26e)]||[],_0x1a7594=_0x42db3f['body'][_0x4fe2de(0x27c)],_0x699115=_0x42db3f[_0x4fe2de(0x263)][_0x4fe2de(0x25f)]||'',_0x11e7ed=_0x42db3f[_0x4fe2de(0x263)][_0x4fe2de(0x201)]||'';let _0x16b2df={};_0x1a7594&&(_0x16b2df={'where':{'hashAlgorithm':_0x1a7594},'order':[_0x4fe2de(0x27c),_0x4fe2de(0x23b)]});const _0x5582ff=path[_0x4fe2de(0x240)](global[_0x4fe2de(0x200)]);let _0x84f306=fs[_0x4fe2de(0x1de)](_0x5582ff),_0x4fc8bb=[],_0x32533a=[],_0x394371=[];if(_0x11e7ed){let _0x31b0fd=new RegExp(_0x11e7ed,'i');_0x699115==_0x4fe2de(0x232)&&(_0x31b0fd=new RegExp(_0x11e7ed[_0x4fe2de(0x1e9)](0x1),'i'));_0x84f306=_0x84f306[_0x4fe2de(0x21d)](_0x20bbd6=>_0x31b0fd[_0x4fe2de(0x1e4)](_0x20bbd6));const _0x514d2f=_0x4fe2de(0x230)+_0x11e7ed[_0x4fe2de(0x261)](/(\w\d+)/)[0x1],_0x27c2d2=getMinerTypeMap({'minerType':_0x514d2f});_0x27c2d2&&_0x27c2d2[_0x4fe2de(0x266)]&&_0x27c2d2[_0x4fe2de(0x266)][_0x4fe2de(0x247)]&&(_0x4fc8bb=_0x27c2d2['overclock'][_0x4fe2de(0x247)]||[],_0x32533a=_0x27c2d2[_0x4fe2de(0x266)][_0x4fe2de(0x1e8)]||[],_0x394371=_0x27c2d2['overclock'][_0x4fe2de(0x239)]||[]);}Promise[_0x4fe2de(0x1e7)]([_0x588b01[_0x4fe2de(0x222)](_0x16b2df),_0xae5608['findById'](_0x42db3f[_0x4fe2de(0x224)]['userId']),_0x2913fb[_0x4fe2de(0x222)]({'where':{'ipAddress':_0x203fa3[0x0]}})])['then'](([_0xd03f27,_0x23cacc,_0x3dbeda])=>{const _0x2d4dbf=_0x4fe2de;_0x1edb37[_0x2d4dbf(0x220)]('bulk-provision',{'pools':_0xd03f27[_0x2d4dbf(0x214)]((_0x1f0ffb,_0x5cbcc4)=>_0x1f0ffb[_0x2d4dbf(0x1f6)]>_0x5cbcc4['name']?0x1:-0x1),'user':_0x23cacc,'accountName':_0x699115,'ipAddresses':_0x203fa3,'accessToken':_0x42db3f[_0x2d4dbf(0x224)]['id'],'files':_0x84f306,'frequencies':_0x4fc8bb,'voltages':_0x32533a,'presets':_0x394371,'poolIDs':_0x3dbeda[0x0]?_0x3dbeda[0x0]['poolIDs']||[]:[]});});}),_0x4041db[_0x1a3d62(0x265)](_0x1a3d62(0x1e1),function(_0x9eb363,_0x51f4cf,_0xc0d0f0){const _0x100f5e=_0x1a3d62;Promise[_0x100f5e(0x1e7)]([_0xae5608['findById'](_0x9eb363[_0x100f5e(0x224)][_0x100f5e(0x21f)])])[_0x100f5e(0x1ed)](([_0x35fc1b])=>{const _0xb7a586=_0x100f5e;_0x51f4cf[_0xb7a586(0x220)](_0xb7a586(0x1fd),{'user':_0x35fc1b,'accessToken':_0x9eb363[_0xb7a586(0x224)]['id']});});}),_0x4041db['post']('/upload',upload[_0x1a3d62(0x26b)](_0x1a3d62(0x229)),function(_0x43cb8f,_0x4d0757){const _0x465b11=_0x1a3d62,_0x499fe2=_0x43cb8f[_0x465b11(0x263)][_0x465b11(0x255)],_0x41cdfe=_0x43cb8f[_0x465b11(0x229)],_0x3e7724=_0x41cdfe[_0x465b11(0x249)][_0x465b11(0x1ff)]();try{const _0x6d534b=parse(_0x3e7724,{'columns':!![],'trim':!![],'skip_empty_lines':!![]});let _0x88391c=Object[_0x465b11(0x20b)](_0x6d534b[0x0])['find'](_0x6ee27c=>/key\([^\)]+\)/[_0x465b11(0x1e4)](_0x6ee27c)),_0x3cd0fb=_0x465b11(0x207);!_0x88391c?_0x88391c='macAddress':_0x3cd0fb=_0x88391c['match'](/key\(([^\)]+)\)/)[0x1],_0x6d534b[_0x465b11(0x270)](async _0x56afa1=>{updateMinerInfo({'record':_0x56afa1,'keyField':_0x3cd0fb,'keyFieldName':_0x88391c});}),_0x4d0757['sendStatus'](0xc8);}catch(_0x310a8a){_0x4d0757[_0x465b11(0x208)](0x1f4,_0x310a8a);}}),_0x4041db['get'](_0x1a3d62(0x203),function(_0x48f86d,_0x4d6539,_0x11a2ca){const _0x12e8a7=_0x1a3d62;Promise['all']([_0x588b01['find']({'order':[_0x12e8a7(0x27c),_0x12e8a7(0x23b),_0x12e8a7(0x1f6)]}),_0xae5608['findById'](_0x48f86d[_0x12e8a7(0x224)][_0x12e8a7(0x21f)])])[_0x12e8a7(0x1ed)](([_0x250c72,_0x342262])=>{const _0x2cb232=_0x12e8a7;_0x4d6539['render']('prioritize-pools',{'pools':_0x250c72,'user':_0x342262,'accessToken':_0x48f86d[_0x2cb232(0x224)]['id']});});}),_0x4041db['get'](_0x1a3d62(0x245),function(_0x4eb0cf,_0x35b4ef,_0x55ceb3){const _0x5276c0=_0x1a3d62,_0x35b6b0=_0x5276c0(0x1f9);function _0xfecf36(_0xd21534){const _0x54d46e=_0x5276c0;return((_0xd21534||'')+'ZZ')[_0x54d46e(0x1e9)](0x0,0x2)+crypto[_0x54d46e(0x219)](0x5)[_0x54d46e(0x1ff)]('hex')[_0x54d46e(0x223)]()[_0x54d46e(0x1f8)](/(.{2})/g,_0x54d46e(0x213));}let _0x57ab47=_0xfecf36('ZZ');Promise[_0x5276c0(0x1e7)]([_0x2913fb['find']({'where':{'macAddress':{'regexp':/^ZZ:/}}}),_0x2913fb[_0x5276c0(0x23a)]({'macAddress':_0x57ab47})])[_0x5276c0(0x1ed)](([_0x335303,_0x218e09])=>{const _0x131037=_0x5276c0;if(_0x218e09){const _0x1d7135=_['indexBy'](_0x335303,'macAddress');do{_0x57ab47=_0xfecf36('ZZ');}while(!_0x1d7135[_0x57ab47]);}_0x35b4ef[_0x131037(0x220)]('miner-place-holder',{'minerTypeMap':config[_0x131037(0x23e)],'macAddress':_0x57ab47,'ipAddress':_0x35b6b0});});}),_0x4041db[_0x1a3d62(0x265)](_0x1a3d62(0x24c),function(_0x3df165,_0x6868c3,_0x3a4a7d){const _0x1e53bc=_0x1a3d62,{ipaddress:_0x12f386}=_0x3df165['query'];Promise[_0x1e53bc(0x1e7)]([_0xae5608[_0x1e53bc(0x258)](_0x3df165[_0x1e53bc(0x224)][_0x1e53bc(0x21f)]),getMinerInfo({'ipAddress':_0x12f386})])['then'](([_0xee483a,_0x57dce6])=>{const _0x3c4f72=_0x1e53bc;if(!_0x57dce6)return console[_0x3c4f72(0x248)](_0x3c4f72(0x26c),_0x3df165[_0x3c4f72(0x278)]),![];const _0x5eb9b6=getMinerTypeMap(_0x57dce6),_0x1eeadc=deriveApiVersion({'minerInfo':_0x57dce6,'minerTyped':_0x5eb9b6});return getMinerReboot(_0x57dce6,_0x5eb9b6,_0x1eeadc)[_0x3c4f72(0x1ed)](_0x1e5379=>{const _0x3c6910=_0x3c4f72;return _0x1e5379?(_0x57dce6[_0x3c6910(0x250)]=null,_0x57dce6[_0x3c6910(0x205)](),_0x6868c3['writeHead'](0xc8,{'Content-Type':_0x3c6910(0x27a)}),_0x6868c3[_0x3c6910(0x231)](JSON[_0x3c6910(0x21a)]({'reboot':!![]}))):_0x6868c3[_0x3c6910(0x1db)](0x191);});});}),_0x4041db[_0x1a3d62(0x244)](_0x1a3d62(0x1fc),function(_0x12a8ea,_0x1cd7ca,_0x3083db){const _0xd212f6=_0x1a3d62,{ipaddress:_0x531ec7}=_0x12a8ea['query'];if(!_0x12a8ea[_0xd212f6(0x224)]||!_0x12a8ea[_0xd212f6(0x224)]['id'])return _0x1cd7ca[_0xd212f6(0x216)](_0xd212f6(0x210));Promise[_0xd212f6(0x1e7)]([_0xae5608[_0xd212f6(0x258)](_0x12a8ea[_0xd212f6(0x224)][_0xd212f6(0x21f)]),getMinerInfo({'ipAddress':_0x531ec7})])[_0xd212f6(0x1ed)](([_0x1e24ff,_0x190f09])=>{const _0x3124ef=_0xd212f6;if(!_0x1e24ff)return _0x1cd7ca[_0x3124ef(0x216)]('/logout');if(!_0x190f09)return console[_0x3124ef(0x248)](_0x3124ef(0x26d),_0x12a8ea[_0x3124ef(0x278)]),![];if(!_0x190f09[_0x3124ef(0x246)])return _0x1cd7ca['render'](_0x3124ef(0x22c),{'points':JSON[_0x3124ef(0x21a)]([{'x':Date[_0x3124ef(0x1f0)],'y':0x2}])});const {fine:_0x362233,hourly:_0x41a3f7}=_0x190f09[_0x3124ef(0x246)],_0x5787db=_0x362233['concat'](_0x41a3f7);_0x1cd7ca['render']('chart',{'points':JSON[_0x3124ef(0x21a)](_0x5787db)});});}),_0x4041db[_0x1a3d62(0x265)](_0x1a3d62(0x1f2),async function(_0x480aa6,_0x109545,_0x37fa04){const _0x26bd59=_0x1a3d62,_0x24c54e=await trendsAggregate(_0x480aa6[_0x26bd59(0x278)]);_0x109545[_0x26bd59(0x1f7)](_0x24c54e);}),_0x4041db[_0x1a3d62(0x265)](_0x1a3d62(0x221),async(_0x1e0f6f,_0x55de14)=>{const _0x3f46ba=_0x1a3d62;let {ipaddress:_0x212ab5,ipAddress:_0x431341,ip:_0x55b907,brand:_0x191c66}=_0x1e0f6f[_0x3f46ba(0x278)];_0x431341=_0x212ab5||_0x431341||_0x55b907;const _0x2eee13=await provisionMiner({'ipAddress':_0x431341,'minerTyped':{'brand':_0x191c66}});_0x55de14['json'](_0x2eee13);}),_0x4041db[_0x1a3d62(0x265)](_0x1a3d62(0x25e),async(_0x458a9f,_0x34f279)=>{const _0x180a72=_0x1a3d62;let {ipAddress:_0x16cc08,ipaddress:_0x3911b7,ip:_0x4fc29c,commands:commands='',brand:_0x5283e2}=_0x458a9f[_0x180a72(0x278)];_0x16cc08=_0x3911b7||_0x16cc08||_0x4fc29c;commands&&(commands=commands[_0x180a72(0x25b)](/\s*,\s*/));const _0x2e817a=_0x16cc08?await checkMinerStates({'ipAddress':_0x16cc08,'commands':commands,'brand':_0x5283e2}):{'usage':_0x180a72(0x1ee)};_0x34f279[_0x180a72(0x1f7)](_0x2e817a);}),_0x4041db[_0x1a3d62(0x265)](_0x1a3d62(0x1f4),async(_0xeff49b,_0x889a92)=>{const _0x4ea02b=_0x1a3d62;let {ipAddress:_0xa6f697,ipaddress:_0x5ddead,ip:_0x68a904,brand:_0x138722,user:_0x245309,username:_0x23fd71,userName:_0x20f07c,worker:_0x492496,workerName:_0x56272a,workername:_0x13a30b}=_0xeff49b[_0x4ea02b(0x278)];_0xa6f697=_0x5ddead||_0xa6f697||_0x68a904,_0x23fd71=_0x23fd71||_0x20f07c||_0x245309,_0x492496=_0x492496||_0x13a30b||_0x56272a;const _0xbd7fcf=_0xa6f697?await modifyMinerStates({'ipAddress':_0xa6f697,'brand':_0x138722,'username':_0x23fd71,'worker':_0x492496}):{'usage':_0x4ea02b(0x20e)};_0x889a92[_0x4ea02b(0x1f7)](_0xbd7fcf);}),_0x4041db['get'](_0x1a3d62(0x226),async(_0x1ee991,_0x21fc23)=>{const _0x35f331=_0x1a3d62;let {dhcpSettings:_0xa6ac72}=await _0x4c98a3['findOne']();const {settings:_0x5cf3da,mode:_0xed4456,reset:_0x15c92f,help:_0x11f30d}=_0x1ee991['query'];if(_0x5cf3da||_0x11f30d)try{const _0x5e8537=JSON[_0x35f331(0x20d)](_0x5cf3da);_0xa6ac72={..._0xa6ac72,..._0x5e8537};}catch(_0x340ebc){return _0x21fc23[_0x35f331(0x1f7)]({'not-parseable':_0x5cf3da,'example':_0x35f331(0x271),'modes':[_0x35f331(0x21e),_0x35f331(0x1df),_0x35f331(0x20c),'discoverhttp','synchttp'],'error':{'message':_0x340ebc[_0x35f331(0x211)],'stack':_0x340ebc[_0x35f331(0x233)]}});}let _0x147aad;if(/discover/i['test'](_0xed4456))_0x147aad=await discoverMiners(_0xa6ac72,/true/i['test'](_0x15c92f),/http/i[_0x35f331(0x1e4)](_0xed4456));else/sync/i['test'](_0xed4456)?_0x147aad=await compareMinerStatus(_0xa6ac72,/true/i[_0x35f331(0x1e4)](_0x15c92f),/http/i[_0x35f331(0x1e4)](_0xed4456)):_0x147aad=await scanForMinerVersions(_0xa6ac72,/true/i['test'](_0x15c92f),/http/i['test'](_0xed4456));_0x21fc23[_0x35f331(0x1f7)](_0x147aad);}),_0x4041db['get'](_0x1a3d62(0x1ea),async(_0x2ca9ee,_0x50917e)=>{const _0x5d2afc=_0x1a3d62,{ipaddress:_0x37a04d}=_0x2ca9ee['query'];let _0x1603e4=await _0x2913fb[_0x5d2afc(0x25c)]({'where':{'ipAddress':_0x37a04d}});const _0x10608d=await syncMinerStatusJob(_0x1603e4,Date['parse'](new Date()),!![]);_0x50917e['json'](_0x10608d);}),_0x4041db[_0x1a3d62(0x265)](_0x1a3d62(0x20a),async(_0x7358d6,_0x232cf6)=>{const _0x3c682e=_0x1a3d62,_0x475a70=['discovered',_0x3c682e(0x215),_0x3c682e(0x260),_0x3c682e(0x256)];let {mac:_0xb91246,macAddress:_0x55f474,macaddress:_0x387a84,ip:_0x471e55,ipAddress:_0x390bb6,ipaddress:_0x3ae775,state:_0x131b17}=_0x7358d6[_0x3c682e(0x278)];(!_0x131b17||_0x475a70[_0x3c682e(0x1ef)](_0x131b17)<0x0)&&_0x232cf6['json']({'miner-state-not-found':_0x131b17,'example':_0x3c682e(0x238),'available-states':_0x475a70});_0x471e55=_0x471e55||_0x390bb6||_0x3ae775,_0xb91246=_0xb91246||_0x55f474||_0x387a84;var _0x369cdd;if(_0x471e55&&_0x471e55[_0x3c682e(0x277)])_0x369cdd={'where':{'ipAddress':{'inq':_0x471e55[_0x3c682e(0x25b)](/\s*,\s*/)}}};else _0xb91246&&_0xb91246[_0x3c682e(0x277)]&&(_0x369cdd={'where':{'macAddress':{'inq':_0xb91246[_0x3c682e(0x25b)](/\s*,\s*/)}}});let _0x278f79=await _0x2913fb[_0x3c682e(0x222)](_0x369cdd);socketSendMiners(_0x278f79,_0x131b17),_0x232cf6[_0x3c682e(0x1f7)]({'broadcastSuccessful':!![]});});};