/* Copyright (C) 9208-9721 Quebec, Inc - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
* Written by Jason Rudland <jason.g.rudland@gmail.com>, September 2022
*/'use strict';function _0x1c6d(_0x3ad497,_0x244cf4){const _0xacf83f=_0xacf8();return _0x1c6d=function(_0x1c6d48,_0x3782d0){_0x1c6d48=_0x1c6d48-0x139;let _0x42f148=_0xacf83f[_0x1c6d48];return _0x42f148;},_0x1c6d(_0x3ad497,_0x244cf4);}const _0x108926=_0x1c6d;function _0xacf8(){const _0x23e932=['password','876528ClDiaC','/upload','accountName','title','replace','dataCenterSettings','layout','Contact\x20the\x20system\x20admmin\x20if\x20this\x20is\x20an\x20error','pass','frequencies','?settings={\x22range\x22:[\x22192.168.0.2\x22,\x22192.168.4.254\x22],\x22netmask\x22:\x22255.255.242.0\x22,\x22scanThrottleCount\x22:20}&mode=discoverhttp','details','email','197031cgHmhk','Try\x20login\x20again','upload-miners','/api/users/reset-password','macAddress','userId','Check\x20your\x20email\x20for\x20further\x20instructions','toUpperCase','/state-modify','crypto','poolIDs','miner-place-holder','trends','overclock','3083500mewncw','then','split','provision','csv-parse/sync','file','match','/provision-miner','models','lodash','voltages','antminer','ipAddresses','writeHead','stringify','toString','12033801pbIMOF','/api/users/change-password','Click\x20here','count','/tickets','/miner-state','2478088BRAGwm','parse','LOGIN_FAILED_EMAIL_NOT_VERIFIED','buffer','application/json','access_token','discover','message','logout','reponseToTriggerEmail','map','200851apuQjE','body','sort','readdirSync','prioritize-pools','name','/prioritize-pools','all','hashAlgorithm','ttl','accessToken','single','minerType','login','24zrNHZF','/reset-password','../../common/config.json','chart','synchttp','http','status','concat','clearCookie','../../common/utilities/miner-settings','substr','proxyPort','conditionPrime','firmwareFolderPath','Reboot\x20miner\x20lookup\x20failed','redirect','send','auth','log','path','save','json','exports',':$1','Antminer\x20','render','indexOf','home','post','/login','stack','priority','/trends','/bulk-provision','minerTypeMap','randomBytes','Password\x20reset\x20requested','../../server/utilities/provision-miner','findOne','setting','transports','resolve','end','tickets','bulk-provision','configured','/verify','find','sync','forEach','99.99.99.99','miners','134HQLoOI','../datasources.json','get','response','user','/state-check','dataHall','/layout','Inactive\x20account','presets','/reboot-miner','discoverhttp','positioned','password-reset','length','/ticket','minerInfo','test','emailDs','pool','Login\x20failed','User','address','?ip=192.168.0.2,192.168.4.254&state=configured','../utilities/net-interfaces','socketPort','../utilities/net-scan','/api/users/','/logout','discovered','?ipAddress=192.x.x.x&brand=Whatsminer&username=mineops&worker=S19DBD001','state-check?ipAddress=192.x.x.x&brand=*override&commands=ALL,summary,pools,devs,stats,version,config,devdetails','findById','3293NNGgHp','query'];_0xacf8=function(){return _0x23e932;};return _0xacf8();}(function(_0x2eb2fc,_0x1e0150){const _0x3e3439=_0x1c6d,_0x1fb756=_0x2eb2fc();while(!![]){try{const _0x5992ec=parseInt(_0x3e3439(0x1bd))/0x1*(parseInt(_0x3e3439(0x19c))/0x2)+-parseInt(_0x3e3439(0x1cd))/0x3*(parseInt(_0x3e3439(0x168))/0x4)+-parseInt(_0x3e3439(0x139))/0x5+parseInt(_0x3e3439(0x1c0))/0x6+-parseInt(_0x3e3439(0x15a))/0x7+-parseInt(_0x3e3439(0x14f))/0x8+parseInt(_0x3e3439(0x149))/0x9;if(_0x5992ec===_0x1e0150)break;else _0x1fb756['push'](_0x1fb756['shift']());}catch(_0x173da6){_0x1fb756['push'](_0x1fb756['shift']());}}}(_0xacf8,0x56920));const _=require(_0x108926(0x142)),dsConfig=require(_0x108926(0x19d)),{getLocalInterface}=require(_0x108926(0x1b4)),path=require(_0x108926(0x17b)),multer=require('multer'),upload=multer(),config=require(_0x108926(0x16a)),crypto=require(_0x108926(0x1d6)),{parse}=require(_0x108926(0x13d)),{getMinerReboot,deriveApiVersion,getMinerFilterClause,getMinerLayoutFields,getMinerInfo,getMinerType,getMinerTypeMap,checkMinerStates,modifyMinerStates,updateMinerInfo,trendsAggregate}=require(_0x108926(0x171)),{syncMinerStatusJob,discoverMiners,compareMinerStatus,socketSendMiners,provisionMiner}=require(_0x108926(0x18d)),{scanForMinerVersions}=require(_0x108926(0x1b6)),{registerProxy}=require('../../server/utilities/miner-proxy'),fs=require('fs'),user=require('../../common/models/user'),{minerTypeMap}=config;module[_0x108926(0x17e)]=function(_0x30eea3){const _0x4f0149=_0x108926;var _0x4e98e6=_0x30eea3[_0x4f0149(0x141)][_0x4f0149(0x1b1)],_0x4c2ff9=_0x30eea3[_0x4f0149(0x141)][_0x4f0149(0x1ac)],_0x4ea8a0=_0x30eea3[_0x4f0149(0x141)][_0x4f0149(0x1af)],_0x200a31=_0x30eea3[_0x4f0149(0x141)][_0x4f0149(0x1c5)];_0x30eea3['get']('/',function(_0x32cbed,_0x384982){const _0x2ca8f2=_0x4f0149;if(!_0x32cbed[_0x2ca8f2(0x164)]||!_0x32cbed[_0x2ca8f2(0x164)]['id']){var _0x39d0b1=dsConfig[_0x2ca8f2(0x1ae)][_0x2ca8f2(0x190)][0x0][_0x2ca8f2(0x179)];return _0x384982[_0x2ca8f2(0x181)](_0x2ca8f2(0x167),{'email':_0x39d0b1[_0x2ca8f2(0x1a0)],'password':_0x39d0b1[_0x2ca8f2(0x1c8)]});}const _0x12cd6d=_0x32cbed[_0x2ca8f2(0x1be)]['dataHall'];Promise[_0x2ca8f2(0x161)]([_0x4e98e6['findById'](_0x32cbed[_0x2ca8f2(0x164)][_0x2ca8f2(0x1d2)])])[_0x2ca8f2(0x13a)](([_0x341cc0])=>{const _0x1fa860=_0x2ca8f2;if(!_0x341cc0)return _0x384982[_0x1fa860(0x181)]('login',{'email':'','password':''});_0x384982['render'](_0x1fa860(0x183),{'email':_0x32cbed[_0x1fa860(0x15b)]['email'],'accessToken':_0x32cbed[_0x1fa860(0x164)]['id'],'user':_0x341cc0,'webSocketHost':getLocalInterface()[_0x1fa860(0x1b2)]+':'+config[_0x1fa860(0x1b5)],'proxyPort':config[_0x1fa860(0x173)],'redirectUrl':_0x1fa860(0x14a)});});}),_0x30eea3[_0x4f0149(0x19e)]('/verified',function(_0x1d9f9a,_0x1a46d4){const _0x1cda3b=_0x4f0149;_0x1a46d4[_0x1cda3b(0x181)]('verified');}),_0x30eea3[_0x4f0149(0x184)](_0x4f0149(0x185),function(_0x559b69,_0x2f459c){const _0x265c7a=_0x4f0149;_0x4e98e6[_0x265c7a(0x167)]({'email':_0x559b69['body'][_0x265c7a(0x1cc)],'password':_0x559b69['body'][_0x265c7a(0x1bf)]},'user',function(_0x298516,_0x3a2da0){const _0x1b7658=_0x265c7a;if(_0x298516){_0x298516[_0x1b7658(0x1cb)]&&_0x298516['code']===_0x1b7658(0x151)?_0x2f459c[_0x1b7658(0x181)](_0x1b7658(0x158),{'title':_0x1b7658(0x1b0),'content':_0x298516,'redirectToEmail':_0x1b7658(0x1b7)+_0x298516[_0x1b7658(0x1cb)]['userId']+_0x1b7658(0x196),'redirectTo':'/','redirectToLinkText':_0x1b7658(0x14b),'userId':_0x298516['details'][_0x1b7658(0x1d2)]}):_0x2f459c[_0x1b7658(0x181)](_0x1b7658(0x19f),{'title':'Wrong\x20username\x20or\x20password','content':_0x298516,'redirectTo':'/','redirectToLinkText':_0x1b7658(0x1ce)});return;}_0x2f459c['cookie'](_0x1b7658(0x154),_0x3a2da0['id'],{'signed':!![],'maxAge':_0x3a2da0[_0x1b7658(0x163)]*0x3e8}),Promise['all']([_0x4e98e6[_0x1b7658(0x1bc)](_0x3a2da0[_0x1b7658(0x1d2)])])[_0x1b7658(0x13a)](([_0x32934c])=>{const _0x3e10d=_0x1b7658;if(!_0x32934c['validated'])return _0x2f459c[_0x3e10d(0x181)](_0x3e10d(0x19f),{'title':_0x3e10d(0x1a4),'content':_0x3e10d(0x1c7),'redirectTo':'/','redirectToLinkText':'Try\x20another\x20account'});_0x2f459c['render']('home',{'email':_0x559b69[_0x3e10d(0x15b)][_0x3e10d(0x1cc)],'accessToken':_0x3a2da0['id'],'user':_0x32934c,'webSocketHost':getLocalInterface()[_0x3e10d(0x1b2)]+':'+config['socketPort'],'proxyPort':config[_0x3e10d(0x173)],'redirectUrl':_0x3e10d(0x14a)});});});}),_0x30eea3[_0x4f0149(0x19e)](_0x4f0149(0x1b8),function(_0x1ab8fb,_0x3c3b27,_0xc5538a){const _0x512e2c=_0x4f0149;_0x1ab8fb[_0x512e2c(0x164)]&&_0x1ab8fb[_0x512e2c(0x164)]['id']?_0x4e98e6[_0x512e2c(0x157)](_0x1ab8fb[_0x512e2c(0x164)]['id'],function(_0x32115e){const _0x367728=_0x512e2c;if(_0x32115e)return _0xc5538a(_0x32115e);_0x3c3b27[_0x367728(0x170)](_0x367728(0x154)),_0x3c3b27['redirect']('/');}):(_0x3c3b27[_0x512e2c(0x170)]('access_token'),_0x3c3b27[_0x512e2c(0x177)]('/'));}),_0x30eea3[_0x4f0149(0x184)]('/request-password-reset',function(_0x9a3f7c,_0xb51273,_0x317297){const _0x4124ea=_0x4f0149;_0x4e98e6['resetPassword']({'email':_0x9a3f7c['body'][_0x4124ea(0x1cc)]},function(_0x1828a5){const _0x26f4b9=_0x4124ea;if(_0x1828a5)return _0xb51273[_0x26f4b9(0x16e)](0x191)[_0x26f4b9(0x178)](_0x1828a5);_0xb51273['render'](_0x26f4b9(0x19f),{'title':_0x26f4b9(0x18c),'content':_0x26f4b9(0x1d3),'redirectTo':'/','redirectToLinkText':'Log\x20in'});});}),_0x30eea3[_0x4f0149(0x19e)](_0x4f0149(0x169),function(_0x5c3a86,_0x5031ad,_0x2a54bc){const _0x22c25a=_0x4f0149;_0x5031ad[_0x22c25a(0x181)](_0x22c25a(0x1a9),{'redirectUrl':_0x22c25a(0x1d0)});}),_0x30eea3[_0x4f0149(0x19e)]('/miners',function(_0x38e716,_0x19c091,_0x18f8ed){const _0x348439=_0x4f0149;if(!_0x38e716[_0x348439(0x164)]||!_0x38e716[_0x348439(0x164)]['id'])return _0x19c091[_0x348439(0x177)](_0x348439(0x1b8));Promise[_0x348439(0x161)]([_0x4e98e6[_0x348439(0x1bc)](_0x38e716[_0x348439(0x164)][_0x348439(0x1d2)])])[_0x348439(0x13a)](([_0x67f7ee])=>{const _0x2b3106=_0x348439;let _0x2558e3=getMinerFilterClause(_0x67f7ee);return Promise[_0x2b3106(0x161)]([_0x4c2ff9[_0x2b3106(0x197)](_0x2558e3)]);})[_0x348439(0x13a)](([_0x3e41e8])=>{const _0x44b573=_0x348439;_0x3e41e8[_0x44b573(0x199)](_0xacc5e=>{let {workerName:_0x4439a9,accountName:_0x31248b,macAddress:_0x23a6db,ipAddress:_0x5765ac,apiVersion:_0xd26955}=_0xacc5e;registerProxy({'workerName':_0x4439a9,'accountName':_0x31248b,'macAddress':_0x23a6db,'ipAddress':_0x5765ac,'minerTyped':getMinerTypeMap(_0xacc5e),'apiVersion':_0xd26955});}),_0x19c091[_0x44b573(0x181)](_0x44b573(0x19b),{'minerInfos':_0x3e41e8,'minerTypeMap':minerTypeMap,'accessToken':_0x38e716[_0x44b573(0x164)]['id'],'proxyPort':config[_0x44b573(0x173)],'webSocketHost':getLocalInterface()[_0x44b573(0x1b2)]+':'+config[_0x44b573(0x1b5)]});});}),_0x30eea3[_0x4f0149(0x19e)](_0x4f0149(0x1a3),function(_0x40bab3,_0x4ce382,_0x25c2fe){const _0x39b549=_0x4f0149;if(!_0x40bab3[_0x39b549(0x164)]||!_0x40bab3['accessToken']['id'])return _0x4ce382['redirect'](_0x39b549(0x1b8));const _0x2d1e53=_0x40bab3[_0x39b549(0x1be)][_0x39b549(0x1a2)];Promise[_0x39b549(0x161)]([_0x4e98e6[_0x39b549(0x1bc)](_0x40bab3[_0x39b549(0x164)]['userId'])])[_0x39b549(0x13a)](([_0x22c855])=>{const _0x463161=_0x39b549;let _0x48a17d=getMinerFilterClause(_0x22c855);return Promise[_0x463161(0x161)]([getMinerLayoutFields(_0x48a17d)]);})['then'](([_0x6ba6bc])=>{const _0x4f376b=_0x39b549;_0x4ce382[_0x4f376b(0x181)](_0x4f376b(0x1c6),{'minerInfos':_0x6ba6bc,'minerTypeMap':minerTypeMap,'dataHall':_0x2d1e53,'accessToken':_0x40bab3[_0x4f376b(0x164)]['id'],'proxyPort':config['proxyPort'],'webSocketHost':getLocalInterface()[_0x4f376b(0x1b2)]+':'+config['socketPort']});});}),_0x30eea3[_0x4f0149(0x19e)](_0x4f0149(0x14d),function(_0x20ea9b,_0x408732,_0x5350c5){const _0x5f2113=_0x4f0149;if(!_0x20ea9b[_0x5f2113(0x164)]||!_0x20ea9b['accessToken']['id'])return _0x408732['redirect']('/logout');const _0x43c174=_0x20ea9b[_0x5f2113(0x1be)][_0x5f2113(0x1d1)];Promise['all']([_0x4c2ff9[_0x5f2113(0x197)]({'macAddress':_0x43c174})])['then'](([_0x4a874b])=>{const _0x4f28e2=_0x5f2113;_0x408732[_0x4f28e2(0x181)](_0x4f28e2(0x193),{'minerInfos':_0x4a874b,'proxyPort':config[_0x4f28e2(0x173)]});});}),_0x30eea3[_0x4f0149(0x184)](_0x4f0149(0x1ab),function(_0x3bd737,_0x1eb5c9,_0x9f4c42){const _0x1cee2f=_0x4f0149;Promise['all']([_0x4c2ff9[_0x1cee2f(0x197)]()])[_0x1cee2f(0x13a)](([_0x5571b6])=>{const _0x2b3617=_0x1cee2f;_0x1eb5c9['render'](_0x2b3617(0x193),{'minerInfos':_0x5571b6,'accessToken':_0x3bd737[_0x2b3617(0x164)]['id'],'proxyPort':config[_0x2b3617(0x173)]});});}),_0x30eea3[_0x4f0149(0x19e)]('/provision',function(_0x1e5f87,_0x304662,_0x798113){const _0x29c6eb=_0x4f0149;if(!_0x1e5f87[_0x29c6eb(0x164)]||!_0x1e5f87[_0x29c6eb(0x164)]['id'])return _0x304662[_0x29c6eb(0x177)](_0x29c6eb(0x1b8));const _0x46e6f6=_0x1e5f87['query'][_0x29c6eb(0x1a2)];Promise[_0x29c6eb(0x161)]([_0x4e98e6[_0x29c6eb(0x1bc)](_0x1e5f87[_0x29c6eb(0x164)]['userId'])])['then'](([_0x35d1cf])=>{const _0x313420=_0x29c6eb;let _0x3f1b42=getMinerFilterClause(_0x35d1cf);return Promise[_0x313420(0x161)]([_0x200a31['findOne']({'active':!![]}),_0x4c2ff9[_0x313420(0x197)](_0x3f1b42),_0x35d1cf]);})[_0x29c6eb(0x13a)](([_0x20a04c,_0x389b17,_0xc8b10f])=>{const _0x4d92ea=_0x29c6eb;_0x304662[_0x4d92ea(0x181)](_0x4d92ea(0x13c),{'minerTypeMap':config[_0x4d92ea(0x18a)],'email':_0x1e5f87['body'][_0x4d92ea(0x1cc)],'dataCenterSettings':_0x20a04c,'minerInfos':_0x389b17,'dataHall':_0x46e6f6,'accessToken':_0x1e5f87[_0x4d92ea(0x164)]['id'],'user':_0xc8b10f,'proxyPort':config['proxyPort'],'webSocketHost':getLocalInterface()[_0x4d92ea(0x1b2)]+':'+config[_0x4d92ea(0x1b5)]});});}),_0x30eea3['post'](_0x4f0149(0x189),function(_0x2d4508,_0x556eaa,_0x1bed51){const _0x405c78=_0x4f0149,_0x3b151a=_0x2d4508[_0x405c78(0x15b)][_0x405c78(0x145)]||[],_0x1ca852=_0x2d4508[_0x405c78(0x15b)]['hashAlgorithm'],_0x16e554=_0x2d4508[_0x405c78(0x15b)][_0x405c78(0x1c2)]||'',_0x1b2932=_0x2d4508['body'][_0x405c78(0x166)]||'';let _0x54e9b0={};_0x1ca852&&(_0x54e9b0={'where':{'hashAlgorithm':_0x1ca852},'order':[_0x405c78(0x162),_0x405c78(0x187)]});const _0x2d0a2e=path[_0x405c78(0x191)](global[_0x405c78(0x175)]);let _0x5a426a=fs[_0x405c78(0x15d)](_0x2d0a2e),_0x39d93d=[],_0xd5a88a=[],_0x3951b2=[];if(_0x1b2932){let _0x5c3c5f=new RegExp(_0x1b2932,'i');_0x16e554==_0x405c78(0x144)&&(_0x5c3c5f=new RegExp(_0x1b2932[_0x405c78(0x172)](0x1),'i'));_0x5a426a=_0x5a426a['filter'](_0x213c77=>_0x5c3c5f[_0x405c78(0x1ad)](_0x213c77));const _0x5ee7f3=_0x405c78(0x180)+_0x1b2932[_0x405c78(0x13f)](/(\w\d+)/)[0x1],_0x172fee=getMinerTypeMap({'minerType':_0x5ee7f3});_0x172fee&&_0x172fee[_0x405c78(0x1da)]&&_0x172fee[_0x405c78(0x1da)][_0x405c78(0x1c9)]&&(_0x39d93d=_0x172fee['overclock']['frequencies']||[],_0xd5a88a=_0x172fee[_0x405c78(0x1da)][_0x405c78(0x143)]||[],_0x3951b2=_0x172fee['overclock'][_0x405c78(0x1a5)]||[]);}Promise[_0x405c78(0x161)]([_0x4ea8a0[_0x405c78(0x197)](_0x54e9b0),_0x4e98e6[_0x405c78(0x1bc)](_0x2d4508[_0x405c78(0x164)][_0x405c78(0x1d2)]),_0x4c2ff9[_0x405c78(0x197)]({'where':{'ipAddress':_0x3b151a[0x0]}})])[_0x405c78(0x13a)](([_0x5558a9,_0xc4f766,_0x239cc0])=>{const _0x573d07=_0x405c78;_0x556eaa[_0x573d07(0x181)](_0x573d07(0x194),{'pools':_0x5558a9[_0x573d07(0x15c)]((_0x129ab3,_0x51fdfc)=>_0x129ab3[_0x573d07(0x15f)]>_0x51fdfc[_0x573d07(0x15f)]?0x1:-0x1),'user':_0xc4f766,'accountName':_0x16e554,'ipAddresses':_0x3b151a,'accessToken':_0x2d4508[_0x573d07(0x164)]['id'],'files':_0x5a426a,'frequencies':_0x39d93d,'voltages':_0xd5a88a,'presets':_0x3951b2,'poolIDs':_0x239cc0[0x0]?_0x239cc0[0x0][_0x573d07(0x1d7)]||[]:[]});});}),_0x30eea3['get']('/upload-miners',function(_0x2701b3,_0x154a89,_0x16b55c){const _0x19c7f4=_0x4f0149;Promise[_0x19c7f4(0x161)]([_0x4e98e6[_0x19c7f4(0x1bc)](_0x2701b3['accessToken'][_0x19c7f4(0x1d2)])])['then'](([_0x416ba3])=>{const _0x2587d0=_0x19c7f4;_0x154a89['render'](_0x2587d0(0x1cf),{'user':_0x416ba3,'accessToken':_0x2701b3[_0x2587d0(0x164)]['id']});});}),_0x30eea3[_0x4f0149(0x184)](_0x4f0149(0x1c1),upload[_0x4f0149(0x165)](_0x4f0149(0x13e)),function(_0xa90c9c,_0x21543a){const _0x4b3d59=_0x4f0149,_0xa2a1da=_0xa90c9c['body'][_0x4b3d59(0x1c3)],_0x1163dc=_0xa90c9c[_0x4b3d59(0x13e)],_0x485f5f=_0x1163dc[_0x4b3d59(0x152)][_0x4b3d59(0x148)]();try{const _0x335062=parse(_0x485f5f,{'columns':!![],'trim':!![],'skip_empty_lines':!![]});let _0xe0b87e=Object['keys'](_0x335062[0x0])[_0x4b3d59(0x197)](_0x1ec34c=>/key\([^\)]+\)/[_0x4b3d59(0x1ad)](_0x1ec34c)),_0x524980=_0x4b3d59(0x1d1);!_0xe0b87e?_0xe0b87e=_0x4b3d59(0x1d1):_0x524980=_0xe0b87e[_0x4b3d59(0x13f)](/key\(([^\)]+)\)/)[0x1],_0x335062[_0x4b3d59(0x159)](async _0x37a561=>{updateMinerInfo({'record':_0x37a561,'keyField':_0x524980,'keyFieldName':_0xe0b87e});}),_0x21543a['sendStatus'](0xc8);}catch(_0x59c71b){_0x21543a['send'](0x1f4,_0x59c71b);}}),_0x30eea3[_0x4f0149(0x19e)](_0x4f0149(0x160),function(_0x69feac,_0x413d85,_0x29d260){const _0x9f5004=_0x4f0149;Promise[_0x9f5004(0x161)]([_0x4ea8a0[_0x9f5004(0x197)]({'order':[_0x9f5004(0x162),_0x9f5004(0x187),_0x9f5004(0x15f)]}),_0x4e98e6[_0x9f5004(0x1bc)](_0x69feac['accessToken']['userId'])])['then'](([_0x579ff2,_0x1d9d2a])=>{const _0x38fd5f=_0x9f5004;_0x413d85[_0x38fd5f(0x181)](_0x38fd5f(0x15e),{'pools':_0x579ff2,'user':_0x1d9d2a,'accessToken':_0x69feac[_0x38fd5f(0x164)]['id']});});}),_0x30eea3[_0x4f0149(0x19e)]('/miner-place-holder',function(_0x2caff,_0x57406d,_0x597480){const _0x4c3854=_0x4f0149,_0x4c3d3c=_0x4c3854(0x19a);function _0xb9d44e(_0x3d2c35){const _0x3c3e9c=_0x4c3854;return((_0x3d2c35||'')+'ZZ')[_0x3c3e9c(0x172)](0x0,0x2)+crypto[_0x3c3e9c(0x18b)](0x5)[_0x3c3e9c(0x148)]('hex')[_0x3c3e9c(0x1d4)]()[_0x3c3e9c(0x1c4)](/(.{2})/g,_0x3c3e9c(0x17f));}let _0x5a6745=_0xb9d44e('ZZ');Promise[_0x4c3854(0x161)]([_0x4c2ff9[_0x4c3854(0x197)]({'where':{'macAddress':{'regexp':/^ZZ:/}}}),_0x4c2ff9[_0x4c3854(0x14c)]({'macAddress':_0x5a6745})])[_0x4c3854(0x13a)](([_0x773de2,_0xaa0ed1])=>{const _0x50d196=_0x4c3854;if(_0xaa0ed1){const _0x24632a=_['indexBy'](_0x773de2,_0x50d196(0x1d1));do{_0x5a6745=_0xb9d44e('ZZ');}while(!_0x24632a[_0x5a6745]);}_0x57406d[_0x50d196(0x181)](_0x50d196(0x1d8),{'minerTypeMap':config[_0x50d196(0x18a)],'macAddress':_0x5a6745,'ipAddress':_0x4c3d3c});});}),_0x30eea3[_0x4f0149(0x19e)](_0x4f0149(0x1a6),function(_0x4be185,_0xb0dfea,_0x18f533){const _0x483eae=_0x4f0149,{ipaddress:_0x1ff6c3}=_0x4be185[_0x483eae(0x1be)];Promise[_0x483eae(0x161)]([_0x4e98e6[_0x483eae(0x1bc)](_0x4be185[_0x483eae(0x164)][_0x483eae(0x1d2)]),getMinerInfo({'ipAddress':_0x1ff6c3})])[_0x483eae(0x13a)](([_0x2817d0,_0x164d1a])=>{const _0x42f0bd=_0x483eae;if(!_0x164d1a)return console['log'](_0x42f0bd(0x176),_0x4be185['query']),![];const _0x7b7361=getMinerTypeMap(_0x164d1a),_0x7e7336=deriveApiVersion({'minerInfo':_0x164d1a,'minerTyped':_0x7b7361});return getMinerReboot(_0x164d1a,_0x7b7361,_0x7e7336)['then'](_0x3e1e17=>{const _0x3e7325=_0x42f0bd;return _0x3e1e17?(_0x164d1a[_0x3e7325(0x174)]=null,_0x164d1a[_0x3e7325(0x17c)](),_0xb0dfea[_0x3e7325(0x146)](0xc8,{'Content-Type':_0x3e7325(0x153)}),_0xb0dfea[_0x3e7325(0x192)](JSON[_0x3e7325(0x147)]({'reboot':!![]}))):_0xb0dfea['sendStatus'](0x191);});});}),_0x30eea3[_0x4f0149(0x184)]('/hashrate-chart',function(_0x5215ed,_0x382d51,_0x1d367c){const _0x5042f6=_0x4f0149,{ipaddress:_0x173a0e}=_0x5215ed[_0x5042f6(0x1be)];if(!_0x5215ed[_0x5042f6(0x164)]||!_0x5215ed[_0x5042f6(0x164)]['id'])return _0x382d51[_0x5042f6(0x177)](_0x5042f6(0x1b8));Promise[_0x5042f6(0x161)]([_0x4e98e6[_0x5042f6(0x1bc)](_0x5215ed['accessToken']['userId']),getMinerInfo({'ipAddress':_0x173a0e})])[_0x5042f6(0x13a)](([_0x5b67bc,_0x2ed7ff])=>{const _0x1862fb=_0x5042f6;if(!_0x5b67bc)return _0x382d51[_0x1862fb(0x177)](_0x1862fb(0x1b8));if(!_0x2ed7ff)return console[_0x1862fb(0x17a)]('Hashrate\x20chart\x20lookup\x20failed',_0x5215ed[_0x1862fb(0x1be)]),![];if(!_0x2ed7ff[_0x1862fb(0x1d9)])return _0x382d51[_0x1862fb(0x181)](_0x1862fb(0x16b),{'points':JSON['stringify']([{'x':Date['now'],'y':0x2}])});const {fine:_0x1db7f2,hourly:_0x5d6965}=_0x2ed7ff[_0x1862fb(0x1d9)],_0x3b5649=_0x1db7f2[_0x1862fb(0x16f)](_0x5d6965);_0x382d51['render'](_0x1862fb(0x16b),{'points':JSON[_0x1862fb(0x147)](_0x3b5649)});});}),_0x30eea3[_0x4f0149(0x19e)](_0x4f0149(0x188),async function(_0x18503b,_0x1c73ce,_0x3a6fd9){const _0x5247a0=_0x4f0149,_0x345eff=await trendsAggregate(_0x18503b[_0x5247a0(0x1be)]);_0x1c73ce[_0x5247a0(0x17d)](_0x345eff);}),_0x30eea3[_0x4f0149(0x19e)](_0x4f0149(0x140),async(_0x2c7530,_0x1f4202)=>{const _0x54c09d=_0x4f0149;let {ipaddress:_0x58dc60,ipAddress:_0x93f131,ip:_0x4dc698,brand:_0x2d11e3}=_0x2c7530['query'];_0x93f131=_0x58dc60||_0x93f131||_0x4dc698;const _0x205c0e=await provisionMiner({'ipAddress':_0x93f131,'minerTyped':{'brand':_0x2d11e3}});_0x1f4202[_0x54c09d(0x17d)](_0x205c0e);}),_0x30eea3[_0x4f0149(0x19e)](_0x4f0149(0x1a1),async(_0x1df455,_0x22fa12)=>{const _0x4745a2=_0x4f0149;let {ipAddress:_0x35ee8a,ipaddress:_0x252a70,ip:_0x5cfcce,commands:commands='',brand:_0x5dd8af}=_0x1df455[_0x4745a2(0x1be)];_0x35ee8a=_0x252a70||_0x35ee8a||_0x5cfcce;commands&&(commands=commands['split'](/\s*,\s*/));const _0x24d677=_0x35ee8a?await checkMinerStates({'ipAddress':_0x35ee8a,'commands':commands,'brand':_0x5dd8af}):{'usage':_0x4745a2(0x1bb)};_0x22fa12[_0x4745a2(0x17d)](_0x24d677);}),_0x30eea3[_0x4f0149(0x19e)](_0x4f0149(0x1d5),async(_0x5d61ad,_0x1fbfb1)=>{const _0x5be2b5=_0x4f0149;let {ipAddress:_0x5ccb2e,ipaddress:_0x53b3e,ip:_0x475e07,brand:_0x30a3f4,user:_0x4b8fe5,username:_0x4f1bab,userName:_0x1b17b2,worker:_0x3ccb82,workerName:_0x3f0359,workername:_0x18bb57}=_0x5d61ad[_0x5be2b5(0x1be)];_0x5ccb2e=_0x53b3e||_0x5ccb2e||_0x475e07,_0x4f1bab=_0x4f1bab||_0x1b17b2||_0x4b8fe5,_0x3ccb82=_0x3ccb82||_0x18bb57||_0x3f0359;const _0x3ee183=_0x5ccb2e?await modifyMinerStates({'ipAddress':_0x5ccb2e,'brand':_0x30a3f4,'username':_0x4f1bab,'worker':_0x3ccb82}):{'usage':_0x5be2b5(0x1ba)};_0x1fbfb1['json'](_0x3ee183);}),_0x30eea3[_0x4f0149(0x19e)]('/scan',async(_0x2577bb,_0x361ccf)=>{const _0x4c84ab=_0x4f0149;let {dhcpSettings:_0x2ff521}=await _0x200a31[_0x4c84ab(0x18e)]();const {settings:_0x3cbf8e,mode:_0x175971,reset:_0x390457,help:_0x14b2f4}=_0x2577bb[_0x4c84ab(0x1be)];if(_0x3cbf8e||_0x14b2f4)try{const _0x19d147=JSON[_0x4c84ab(0x150)](_0x3cbf8e);_0x2ff521={..._0x2ff521,..._0x19d147};}catch(_0x31938a){return _0x361ccf[_0x4c84ab(0x17d)]({'not-parseable':_0x3cbf8e,'example':_0x4c84ab(0x1ca),'modes':[_0x4c84ab(0x155),_0x4c84ab(0x198),_0x4c84ab(0x16d),_0x4c84ab(0x1a7),_0x4c84ab(0x16c)],'error':{'message':_0x31938a[_0x4c84ab(0x156)],'stack':_0x31938a[_0x4c84ab(0x186)]}});}let _0x58c811;if(/discover/i[_0x4c84ab(0x1ad)](_0x175971))_0x58c811=await discoverMiners(_0x2ff521,/true/i[_0x4c84ab(0x1ad)](_0x390457),/http/i['test'](_0x175971));else/sync/i['test'](_0x175971)?_0x58c811=await compareMinerStatus(_0x2ff521,/true/i[_0x4c84ab(0x1ad)](_0x390457),/http/i['test'](_0x175971)):_0x58c811=await scanForMinerVersions(_0x2ff521,/true/i[_0x4c84ab(0x1ad)](_0x390457),/http/i[_0x4c84ab(0x1ad)](_0x175971));_0x361ccf[_0x4c84ab(0x17d)](_0x58c811);}),_0x30eea3[_0x4f0149(0x19e)](_0x4f0149(0x14e),async(_0x2c129a,_0x3eb777)=>{const _0x34a7d9=_0x4f0149,{ipaddress:_0x2faddb}=_0x2c129a[_0x34a7d9(0x1be)];let _0x3eaa79=await _0x4c2ff9[_0x34a7d9(0x18e)]({'where':{'ipAddress':_0x2faddb}});const _0x228a47=await syncMinerStatusJob(_0x3eaa79,Date[_0x34a7d9(0x150)](new Date()),!![]);_0x3eb777[_0x34a7d9(0x17d)](_0x228a47);}),_0x30eea3[_0x4f0149(0x19e)]('/broadcast-state',async(_0x153fd9,_0x2d524d)=>{const _0x2e91b1=_0x4f0149,_0x502db6=[_0x2e91b1(0x1b9),_0x2e91b1(0x18f),_0x2e91b1(0x195),_0x2e91b1(0x1a8)];let {mac:_0x4a2171,macAddress:_0x4e5043,macaddress:_0x303dfb,ip:_0x1a6b63,ipAddress:_0x4508fd,ipaddress:_0x46abb4,state:_0x5f28ff}=_0x153fd9[_0x2e91b1(0x1be)];(!_0x5f28ff||_0x502db6[_0x2e91b1(0x182)](_0x5f28ff)<0x0)&&_0x2d524d[_0x2e91b1(0x17d)]({'miner-state-not-found':_0x5f28ff,'example':_0x2e91b1(0x1b3),'available-states':_0x502db6});_0x1a6b63=_0x1a6b63||_0x4508fd||_0x46abb4,_0x4a2171=_0x4a2171||_0x4e5043||_0x303dfb;var _0x5603f6;if(_0x1a6b63&&_0x1a6b63['length'])_0x5603f6={'where':{'ipAddress':{'inq':_0x1a6b63['split'](/\s*,\s*/)}}};else _0x4a2171&&_0x4a2171[_0x2e91b1(0x1aa)]&&(_0x5603f6={'where':{'macAddress':{'inq':_0x4a2171[_0x2e91b1(0x13b)](/\s*,\s*/)}}});let _0x65710e=await _0x4c2ff9[_0x2e91b1(0x197)](_0x5603f6);socketSendMiners(_0x65710e,_0x5f28ff),_0x2d524d[_0x2e91b1(0x17d)]({'broadcastSuccessful':!![]});});};