/* Copyright (C) 9208-9721 Quebec, Inc - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
* Written by Jason Rudland <jason.g.rudland@gmail.com>, September 2022
*/'use strict';function _0x238b(){const _0x485e6b=['access_token','../utilities/net-scan','configured','hex','response','1499142PmKTAr','layout','/broadcast-state','miner-place-holder','then','cookie','3326980qyaDON','match','/miners','all','stack','6384553UZHfrC','synchttp','replace','sync','minerTypeMap','randomBytes','/tickets','/request-password-reset','Click\x20here','/prioritize-pools','state-check?ipAddress=192.x.x.x&brand=*override&commands=ALL,summary,pools,devs,stats,version,config,devdetails','logout','../../common/config.json','99.99.99.99','72147QAtKKr','/api/users/','test','priority','email','/reboot-miner','json','/state-modify','redirect','/upload','sort','../../common/utilities/miner-settings','find','macAddress','length','map','?settings={\x22range\x22:[\x22192.168.0.2\x22,\x22192.168.4.254\x22],\x22netmask\x22:\x22255.255.242.0\x22,\x22scanThrottleCount\x22:20}&mode=discoverhttp','render','17300144qQVfmX','100EIYWWE','../../common/models/user','keys','message','body','dataHall','Try\x20another\x20account','/scan','?ip=192.168.0.2,192.168.4.254&state=configured','stringify','accountName','poolIDs','../datasources.json','csv-parse/sync','positioned','/upload-miners','/miner-state','/login','application/json','split','writeHead','models','presets','Check\x20your\x20email\x20for\x20further\x20instructions','save','lodash','discover','title','1833368puxVVs','file','overclock','verified','frequencies','Reboot\x20miner\x20lookup\x20failed','/state-check','dataCenterSettings','resetPassword','log','upload-miners','details','validated','post','get','name','trends','clearCookie','provision','readdirSync','firmwareFolderPath','toUpperCase','auth','http','path','send','Hashrate\x20chart\x20lookup\x20failed','/hashrate-chart','/api/users/change-password','/verified','Antminer\x20','query','/api/users/reset-password','8094252JNLofU','/layout','substr','Inactive\x20account','now','userId','status','tickets','address','findOne','LOGIN_FAILED_EMAIL_NOT_VERIFIED','/verify','/reset-password','count','socketPort','home','../utilities/net-interfaces','login','single','user','password-reset','pool','findById',':$1','/provision','Try\x20login\x20again','toString','User','minerInfo','../../server/utilities/miner-proxy','password','miners','hashAlgorithm','Login\x20failed','proxyPort','/logout','buffer','code','voltages','chart','resolve','Contact\x20the\x20system\x20admmin\x20if\x20this\x20is\x20an\x20error','reponseToTriggerEmail','ttl','setting','accessToken','sendStatus','/miner-place-holder'];_0x238b=function(){return _0x485e6b;};return _0x238b();}const _0x303d03=_0x5843;(function(_0x4bf031,_0x31c53c){const _0x543a68=_0x5843,_0x197659=_0x4bf031();while(!![]){try{const _0x66d265=-parseInt(_0x543a68(0x1f7))/0x1+parseInt(_0x543a68(0x23f))/0x2+-parseInt(_0x543a68(0x210))/0x3*(parseInt(_0x543a68(0x223))/0x4)+-parseInt(_0x543a68(0x1fd))/0x5+parseInt(_0x543a68(0x1c2))/0x6+-parseInt(_0x543a68(0x202))/0x7+parseInt(_0x543a68(0x222))/0x8;if(_0x66d265===_0x31c53c)break;else _0x197659['push'](_0x197659['shift']());}catch(_0x46ab84){_0x197659['push'](_0x197659['shift']());}}}(_0x238b,0xb7342));function _0x5843(_0x42c806,_0x3f036a){const _0x238b07=_0x238b();return _0x5843=function(_0x58430d,_0x5338ce){_0x58430d=_0x58430d-0x1a4;let _0x36334a=_0x238b07[_0x58430d];return _0x36334a;},_0x5843(_0x42c806,_0x3f036a);}const _=require(_0x303d03(0x23c)),dsConfig=require(_0x303d03(0x22f)),{getLocalInterface}=require(_0x303d03(0x1d2)),path=require(_0x303d03(0x1b9)),multer=require('multer'),upload=multer(),config=require(_0x303d03(0x20e)),crypto=require('crypto'),{parse}=require(_0x303d03(0x230)),{getMinerReboot,deriveApiVersion,getMinerFilterClause,getMinerLayoutFields,getMinerInfo,getMinerType,getMinerTypeMap,checkMinerStates,modifyMinerStates,updateMinerInfo,trendsAggregate}=require(_0x303d03(0x21b)),{syncMinerStatusJob,discoverMiners,compareMinerStatus,socketSendMiners,provisionMiner}=require('../../server/utilities/provision-miner'),{scanForMinerVersions}=require(_0x303d03(0x1f3)),{registerProxy}=require(_0x303d03(0x1df)),fs=require('fs'),user=require(_0x303d03(0x224)),{minerTypeMap}=config;module['exports']=function(_0x3ba429){const _0x40b752=_0x303d03;var _0x48928b=_0x3ba429['models'][_0x40b752(0x1dd)],_0xa064a3=_0x3ba429[_0x40b752(0x238)][_0x40b752(0x1de)],_0x25cb3b=_0x3ba429[_0x40b752(0x238)][_0x40b752(0x1d7)],_0x2b8c71=_0x3ba429[_0x40b752(0x238)][_0x40b752(0x1a8)];_0x3ba429[_0x40b752(0x1af)]('/',function(_0x58d4b4,_0x4c2e0f){const _0x4c8b32=_0x40b752;if(!_0x58d4b4[_0x4c8b32(0x1ef)]||!_0x58d4b4[_0x4c8b32(0x1ef)]['id']){var _0x4b0fd5=dsConfig['emailDs']['transports'][0x0][_0x4c8b32(0x1b7)];return _0x4c2e0f[_0x4c8b32(0x221)](_0x4c8b32(0x1d3),{'email':_0x4b0fd5[_0x4c8b32(0x1d5)],'password':_0x4b0fd5['pass']});}const _0x4859d6=_0x58d4b4[_0x4c8b32(0x1c0)][_0x4c8b32(0x228)];Promise['all']([_0x48928b['findById'](_0x58d4b4[_0x4c8b32(0x1ef)][_0x4c8b32(0x1c7)])])['then'](([_0x1a1d2a])=>{const _0x259250=_0x4c8b32;if(!_0x1a1d2a)return _0x4c2e0f[_0x259250(0x221)](_0x259250(0x1d3),{'email':'','password':''});_0x4c2e0f['render'](_0x259250(0x1d1),{'email':_0x58d4b4[_0x259250(0x227)]['email'],'accessToken':_0x58d4b4['accessToken']['id'],'user':_0x1a1d2a,'webSocketHost':getLocalInterface()[_0x259250(0x1ca)]+':'+config[_0x259250(0x1d0)],'proxyPort':config[_0x259250(0x1e4)],'redirectUrl':_0x259250(0x1bd)});});}),_0x3ba429['get'](_0x40b752(0x1be),function(_0x336cb6,_0x2444fc){const _0x52fd61=_0x40b752;_0x2444fc[_0x52fd61(0x221)](_0x52fd61(0x1a4));}),_0x3ba429[_0x40b752(0x1ae)](_0x40b752(0x234),function(_0x5a9181,_0x3f9f8d){const _0x2a02b7=_0x40b752;_0x48928b[_0x2a02b7(0x1d3)]({'email':_0x5a9181[_0x2a02b7(0x227)]['email'],'password':_0x5a9181[_0x2a02b7(0x227)][_0x2a02b7(0x1e0)]},_0x2a02b7(0x1d5),function(_0x55ee11,_0x2e68f5){const _0x17e97b=_0x2a02b7;if(_0x55ee11){_0x55ee11['details']&&_0x55ee11[_0x17e97b(0x1e7)]===_0x17e97b(0x1cc)?_0x3f9f8d[_0x17e97b(0x221)](_0x17e97b(0x1ec),{'title':_0x17e97b(0x1e3),'content':_0x55ee11,'redirectToEmail':_0x17e97b(0x211)+_0x55ee11['details'][_0x17e97b(0x1c7)]+_0x17e97b(0x1cd),'redirectTo':'/','redirectToLinkText':_0x17e97b(0x20a),'userId':_0x55ee11[_0x17e97b(0x1ac)]['userId']}):_0x3f9f8d[_0x17e97b(0x221)](_0x17e97b(0x1f6),{'title':'Wrong\x20username\x20or\x20password','content':_0x55ee11,'redirectTo':'/','redirectToLinkText':_0x17e97b(0x1db)});return;}_0x3f9f8d[_0x17e97b(0x1fc)](_0x17e97b(0x1f2),_0x2e68f5['id'],{'signed':!![],'maxAge':_0x2e68f5[_0x17e97b(0x1ed)]*0x3e8}),Promise[_0x17e97b(0x200)]([_0x48928b[_0x17e97b(0x1d8)](_0x2e68f5[_0x17e97b(0x1c7)])])[_0x17e97b(0x1fb)](([_0x2d6c90])=>{const _0x3d343e=_0x17e97b;if(!_0x2d6c90[_0x3d343e(0x1ad)])return _0x3f9f8d[_0x3d343e(0x221)](_0x3d343e(0x1f6),{'title':_0x3d343e(0x1c5),'content':_0x3d343e(0x1eb),'redirectTo':'/','redirectToLinkText':_0x3d343e(0x229)});_0x3f9f8d[_0x3d343e(0x221)](_0x3d343e(0x1d1),{'email':_0x5a9181[_0x3d343e(0x227)]['email'],'accessToken':_0x2e68f5['id'],'user':_0x2d6c90,'webSocketHost':getLocalInterface()[_0x3d343e(0x1ca)]+':'+config[_0x3d343e(0x1d0)],'proxyPort':config[_0x3d343e(0x1e4)],'redirectUrl':_0x3d343e(0x1bd)});});});}),_0x3ba429[_0x40b752(0x1af)](_0x40b752(0x1e5),function(_0x40d642,_0x8b787f,_0xa7af77){const _0x20dd13=_0x40b752;_0x40d642[_0x20dd13(0x1ef)]&&_0x40d642[_0x20dd13(0x1ef)]['id']?_0x48928b[_0x20dd13(0x20d)](_0x40d642[_0x20dd13(0x1ef)]['id'],function(_0x5884ad){const _0x4a175d=_0x20dd13;if(_0x5884ad)return _0xa7af77(_0x5884ad);_0x8b787f[_0x4a175d(0x1b2)](_0x4a175d(0x1f2)),_0x8b787f['redirect']('/');}):(_0x8b787f[_0x20dd13(0x1b2)](_0x20dd13(0x1f2)),_0x8b787f['redirect']('/'));}),_0x3ba429['post'](_0x40b752(0x209),function(_0x38055b,_0x70dc12,_0x2e257b){const _0x3223c2=_0x40b752;_0x48928b[_0x3223c2(0x1a9)]({'email':_0x38055b[_0x3223c2(0x227)][_0x3223c2(0x214)]},function(_0x286abe){const _0x2c68a6=_0x3223c2;if(_0x286abe)return _0x70dc12[_0x2c68a6(0x1c8)](0x191)[_0x2c68a6(0x1ba)](_0x286abe);_0x70dc12[_0x2c68a6(0x221)](_0x2c68a6(0x1f6),{'title':'Password\x20reset\x20requested','content':_0x2c68a6(0x23a),'redirectTo':'/','redirectToLinkText':'Log\x20in'});});}),_0x3ba429['get'](_0x40b752(0x1ce),function(_0x442ffc,_0x2ca4d9,_0x54f959){const _0x2093bf=_0x40b752;_0x2ca4d9[_0x2093bf(0x221)](_0x2093bf(0x1d6),{'redirectUrl':_0x2093bf(0x1c1)});}),_0x3ba429[_0x40b752(0x1af)](_0x40b752(0x1ff),function(_0xda2dd1,_0x47f775,_0x11c8ef){const _0x12b2f5=_0x40b752;if(!_0xda2dd1[_0x12b2f5(0x1ef)]||!_0xda2dd1[_0x12b2f5(0x1ef)]['id'])return _0x47f775[_0x12b2f5(0x218)](_0x12b2f5(0x1e5));Promise['all']([_0x48928b[_0x12b2f5(0x1d8)](_0xda2dd1[_0x12b2f5(0x1ef)][_0x12b2f5(0x1c7)])])[_0x12b2f5(0x1fb)](([_0x32a807])=>{const _0x26c2a8=_0x12b2f5;let _0x41e0e6=getMinerFilterClause(_0x32a807);return Promise[_0x26c2a8(0x200)]([_0xa064a3['find'](_0x41e0e6)]);})[_0x12b2f5(0x1fb)](([_0x25272a])=>{const _0x3847b9=_0x12b2f5;_0x25272a['forEach'](_0x16c6d7=>{let {workerName:_0x2e561c,accountName:_0x5e774c,macAddress:_0xd5bb69,ipAddress:_0x2c9ffc,apiVersion:_0x47c2e4}=_0x16c6d7;registerProxy({'workerName':_0x2e561c,'accountName':_0x5e774c,'macAddress':_0xd5bb69,'ipAddress':_0x2c9ffc,'minerTyped':getMinerTypeMap(_0x16c6d7),'apiVersion':_0x47c2e4});}),_0x47f775[_0x3847b9(0x221)](_0x3847b9(0x1e1),{'minerInfos':_0x25272a,'minerTypeMap':minerTypeMap,'accessToken':_0xda2dd1[_0x3847b9(0x1ef)]['id'],'proxyPort':config[_0x3847b9(0x1e4)],'webSocketHost':getLocalInterface()['address']+':'+config[_0x3847b9(0x1d0)]});});}),_0x3ba429[_0x40b752(0x1af)](_0x40b752(0x1c3),function(_0x4e3b1f,_0x52b7db,_0x383783){const _0xc6eaaf=_0x40b752;if(!_0x4e3b1f['accessToken']||!_0x4e3b1f['accessToken']['id'])return _0x52b7db['redirect'](_0xc6eaaf(0x1e5));const _0x5f0b4d=_0x4e3b1f['query'][_0xc6eaaf(0x228)];Promise[_0xc6eaaf(0x200)]([_0x48928b['findById'](_0x4e3b1f[_0xc6eaaf(0x1ef)][_0xc6eaaf(0x1c7)])])[_0xc6eaaf(0x1fb)](([_0x5af5c6])=>{const _0x40f0b1=_0xc6eaaf;let _0x138f5e=getMinerFilterClause(_0x5af5c6);return Promise[_0x40f0b1(0x200)]([getMinerLayoutFields(_0x138f5e)]);})['then'](([_0x5d51e9])=>{const _0xf5aefe=_0xc6eaaf;_0x52b7db[_0xf5aefe(0x221)](_0xf5aefe(0x1f8),{'minerInfos':_0x5d51e9,'minerTypeMap':minerTypeMap,'dataHall':_0x5f0b4d,'accessToken':_0x4e3b1f['accessToken']['id'],'proxyPort':config[_0xf5aefe(0x1e4)],'webSocketHost':getLocalInterface()[_0xf5aefe(0x1ca)]+':'+config['socketPort']});});}),_0x3ba429['get'](_0x40b752(0x208),function(_0x271d05,_0x15ee1c,_0x77abd5){const _0x581336=_0x40b752;if(!_0x271d05[_0x581336(0x1ef)]||!_0x271d05[_0x581336(0x1ef)]['id'])return _0x15ee1c[_0x581336(0x218)](_0x581336(0x1e5));const _0x5638b9=_0x271d05['query'][_0x581336(0x21d)];Promise['all']([_0xa064a3[_0x581336(0x21c)]({'macAddress':_0x5638b9})])[_0x581336(0x1fb)](([_0x1f1c6e])=>{const _0x4ddbb0=_0x581336;_0x15ee1c['render'](_0x4ddbb0(0x1c9),{'minerInfos':_0x1f1c6e,'proxyPort':config[_0x4ddbb0(0x1e4)]});});}),_0x3ba429[_0x40b752(0x1ae)]('/ticket',function(_0x12773e,_0xbda9a3,_0x102a7d){const _0x171faf=_0x40b752;Promise[_0x171faf(0x200)]([_0xa064a3[_0x171faf(0x21c)]()])[_0x171faf(0x1fb)](([_0x23696e])=>{const _0x3e90d7=_0x171faf;_0xbda9a3[_0x3e90d7(0x221)]('tickets',{'minerInfos':_0x23696e,'accessToken':_0x12773e[_0x3e90d7(0x1ef)]['id'],'proxyPort':config[_0x3e90d7(0x1e4)]});});}),_0x3ba429['get'](_0x40b752(0x1da),function(_0x292c3c,_0x563af3,_0xc0c4da){const _0x4dd753=_0x40b752;if(!_0x292c3c['accessToken']||!_0x292c3c[_0x4dd753(0x1ef)]['id'])return _0x563af3['redirect'](_0x4dd753(0x1e5));const _0x5057d3=_0x292c3c[_0x4dd753(0x1c0)][_0x4dd753(0x228)];Promise[_0x4dd753(0x200)]([_0x48928b[_0x4dd753(0x1d8)](_0x292c3c[_0x4dd753(0x1ef)]['userId'])])[_0x4dd753(0x1fb)](([_0x452ecc])=>{const _0x59a8ee=_0x4dd753;let _0xcf1bec=getMinerFilterClause(_0x452ecc);return Promise['all']([_0x2b8c71['findOne']({'active':!![]}),_0xa064a3[_0x59a8ee(0x21c)](_0xcf1bec),_0x452ecc]);})[_0x4dd753(0x1fb)](([_0x5d0d24,_0x54b83e,_0x19f34a])=>{const _0x1634e3=_0x4dd753;_0x563af3[_0x1634e3(0x221)](_0x1634e3(0x1b3),{'minerTypeMap':config[_0x1634e3(0x206)],'email':_0x292c3c['body'][_0x1634e3(0x214)],'dataCenterSettings':_0x5d0d24,'minerInfos':_0x54b83e,'dataHall':_0x5057d3,'accessToken':_0x292c3c['accessToken']['id'],'user':_0x19f34a,'proxyPort':config['proxyPort'],'webSocketHost':getLocalInterface()['address']+':'+config[_0x1634e3(0x1d0)]});});}),_0x3ba429[_0x40b752(0x1ae)]('/bulk-provision',function(_0x231975,_0x3dc022,_0x3c1137){const _0x6b816f=_0x40b752,_0x5dbfe0=_0x231975['body']['ipAddresses']||[],_0x3897d3=_0x231975[_0x6b816f(0x227)][_0x6b816f(0x1e2)],_0x4391d6=_0x231975[_0x6b816f(0x227)][_0x6b816f(0x22d)]||'',_0x2d7ab8=_0x231975[_0x6b816f(0x227)]['minerType']||'';let _0xd3005e={};_0x3897d3&&(_0xd3005e={'where':{'hashAlgorithm':_0x3897d3},'order':[_0x6b816f(0x1e2),_0x6b816f(0x213)]});const _0x43c77e=path[_0x6b816f(0x1ea)](global[_0x6b816f(0x1b5)]);let _0x58bef2=fs[_0x6b816f(0x1b4)](_0x43c77e),_0x542128=[],_0x3366c5=[],_0x58afc2=[];if(_0x2d7ab8){let _0x7c37ee=new RegExp(_0x2d7ab8,'i');_0x4391d6=='antminer'&&(_0x7c37ee=new RegExp(_0x2d7ab8[_0x6b816f(0x1c4)](0x1),'i'));_0x58bef2=_0x58bef2['filter'](_0x54ff70=>_0x7c37ee['test'](_0x54ff70));const _0x5eeaab=_0x6b816f(0x1bf)+_0x2d7ab8[_0x6b816f(0x1fe)](/(\w\d+)/)[0x1],_0x508dbd=getMinerTypeMap({'minerType':_0x5eeaab});_0x508dbd&&_0x508dbd[_0x6b816f(0x241)]&&_0x508dbd[_0x6b816f(0x241)][_0x6b816f(0x1a5)]&&(_0x542128=_0x508dbd['overclock']['frequencies']||[],_0x3366c5=_0x508dbd[_0x6b816f(0x241)][_0x6b816f(0x1e8)]||[],_0x58afc2=_0x508dbd[_0x6b816f(0x241)][_0x6b816f(0x239)]||[]);}Promise['all']([_0x25cb3b[_0x6b816f(0x21c)](_0xd3005e),_0x48928b[_0x6b816f(0x1d8)](_0x231975[_0x6b816f(0x1ef)]['userId']),_0xa064a3[_0x6b816f(0x21c)]({'where':{'ipAddress':_0x5dbfe0[0x0]}})])[_0x6b816f(0x1fb)](([_0x2f2c9b,_0x47df99,_0x390759])=>{const _0x493341=_0x6b816f;_0x3dc022[_0x493341(0x221)]('bulk-provision',{'pools':_0x2f2c9b[_0x493341(0x21a)]((_0x4ff770,_0x485d07)=>_0x4ff770['name']>_0x485d07[_0x493341(0x1b0)]?0x1:-0x1),'user':_0x47df99,'accountName':_0x4391d6,'ipAddresses':_0x5dbfe0,'accessToken':_0x231975['accessToken']['id'],'files':_0x58bef2,'frequencies':_0x542128,'voltages':_0x3366c5,'presets':_0x58afc2,'poolIDs':_0x390759[0x0]?_0x390759[0x0][_0x493341(0x22e)]||[]:[]});});}),_0x3ba429[_0x40b752(0x1af)](_0x40b752(0x232),function(_0x4af196,_0x248dbb,_0x352f8c){const _0x292410=_0x40b752;Promise[_0x292410(0x200)]([_0x48928b[_0x292410(0x1d8)](_0x4af196[_0x292410(0x1ef)][_0x292410(0x1c7)])])[_0x292410(0x1fb)](([_0x324d7c])=>{const _0xd5a3bb=_0x292410;_0x248dbb[_0xd5a3bb(0x221)](_0xd5a3bb(0x1ab),{'user':_0x324d7c,'accessToken':_0x4af196['accessToken']['id']});});}),_0x3ba429[_0x40b752(0x1ae)](_0x40b752(0x219),upload[_0x40b752(0x1d4)](_0x40b752(0x240)),function(_0x96fa41,_0x372cf9){const _0x28d339=_0x40b752,_0x320451=_0x96fa41[_0x28d339(0x227)][_0x28d339(0x23e)],_0x16ed69=_0x96fa41[_0x28d339(0x240)],_0x44830c=_0x16ed69[_0x28d339(0x1e6)][_0x28d339(0x1dc)]();try{const _0x4b2c1b=parse(_0x44830c,{'columns':!![],'trim':!![],'skip_empty_lines':!![]});let _0x2677a1=Object[_0x28d339(0x225)](_0x4b2c1b[0x0])[_0x28d339(0x21c)](_0x4b251a=>/key\([^\)]+\)/[_0x28d339(0x212)](_0x4b251a)),_0x40b577=_0x28d339(0x21d);!_0x2677a1?_0x2677a1=_0x28d339(0x21d):_0x40b577=_0x2677a1[_0x28d339(0x1fe)](/key\(([^\)]+)\)/)[0x1],_0x4b2c1b[_0x28d339(0x21f)](async _0x5177fe=>{updateMinerInfo({'record':_0x5177fe,'keyField':_0x40b577,'keyFieldName':_0x2677a1});}),_0x372cf9['sendStatus'](0xc8);}catch(_0x147a63){_0x372cf9[_0x28d339(0x1ba)](0x1f4,_0x147a63);}}),_0x3ba429['get'](_0x40b752(0x20b),function(_0x49f6d5,_0x57d744,_0x34a433){const _0x517c82=_0x40b752;Promise[_0x517c82(0x200)]([_0x25cb3b[_0x517c82(0x21c)]({'order':[_0x517c82(0x1e2),_0x517c82(0x213),_0x517c82(0x1b0)]}),_0x48928b[_0x517c82(0x1d8)](_0x49f6d5['accessToken'][_0x517c82(0x1c7)])])['then'](([_0x394e86,_0x4dcc9d])=>{const _0x49c854=_0x517c82;_0x57d744[_0x49c854(0x221)]('prioritize-pools',{'pools':_0x394e86,'user':_0x4dcc9d,'accessToken':_0x49f6d5[_0x49c854(0x1ef)]['id']});});}),_0x3ba429[_0x40b752(0x1af)](_0x40b752(0x1f1),function(_0x535028,_0x45f79b,_0x5532f9){const _0x4c08b7=_0x40b752,_0x59407e=_0x4c08b7(0x20f);function _0x10bfef(_0x3a5668){const _0x5c79ee=_0x4c08b7;return((_0x3a5668||'')+'ZZ')[_0x5c79ee(0x1c4)](0x0,0x2)+crypto[_0x5c79ee(0x207)](0x5)[_0x5c79ee(0x1dc)](_0x5c79ee(0x1f5))[_0x5c79ee(0x1b6)]()[_0x5c79ee(0x204)](/(.{2})/g,_0x5c79ee(0x1d9));}let _0x2fae6f=_0x10bfef('ZZ');Promise[_0x4c08b7(0x200)]([_0xa064a3[_0x4c08b7(0x21c)]({'where':{'macAddress':{'regexp':/^ZZ:/}}}),_0xa064a3[_0x4c08b7(0x1cf)]({'macAddress':_0x2fae6f})])[_0x4c08b7(0x1fb)](([_0x507017,_0x4cbf84])=>{const _0xaf558f=_0x4c08b7;if(_0x4cbf84){const _0x52b2a5=_['indexBy'](_0x507017,_0xaf558f(0x21d));do{_0x2fae6f=_0x10bfef('ZZ');}while(!_0x52b2a5[_0x2fae6f]);}_0x45f79b[_0xaf558f(0x221)](_0xaf558f(0x1fa),{'minerTypeMap':config[_0xaf558f(0x206)],'macAddress':_0x2fae6f,'ipAddress':_0x59407e});});}),_0x3ba429['get'](_0x40b752(0x215),function(_0x1baa8e,_0x1d5308,_0x2dcee8){const _0x2ae9a2=_0x40b752,{ipaddress:_0x1bce87}=_0x1baa8e[_0x2ae9a2(0x1c0)];Promise[_0x2ae9a2(0x200)]([_0x48928b[_0x2ae9a2(0x1d8)](_0x1baa8e[_0x2ae9a2(0x1ef)]['userId']),getMinerInfo({'ipAddress':_0x1bce87})])['then'](([_0x1f01e4,_0x565413])=>{const _0x3f6ea9=_0x2ae9a2;if(!_0x565413)return console[_0x3f6ea9(0x1aa)](_0x3f6ea9(0x1a6),_0x1baa8e['query']),![];const _0x16c7ee=getMinerTypeMap(_0x565413),_0x5d67ee=deriveApiVersion({'minerInfo':_0x565413,'minerTyped':_0x16c7ee});return getMinerReboot(_0x565413,_0x16c7ee,_0x5d67ee)['then'](_0x8500bd=>{const _0x3fd9da=_0x3f6ea9;return _0x8500bd?(_0x565413['conditionPrime']=null,_0x565413[_0x3fd9da(0x23b)](),_0x1d5308[_0x3fd9da(0x237)](0xc8,{'Content-Type':_0x3fd9da(0x235)}),_0x1d5308['end'](JSON['stringify']({'reboot':!![]}))):_0x1d5308[_0x3fd9da(0x1f0)](0x191);});});}),_0x3ba429[_0x40b752(0x1ae)](_0x40b752(0x1bc),function(_0x58a07d,_0x2e89f7,_0x18b98a){const _0x4af20d=_0x40b752,{ipaddress:_0xbd3580}=_0x58a07d[_0x4af20d(0x1c0)];if(!_0x58a07d[_0x4af20d(0x1ef)]||!_0x58a07d[_0x4af20d(0x1ef)]['id'])return _0x2e89f7[_0x4af20d(0x218)](_0x4af20d(0x1e5));Promise['all']([_0x48928b[_0x4af20d(0x1d8)](_0x58a07d['accessToken'][_0x4af20d(0x1c7)]),getMinerInfo({'ipAddress':_0xbd3580})])[_0x4af20d(0x1fb)](([_0x1fbfa4,_0x3bc730])=>{const _0x4ce8fe=_0x4af20d;if(!_0x1fbfa4)return _0x2e89f7[_0x4ce8fe(0x218)](_0x4ce8fe(0x1e5));if(!_0x3bc730)return console[_0x4ce8fe(0x1aa)](_0x4ce8fe(0x1bb),_0x58a07d[_0x4ce8fe(0x1c0)]),![];if(!_0x3bc730[_0x4ce8fe(0x1b1)])return _0x2e89f7['render'](_0x4ce8fe(0x1e9),{'points':JSON['stringify']([{'x':Date[_0x4ce8fe(0x1c6)],'y':0x2}])});const {fine:_0x484885,hourly:_0x3c56e4}=_0x3bc730[_0x4ce8fe(0x1b1)],_0x22e860=_0x484885['concat'](_0x3c56e4);_0x2e89f7[_0x4ce8fe(0x221)](_0x4ce8fe(0x1e9),{'points':JSON[_0x4ce8fe(0x22c)](_0x22e860)});});}),_0x3ba429[_0x40b752(0x1af)]('/trends',async function(_0x3d4cc5,_0x42cb06,_0x44d62b){const _0x584062=_0x40b752,_0x9e539d=await trendsAggregate(_0x3d4cc5['query']);_0x42cb06[_0x584062(0x216)](_0x9e539d);}),_0x3ba429[_0x40b752(0x1af)]('/provision-miner',async(_0x44a75c,_0x33286f)=>{const _0x5a6ad6=_0x40b752;let {ipaddress:_0x14c23d,ipAddress:_0x377069,ip:_0xef2ce,brand:_0x393155}=_0x44a75c[_0x5a6ad6(0x1c0)];_0x377069=_0x14c23d||_0x377069||_0xef2ce;const _0x508901=await provisionMiner({'ipAddress':_0x377069,'minerTyped':{'brand':_0x393155}});_0x33286f[_0x5a6ad6(0x216)](_0x508901);}),_0x3ba429[_0x40b752(0x1af)](_0x40b752(0x1a7),async(_0x1a8c56,_0x30a9cf)=>{const _0x3a6d70=_0x40b752;let {ipAddress:_0x45e247,ipaddress:_0x488bcd,ip:_0x1fdb18,commands:commands='',brand:_0x239fe4}=_0x1a8c56[_0x3a6d70(0x1c0)];_0x45e247=_0x488bcd||_0x45e247||_0x1fdb18;commands&&(commands=commands['split'](/\s*,\s*/));const _0x1d0469=_0x45e247?await checkMinerStates({'ipAddress':_0x45e247,'commands':commands,'brand':_0x239fe4}):{'usage':_0x3a6d70(0x20c)};_0x30a9cf[_0x3a6d70(0x216)](_0x1d0469);}),_0x3ba429[_0x40b752(0x1af)](_0x40b752(0x217),async(_0x48e702,_0x2b3617)=>{const _0x46cbe9=_0x40b752;let {ipAddress:_0x4b1d66,ipaddress:_0x1a366a,ip:_0x594e65,brand:_0x38a49f,user:_0x3edfc2,username:_0x14d405,userName:_0x1ad899,worker:_0x78dc77,workerName:_0x392f22,workername:_0x73c69b}=_0x48e702['query'];_0x4b1d66=_0x1a366a||_0x4b1d66||_0x594e65,_0x14d405=_0x14d405||_0x1ad899||_0x3edfc2,_0x78dc77=_0x78dc77||_0x73c69b||_0x392f22;const _0x5e0a7b=_0x4b1d66?await modifyMinerStates({'ipAddress':_0x4b1d66,'brand':_0x38a49f,'username':_0x14d405,'worker':_0x78dc77}):{'usage':'?ipAddress=192.x.x.x&brand=Whatsminer&username=mineops&worker=S19DBD001'};_0x2b3617[_0x46cbe9(0x216)](_0x5e0a7b);}),_0x3ba429['get'](_0x40b752(0x22a),async(_0x12cb2a,_0x33dad6)=>{const _0x24172f=_0x40b752;let {dhcpSettings:_0x51d0a0}=await _0x2b8c71['findOne']();const {settings:_0x45c33d,mode:_0x33d6b0,reset:_0x55d214,help:_0x858041}=_0x12cb2a[_0x24172f(0x1c0)];if(_0x45c33d||_0x858041)try{const _0x2fae0c=JSON['parse'](_0x45c33d);_0x51d0a0={..._0x51d0a0,..._0x2fae0c};}catch(_0x338475){return _0x33dad6['json']({'not-parseable':_0x45c33d,'example':_0x24172f(0x220),'modes':[_0x24172f(0x23d),_0x24172f(0x205),_0x24172f(0x1b8),'discoverhttp',_0x24172f(0x203)],'error':{'message':_0x338475[_0x24172f(0x226)],'stack':_0x338475[_0x24172f(0x201)]}});}let _0x478194;if(/discover/i[_0x24172f(0x212)](_0x33d6b0))_0x478194=await discoverMiners(_0x51d0a0,/true/i[_0x24172f(0x212)](_0x55d214),/http/i[_0x24172f(0x212)](_0x33d6b0));else/sync/i[_0x24172f(0x212)](_0x33d6b0)?_0x478194=await compareMinerStatus(_0x51d0a0,/true/i[_0x24172f(0x212)](_0x55d214),/http/i[_0x24172f(0x212)](_0x33d6b0)):_0x478194=await scanForMinerVersions(_0x51d0a0,/true/i[_0x24172f(0x212)](_0x55d214),/http/i[_0x24172f(0x212)](_0x33d6b0));_0x33dad6[_0x24172f(0x216)](_0x478194);}),_0x3ba429[_0x40b752(0x1af)](_0x40b752(0x233),async(_0x2308a0,_0x127f19)=>{const _0x5435d2=_0x40b752,{ipaddress:_0x23c7fb}=_0x2308a0[_0x5435d2(0x1c0)];let _0x4d6d3e=await _0xa064a3[_0x5435d2(0x1cb)]({'where':{'ipAddress':_0x23c7fb}});const _0xa242df=await syncMinerStatusJob(_0x4d6d3e,Date['parse'](new Date()),!![]);_0x127f19[_0x5435d2(0x216)](_0xa242df);}),_0x3ba429[_0x40b752(0x1af)](_0x40b752(0x1f9),async(_0x475e61,_0xd941f5)=>{const _0x52473a=_0x40b752,_0x1617e8=['discovered',_0x52473a(0x1ee),_0x52473a(0x1f4),_0x52473a(0x231)];let {mac:_0x2819c5,macAddress:_0x2b0a18,macaddress:_0x3a302b,ip:_0x9c6191,ipAddress:_0x2cf55c,ipaddress:_0x4927a1,state:_0x3ce16c}=_0x475e61['query'];(!_0x3ce16c||_0x1617e8['indexOf'](_0x3ce16c)<0x0)&&_0xd941f5[_0x52473a(0x216)]({'miner-state-not-found':_0x3ce16c,'example':_0x52473a(0x22b),'available-states':_0x1617e8});_0x9c6191=_0x9c6191||_0x2cf55c||_0x4927a1,_0x2819c5=_0x2819c5||_0x2b0a18||_0x3a302b;var _0x1f498d;if(_0x9c6191&&_0x9c6191[_0x52473a(0x21e)])_0x1f498d={'where':{'ipAddress':{'inq':_0x9c6191[_0x52473a(0x236)](/\s*,\s*/)}}};else _0x2819c5&&_0x2819c5[_0x52473a(0x21e)]&&(_0x1f498d={'where':{'macAddress':{'inq':_0x2819c5[_0x52473a(0x236)](/\s*,\s*/)}}});let _0x3b727b=await _0xa064a3[_0x52473a(0x21c)](_0x1f498d);socketSendMiners(_0x3b727b,_0x3ce16c),_0xd941f5[_0x52473a(0x216)]({'broadcastSuccessful':!![]});});};