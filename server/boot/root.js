/* Copyright (C) 9208-9721 Quebec, Inc - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
* Written by Jason Rudland <jason.g.rudland@gmail.com>, September 2022
*/'use strict';function _0x5b23(){const _0x1be1e6=['../../server/utilities/provision-miner','concat','auth','../../server/utilities/miner-proxy','76890HthFAa','/tickets','../utilities/net-scan','/upload','Password\x20reset\x20requested','layout','ipAddresses','substr','body','LOGIN_FAILED_EMAIL_NOT_VERIFIED','sendStatus','length','parse','setting','resetPassword','/state-modify','frequencies','application/json','send','/api/users/','trends','findById','redirect','Inactive\x20account','/verify','poolIDs','363412lagRzz','minerInfo','verified','response','user','/trends','reponseToTriggerEmail','/verified','/hashrate-chart','overclock','/miner-place-holder','chart','login','discoverhttp','dataHall','sort','access_token','single','message','password','all','sync','log','userId','home','hex','1979782oNawuj','/miners','hashAlgorithm','antminer','render','path','../utilities/net-interfaces','/api/users/reset-password','/provision','Antminer\x20','randomBytes','accessToken','/miner-state','validated','miners','/logout','cookie','../datasources.json','578073QwrPLH','priority','match','then','2QZjley','693MeytRv','synchttp','get','bulk-provision','state-check?ipAddress=192.x.x.x&brand=*override&commands=ALL,summary,pools,devs,stats,version,config,devdetails','filter','indexOf','emailDs','proxyPort','file','findOne','pool','discovered','test','miner-place-holder','clearCookie','code','replace','save','toString','Wrong\x20username\x20or\x20password','99.99.99.99','conditionPrime','/layout','stringify','address','/broadcast-state','post','http','socketPort','Try\x20login\x20again','15oTRKGs','forEach','find','json','dataCenterSettings','macAddress','voltages','/provision-miner','529492nkoMKG','writeHead','lodash','Check\x20your\x20email\x20for\x20further\x20instructions','csv-parse/sync','857142IKzOTs','toUpperCase','/login','models','1987866ZHqmJv','/api/users/change-password','../../common/utilities/miner-settings','details','multer','readdirSync','/bulk-provision','?ip=192.168.0.2,192.168.4.254&state=configured','now','Contact\x20the\x20system\x20admmin\x20if\x20this\x20is\x20an\x20error','pass','split','accountName','query','name','email','transports','minerTypeMap','/scan','/upload-miners','/reset-password','16chlOet'];_0x5b23=function(){return _0x1be1e6;};return _0x5b23();}function _0x4f41(_0x4dadf5,_0x42e3d1){const _0x5b23b0=_0x5b23();return _0x4f41=function(_0x4f4160,_0x100ebd){_0x4f4160=_0x4f4160-0x174;let _0x18687e=_0x5b23b0[_0x4f4160];return _0x18687e;},_0x4f41(_0x4dadf5,_0x42e3d1);}const _0x45803d=_0x4f41;(function(_0x2546b5,_0x172920){const _0x2d2d88=_0x4f41,_0x93a08e=_0x2546b5();while(!![]){try{const _0x369470=parseInt(_0x2d2d88(0x1f1))/0x1+-parseInt(_0x2d2d88(0x18c))/0x2*(parseInt(_0x2d2d88(0x188))/0x3)+parseInt(_0x2d2d88(0x1b4))/0x4*(-parseInt(_0x2d2d88(0x1ac))/0x5)+-parseInt(_0x2d2d88(0x1b9))/0x6+-parseInt(_0x2d2d88(0x176))/0x7+-parseInt(_0x2d2d88(0x1d2))/0x8*(-parseInt(_0x2d2d88(0x1bd))/0x9)+parseInt(_0x2d2d88(0x1d7))/0xa*(parseInt(_0x2d2d88(0x18d))/0xb);if(_0x369470===_0x172920)break;else _0x93a08e['push'](_0x93a08e['shift']());}catch(_0x2dfcf6){_0x93a08e['push'](_0x93a08e['shift']());}}}(_0x5b23,0x42e9a));const _=require(_0x45803d(0x1b6)),dsConfig=require(_0x45803d(0x187)),{getLocalInterface}=require(_0x45803d(0x17c)),path=require(_0x45803d(0x17b)),multer=require(_0x45803d(0x1c1)),upload=multer(),config=require('../../common/config.json'),crypto=require('crypto'),{parse}=require(_0x45803d(0x1b8)),{getMinerReboot,deriveApiVersion,getMinerFilterClause,getMinerLayoutFields,getMinerInfo,getMinerType,getMinerTypeMap,checkMinerStates,modifyMinerStates,updateMinerInfo,trendsAggregate}=require(_0x45803d(0x1bf)),{syncMinerStatusJob,discoverMiners,compareMinerStatus,socketSendMiners,provisionMiner}=require(_0x45803d(0x1d3)),{scanForMinerVersions}=require(_0x45803d(0x1d9)),{registerProxy}=require(_0x45803d(0x1d6)),fs=require('fs'),user=require('../../common/models/user'),{minerTypeMap}=config;module['exports']=function(_0x619b85){const _0x437496=_0x45803d;var _0x4968a6=_0x619b85[_0x437496(0x1bc)]['User'],_0x502df7=_0x619b85['models'][_0x437496(0x1f2)],_0xce33b4=_0x619b85[_0x437496(0x1bc)][_0x437496(0x198)],_0x1cb080=_0x619b85[_0x437496(0x1bc)][_0x437496(0x1b0)];_0x619b85[_0x437496(0x18f)]('/',function(_0x9064a4,_0x5bdf39){const _0x10de4f=_0x437496;if(!_0x9064a4[_0x10de4f(0x181)]||!_0x9064a4[_0x10de4f(0x181)]['id']){var _0x77f18f=dsConfig[_0x10de4f(0x194)][_0x10de4f(0x1cd)][0x0][_0x10de4f(0x1d5)];return _0x5bdf39['render']('login',{'email':_0x77f18f[_0x10de4f(0x1f5)],'password':_0x77f18f[_0x10de4f(0x1c7)]});}const _0x2b15b4=_0x9064a4['query'][_0x10de4f(0x1ff)];Promise[_0x10de4f(0x205)]([_0x4968a6[_0x10de4f(0x1ec)](_0x9064a4[_0x10de4f(0x181)][_0x10de4f(0x208)])])['then'](([_0xfe8635])=>{const _0x591e7f=_0x10de4f;if(!_0xfe8635)return _0x5bdf39[_0x591e7f(0x17a)](_0x591e7f(0x1fd),{'email':'','password':''});_0x5bdf39[_0x591e7f(0x17a)](_0x591e7f(0x174),{'email':_0x9064a4[_0x591e7f(0x1df)][_0x591e7f(0x1cc)],'accessToken':_0x9064a4['accessToken']['id'],'user':_0xfe8635,'webSocketHost':getLocalInterface()[_0x591e7f(0x1a6)]+':'+config[_0x591e7f(0x1aa)],'proxyPort':config[_0x591e7f(0x195)],'redirectUrl':_0x591e7f(0x1be)});});}),_0x619b85['get'](_0x437496(0x1f8),function(_0x3b1624,_0x13e312){const _0x139ab0=_0x437496;_0x13e312[_0x139ab0(0x17a)](_0x139ab0(0x1f3));}),_0x619b85[_0x437496(0x1a8)](_0x437496(0x1bb),function(_0x482644,_0x5274aa){const _0xcd3333=_0x437496;_0x4968a6[_0xcd3333(0x1fd)]({'email':_0x482644[_0xcd3333(0x1df)][_0xcd3333(0x1cc)],'password':_0x482644['body'][_0xcd3333(0x204)]},_0xcd3333(0x1f5),function(_0x4b7b23,_0x31924c){const _0x4ad09a=_0xcd3333;if(_0x4b7b23){_0x4b7b23['details']&&_0x4b7b23[_0x4ad09a(0x19d)]===_0x4ad09a(0x1e0)?_0x5274aa[_0x4ad09a(0x17a)](_0x4ad09a(0x1f7),{'title':'Login\x20failed','content':_0x4b7b23,'redirectToEmail':_0x4ad09a(0x1ea)+_0x4b7b23[_0x4ad09a(0x1c0)][_0x4ad09a(0x208)]+_0x4ad09a(0x1ef),'redirectTo':'/','redirectToLinkText':'Click\x20here','userId':_0x4b7b23[_0x4ad09a(0x1c0)][_0x4ad09a(0x208)]}):_0x5274aa[_0x4ad09a(0x17a)](_0x4ad09a(0x1f4),{'title':_0x4ad09a(0x1a1),'content':_0x4b7b23,'redirectTo':'/','redirectToLinkText':_0x4ad09a(0x1ab)});return;}_0x5274aa[_0x4ad09a(0x186)](_0x4ad09a(0x201),_0x31924c['id'],{'signed':!![],'maxAge':_0x31924c['ttl']*0x3e8}),Promise['all']([_0x4968a6[_0x4ad09a(0x1ec)](_0x31924c[_0x4ad09a(0x208)])])[_0x4ad09a(0x18b)](([_0x3409b8])=>{const _0x550d1b=_0x4ad09a;if(!_0x3409b8[_0x550d1b(0x183)])return _0x5274aa[_0x550d1b(0x17a)](_0x550d1b(0x1f4),{'title':_0x550d1b(0x1ee),'content':_0x550d1b(0x1c6),'redirectTo':'/','redirectToLinkText':'Try\x20another\x20account'});_0x5274aa[_0x550d1b(0x17a)](_0x550d1b(0x174),{'email':_0x482644[_0x550d1b(0x1df)][_0x550d1b(0x1cc)],'accessToken':_0x31924c['id'],'user':_0x3409b8,'webSocketHost':getLocalInterface()[_0x550d1b(0x1a6)]+':'+config[_0x550d1b(0x1aa)],'proxyPort':config[_0x550d1b(0x195)],'redirectUrl':_0x550d1b(0x1be)});});});}),_0x619b85['get']('/logout',function(_0x3391fa,_0x5195f9,_0x3e5f66){const _0xb3eee=_0x437496;_0x3391fa['accessToken']&&_0x3391fa[_0xb3eee(0x181)]['id']?_0x4968a6['logout'](_0x3391fa[_0xb3eee(0x181)]['id'],function(_0x547c30){const _0x22cb79=_0xb3eee;if(_0x547c30)return _0x3e5f66(_0x547c30);_0x5195f9[_0x22cb79(0x19c)](_0x22cb79(0x201)),_0x5195f9['redirect']('/');}):(_0x5195f9[_0xb3eee(0x19c)]('access_token'),_0x5195f9[_0xb3eee(0x1ed)]('/'));}),_0x619b85['post']('/request-password-reset',function(_0x16823e,_0x1ca1cc,_0x1a9e28){const _0x1985bf=_0x437496;_0x4968a6[_0x1985bf(0x1e5)]({'email':_0x16823e[_0x1985bf(0x1df)][_0x1985bf(0x1cc)]},function(_0x16ed24){const _0x3f2d63=_0x1985bf;if(_0x16ed24)return _0x1ca1cc['status'](0x191)[_0x3f2d63(0x1e9)](_0x16ed24);_0x1ca1cc[_0x3f2d63(0x17a)](_0x3f2d63(0x1f4),{'title':_0x3f2d63(0x1db),'content':_0x3f2d63(0x1b7),'redirectTo':'/','redirectToLinkText':'Log\x20in'});});}),_0x619b85[_0x437496(0x18f)](_0x437496(0x1d1),function(_0x4d8a28,_0x5a944e,_0x3fba30){const _0x57a264=_0x437496;_0x5a944e[_0x57a264(0x17a)]('password-reset',{'redirectUrl':_0x57a264(0x17d)});}),_0x619b85[_0x437496(0x18f)](_0x437496(0x177),function(_0x12a2d3,_0x2b4140,_0x26e7f2){const _0x9ff2b1=_0x437496;if(!_0x12a2d3[_0x9ff2b1(0x181)]||!_0x12a2d3[_0x9ff2b1(0x181)]['id'])return _0x2b4140[_0x9ff2b1(0x1ed)](_0x9ff2b1(0x185));Promise[_0x9ff2b1(0x205)]([_0x4968a6[_0x9ff2b1(0x1ec)](_0x12a2d3[_0x9ff2b1(0x181)][_0x9ff2b1(0x208)])])[_0x9ff2b1(0x18b)](([_0x4ad657])=>{const _0x23dc7c=_0x9ff2b1;let _0x462f16=getMinerFilterClause(_0x4ad657);return Promise[_0x23dc7c(0x205)]([_0x502df7[_0x23dc7c(0x1ae)](_0x462f16)]);})[_0x9ff2b1(0x18b)](([_0x52816a])=>{const _0x4a5458=_0x9ff2b1;_0x52816a[_0x4a5458(0x1ad)](_0x10342f=>{let {workerName:_0x39902a,accountName:_0x447241,macAddress:_0x46c334,ipAddress:_0x995f1c,apiVersion:_0x3db8b1}=_0x10342f;registerProxy({'workerName':_0x39902a,'accountName':_0x447241,'macAddress':_0x46c334,'ipAddress':_0x995f1c,'minerTyped':getMinerTypeMap(_0x10342f),'apiVersion':_0x3db8b1});}),_0x2b4140['render'](_0x4a5458(0x184),{'minerInfos':_0x52816a,'minerTypeMap':minerTypeMap,'accessToken':_0x12a2d3['accessToken']['id'],'proxyPort':config['proxyPort'],'webSocketHost':getLocalInterface()['address']+':'+config[_0x4a5458(0x1aa)]});});}),_0x619b85[_0x437496(0x18f)](_0x437496(0x1a4),function(_0x2d1bef,_0x468842,_0x1b2a68){const _0x5d5fc9=_0x437496;if(!_0x2d1bef['accessToken']||!_0x2d1bef[_0x5d5fc9(0x181)]['id'])return _0x468842[_0x5d5fc9(0x1ed)]('/logout');const _0x4d5cc7=_0x2d1bef[_0x5d5fc9(0x1ca)][_0x5d5fc9(0x1ff)];Promise[_0x5d5fc9(0x205)]([_0x4968a6[_0x5d5fc9(0x1ec)](_0x2d1bef[_0x5d5fc9(0x181)]['userId'])])[_0x5d5fc9(0x18b)](([_0x26e938])=>{let _0x40ccc8=getMinerFilterClause(_0x26e938);return Promise['all']([getMinerLayoutFields(_0x40ccc8)]);})['then'](([_0x2ecab1])=>{const _0x2fefe7=_0x5d5fc9;_0x468842[_0x2fefe7(0x17a)](_0x2fefe7(0x1dc),{'minerInfos':_0x2ecab1,'minerTypeMap':minerTypeMap,'dataHall':_0x4d5cc7,'accessToken':_0x2d1bef[_0x2fefe7(0x181)]['id'],'proxyPort':config['proxyPort'],'webSocketHost':getLocalInterface()['address']+':'+config[_0x2fefe7(0x1aa)]});});}),_0x619b85['get'](_0x437496(0x1d8),function(_0x3d750d,_0x4a7b07,_0xaf9d07){const _0x4f55cf=_0x437496;if(!_0x3d750d[_0x4f55cf(0x181)]||!_0x3d750d[_0x4f55cf(0x181)]['id'])return _0x4a7b07['redirect'](_0x4f55cf(0x185));const _0x4da375=_0x3d750d[_0x4f55cf(0x1ca)][_0x4f55cf(0x1b1)];Promise[_0x4f55cf(0x205)]([_0x502df7['find']({'macAddress':_0x4da375})])[_0x4f55cf(0x18b)](([_0x5df625])=>{const _0x4179bf=_0x4f55cf;_0x4a7b07['render']('tickets',{'minerInfos':_0x5df625,'proxyPort':config[_0x4179bf(0x195)]});});}),_0x619b85['post']('/ticket',function(_0x3f3e0c,_0x92c8d,_0x1e609e){const _0x4e9e84=_0x437496;Promise[_0x4e9e84(0x205)]([_0x502df7[_0x4e9e84(0x1ae)]()])[_0x4e9e84(0x18b)](([_0xb825da])=>{const _0x509cfc=_0x4e9e84;_0x92c8d['render']('tickets',{'minerInfos':_0xb825da,'accessToken':_0x3f3e0c[_0x509cfc(0x181)]['id'],'proxyPort':config[_0x509cfc(0x195)]});});}),_0x619b85['get'](_0x437496(0x17e),function(_0x5639f6,_0x930c05,_0x2bd517){const _0x51b076=_0x437496;if(!_0x5639f6['accessToken']||!_0x5639f6['accessToken']['id'])return _0x930c05['redirect'](_0x51b076(0x185));const _0x4b8c88=_0x5639f6[_0x51b076(0x1ca)][_0x51b076(0x1ff)];Promise['all']([_0x4968a6[_0x51b076(0x1ec)](_0x5639f6['accessToken']['userId'])])[_0x51b076(0x18b)](([_0x129e6b])=>{const _0xcc913b=_0x51b076;let _0x2c3b3a=getMinerFilterClause(_0x129e6b);return Promise['all']([_0x1cb080[_0xcc913b(0x197)]({'active':!![]}),_0x502df7['find'](_0x2c3b3a),_0x129e6b]);})['then'](([_0x33e3e8,_0x1085ad,_0x246276])=>{const _0x80c993=_0x51b076;_0x930c05['render']('provision',{'minerTypeMap':config[_0x80c993(0x1ce)],'email':_0x5639f6[_0x80c993(0x1df)]['email'],'dataCenterSettings':_0x33e3e8,'minerInfos':_0x1085ad,'dataHall':_0x4b8c88,'accessToken':_0x5639f6[_0x80c993(0x181)]['id'],'user':_0x246276,'proxyPort':config[_0x80c993(0x195)],'webSocketHost':getLocalInterface()[_0x80c993(0x1a6)]+':'+config[_0x80c993(0x1aa)]});});}),_0x619b85[_0x437496(0x1a8)](_0x437496(0x1c3),function(_0x4a5ffd,_0x54b9cb,_0x45af1f){const _0x5b9427=_0x437496,_0x5aca07=_0x4a5ffd[_0x5b9427(0x1df)][_0x5b9427(0x1dd)]||[],_0x1f1e88=_0x4a5ffd[_0x5b9427(0x1df)]['hashAlgorithm'],_0x558a25=_0x4a5ffd[_0x5b9427(0x1df)][_0x5b9427(0x1c9)]||'',_0x2a7689=_0x4a5ffd[_0x5b9427(0x1df)]['minerType']||'';let _0x187981={};_0x1f1e88&&(_0x187981={'where':{'hashAlgorithm':_0x1f1e88},'order':[_0x5b9427(0x178),_0x5b9427(0x189)]});const _0x1d85d6=path['resolve'](global['firmwareFolderPath']);let _0x414adb=fs[_0x5b9427(0x1c2)](_0x1d85d6),_0x33d128=[],_0x2e599a=[],_0x18fa3d=[];if(_0x2a7689){let _0x3d5351=new RegExp(_0x2a7689,'i');_0x558a25==_0x5b9427(0x179)&&(_0x3d5351=new RegExp(_0x2a7689[_0x5b9427(0x1de)](0x1),'i'));_0x414adb=_0x414adb[_0x5b9427(0x192)](_0x953573=>_0x3d5351[_0x5b9427(0x19a)](_0x953573));const _0x54c62a=_0x5b9427(0x17f)+_0x2a7689[_0x5b9427(0x18a)](/(\w\d+)/)[0x1],_0x49f453=getMinerTypeMap({'minerType':_0x54c62a});_0x49f453&&_0x49f453[_0x5b9427(0x1fa)]&&_0x49f453[_0x5b9427(0x1fa)][_0x5b9427(0x1e7)]&&(_0x33d128=_0x49f453[_0x5b9427(0x1fa)]['frequencies']||[],_0x2e599a=_0x49f453['overclock'][_0x5b9427(0x1b2)]||[],_0x18fa3d=_0x49f453[_0x5b9427(0x1fa)]['presets']||[]);}Promise[_0x5b9427(0x205)]([_0xce33b4[_0x5b9427(0x1ae)](_0x187981),_0x4968a6[_0x5b9427(0x1ec)](_0x4a5ffd['accessToken'][_0x5b9427(0x208)]),_0x502df7[_0x5b9427(0x1ae)]({'where':{'ipAddress':_0x5aca07[0x0]}})])[_0x5b9427(0x18b)](([_0x4cd440,_0x2e6aff,_0x4c013b])=>{const _0x30541d=_0x5b9427;_0x54b9cb[_0x30541d(0x17a)](_0x30541d(0x190),{'pools':_0x4cd440[_0x30541d(0x200)]((_0x3105e6,_0x51f441)=>_0x3105e6[_0x30541d(0x1cb)]>_0x51f441[_0x30541d(0x1cb)]?0x1:-0x1),'user':_0x2e6aff,'accountName':_0x558a25,'ipAddresses':_0x5aca07,'accessToken':_0x4a5ffd[_0x30541d(0x181)]['id'],'files':_0x414adb,'frequencies':_0x33d128,'voltages':_0x2e599a,'presets':_0x18fa3d,'poolIDs':_0x4c013b[0x0]?_0x4c013b[0x0][_0x30541d(0x1f0)]||[]:[]});});}),_0x619b85[_0x437496(0x18f)](_0x437496(0x1d0),function(_0x191c25,_0x5c9ae7,_0x1d24fc){const _0x3ef53d=_0x437496;Promise[_0x3ef53d(0x205)]([_0x4968a6[_0x3ef53d(0x1ec)](_0x191c25[_0x3ef53d(0x181)][_0x3ef53d(0x208)])])['then'](([_0x26c452])=>{const _0x293daa=_0x3ef53d;_0x5c9ae7[_0x293daa(0x17a)]('upload-miners',{'user':_0x26c452,'accessToken':_0x191c25[_0x293daa(0x181)]['id']});});}),_0x619b85[_0x437496(0x1a8)](_0x437496(0x1da),upload[_0x437496(0x202)](_0x437496(0x196)),function(_0xecef0b,_0x2b6dbb){const _0x4b1f78=_0x437496,_0x3501cf=_0xecef0b[_0x4b1f78(0x1df)]['title'],_0x17d8b5=_0xecef0b[_0x4b1f78(0x196)],_0x5cb2a2=_0x17d8b5['buffer'][_0x4b1f78(0x1a0)]();try{const _0x4d0c1a=parse(_0x5cb2a2,{'columns':!![],'trim':!![],'skip_empty_lines':!![]});let _0x592950=Object['keys'](_0x4d0c1a[0x0])[_0x4b1f78(0x1ae)](_0x2c64d9=>/key\([^\)]+\)/[_0x4b1f78(0x19a)](_0x2c64d9)),_0x3a71dc=_0x4b1f78(0x1b1);!_0x592950?_0x592950=_0x4b1f78(0x1b1):_0x3a71dc=_0x592950[_0x4b1f78(0x18a)](/key\(([^\)]+)\)/)[0x1],_0x4d0c1a['map'](async _0xd1fafe=>{updateMinerInfo({'record':_0xd1fafe,'keyField':_0x3a71dc,'keyFieldName':_0x592950});}),_0x2b6dbb[_0x4b1f78(0x1e1)](0xc8);}catch(_0x11acda){_0x2b6dbb[_0x4b1f78(0x1e9)](0x1f4,_0x11acda);}}),_0x619b85[_0x437496(0x18f)]('/prioritize-pools',function(_0x35a48d,_0x202141,_0x31c146){const _0x340c6a=_0x437496;Promise['all']([_0xce33b4['find']({'order':[_0x340c6a(0x178),_0x340c6a(0x189),_0x340c6a(0x1cb)]}),_0x4968a6[_0x340c6a(0x1ec)](_0x35a48d[_0x340c6a(0x181)]['userId'])])[_0x340c6a(0x18b)](([_0xbbf7fd,_0x3ed61a])=>{const _0xf438c3=_0x340c6a;_0x202141[_0xf438c3(0x17a)]('prioritize-pools',{'pools':_0xbbf7fd,'user':_0x3ed61a,'accessToken':_0x35a48d[_0xf438c3(0x181)]['id']});});}),_0x619b85[_0x437496(0x18f)](_0x437496(0x1fb),function(_0x192685,_0x223848,_0x47eea2){const _0xd99b73=_0x437496,_0x1899f6=_0xd99b73(0x1a2);function _0x2ea1e3(_0x363e77){const _0x2afc6b=_0xd99b73;return((_0x363e77||'')+'ZZ')[_0x2afc6b(0x1de)](0x0,0x2)+crypto[_0x2afc6b(0x180)](0x5)[_0x2afc6b(0x1a0)](_0x2afc6b(0x175))[_0x2afc6b(0x1ba)]()[_0x2afc6b(0x19e)](/(.{2})/g,':$1');}let _0x2d8f62=_0x2ea1e3('ZZ');Promise[_0xd99b73(0x205)]([_0x502df7[_0xd99b73(0x1ae)]({'where':{'macAddress':{'regexp':/^ZZ:/}}}),_0x502df7['count']({'macAddress':_0x2d8f62})])[_0xd99b73(0x18b)](([_0x3c7038,_0x1358fe])=>{const _0x2b9be9=_0xd99b73;if(_0x1358fe){const _0x142e2c=_['indexBy'](_0x3c7038,_0x2b9be9(0x1b1));do{_0x2d8f62=_0x2ea1e3('ZZ');}while(!_0x142e2c[_0x2d8f62]);}_0x223848[_0x2b9be9(0x17a)](_0x2b9be9(0x19b),{'minerTypeMap':config[_0x2b9be9(0x1ce)],'macAddress':_0x2d8f62,'ipAddress':_0x1899f6});});}),_0x619b85[_0x437496(0x18f)]('/reboot-miner',function(_0x1ed727,_0x4c8e22,_0x4a5e5d){const _0x376693=_0x437496,{ipaddress:_0x3b0c47}=_0x1ed727[_0x376693(0x1ca)];Promise[_0x376693(0x205)]([_0x4968a6[_0x376693(0x1ec)](_0x1ed727[_0x376693(0x181)][_0x376693(0x208)]),getMinerInfo({'ipAddress':_0x3b0c47})])[_0x376693(0x18b)](([_0x3b9e24,_0x533280])=>{const _0x2f11a2=_0x376693;if(!_0x533280)return console[_0x2f11a2(0x207)]('Reboot\x20miner\x20lookup\x20failed',_0x1ed727['query']),![];const _0x253ca5=getMinerTypeMap(_0x533280),_0x589f24=deriveApiVersion({'minerInfo':_0x533280,'minerTyped':_0x253ca5});return getMinerReboot(_0x533280,_0x253ca5,_0x589f24)[_0x2f11a2(0x18b)](_0x46af8e=>{const _0x53648d=_0x2f11a2;return _0x46af8e?(_0x533280[_0x53648d(0x1a3)]=null,_0x533280[_0x53648d(0x19f)](),_0x4c8e22[_0x53648d(0x1b5)](0xc8,{'Content-Type':_0x53648d(0x1e8)}),_0x4c8e22['end'](JSON[_0x53648d(0x1a5)]({'reboot':!![]}))):_0x4c8e22[_0x53648d(0x1e1)](0x191);});});}),_0x619b85[_0x437496(0x1a8)](_0x437496(0x1f9),function(_0xe48ecc,_0x2cdd77,_0x4899d9){const _0x217de9=_0x437496,{ipaddress:_0x5f4b65}=_0xe48ecc[_0x217de9(0x1ca)];if(!_0xe48ecc[_0x217de9(0x181)]||!_0xe48ecc['accessToken']['id'])return _0x2cdd77['redirect']('/logout');Promise[_0x217de9(0x205)]([_0x4968a6[_0x217de9(0x1ec)](_0xe48ecc[_0x217de9(0x181)]['userId']),getMinerInfo({'ipAddress':_0x5f4b65})])['then'](([_0x1d1589,_0x4cdf0d])=>{const _0x247503=_0x217de9;if(!_0x1d1589)return _0x2cdd77[_0x247503(0x1ed)]('/logout');if(!_0x4cdf0d)return console[_0x247503(0x207)]('Hashrate\x20chart\x20lookup\x20failed',_0xe48ecc[_0x247503(0x1ca)]),![];if(!_0x4cdf0d['trends'])return _0x2cdd77[_0x247503(0x17a)](_0x247503(0x1fc),{'points':JSON[_0x247503(0x1a5)]([{'x':Date[_0x247503(0x1c5)],'y':0x2}])});const {fine:_0x9d7f2b,hourly:_0x5ce883}=_0x4cdf0d[_0x247503(0x1eb)],_0x5cbc3c=_0x9d7f2b[_0x247503(0x1d4)](_0x5ce883);_0x2cdd77[_0x247503(0x17a)](_0x247503(0x1fc),{'points':JSON[_0x247503(0x1a5)](_0x5cbc3c)});});}),_0x619b85[_0x437496(0x18f)](_0x437496(0x1f6),async function(_0x1dd213,_0x575eee,_0x3053a6){const _0x2afdc2=_0x437496,_0x5d24ad=await trendsAggregate(_0x1dd213['query']);_0x575eee[_0x2afdc2(0x1af)](_0x5d24ad);}),_0x619b85[_0x437496(0x18f)](_0x437496(0x1b3),async(_0xd1540b,_0x379232)=>{const _0x372698=_0x437496;let {ipaddress:_0x22fd6f,ipAddress:_0x23d9bb,ip:_0x34c0d1,brand:_0x3ec805}=_0xd1540b[_0x372698(0x1ca)];_0x23d9bb=_0x22fd6f||_0x23d9bb||_0x34c0d1;const _0x37e41b=await provisionMiner({'ipAddress':_0x23d9bb,'minerTyped':{'brand':_0x3ec805}});_0x379232[_0x372698(0x1af)](_0x37e41b);}),_0x619b85['get']('/state-check',async(_0x398ed2,_0x221d8c)=>{const _0x2aa217=_0x437496;let {ipAddress:_0x6d5d,ipaddress:_0x167a2f,ip:_0x440a0f,commands:commands='',brand:_0x136eb2}=_0x398ed2['query'];_0x6d5d=_0x167a2f||_0x6d5d||_0x440a0f;commands&&(commands=commands[_0x2aa217(0x1c8)](/\s*,\s*/));const _0x37cdc4=_0x6d5d?await checkMinerStates({'ipAddress':_0x6d5d,'commands':commands,'brand':_0x136eb2}):{'usage':_0x2aa217(0x191)};_0x221d8c[_0x2aa217(0x1af)](_0x37cdc4);}),_0x619b85[_0x437496(0x18f)](_0x437496(0x1e6),async(_0x37d430,_0xe61c56)=>{const _0x584ade=_0x437496;let {ipAddress:_0x5a0364,ipaddress:_0x412075,ip:_0x59ffdd,brand:_0x5b8dcb,user:_0x288859,username:_0x3e7e4c,userName:_0x3a4a93,worker:_0x4822d1,workerName:_0x4f07d4,workername:_0x28c581}=_0x37d430[_0x584ade(0x1ca)];_0x5a0364=_0x412075||_0x5a0364||_0x59ffdd,_0x3e7e4c=_0x3e7e4c||_0x3a4a93||_0x288859,_0x4822d1=_0x4822d1||_0x28c581||_0x4f07d4;const _0x4f6d63=_0x5a0364?await modifyMinerStates({'ipAddress':_0x5a0364,'brand':_0x5b8dcb,'username':_0x3e7e4c,'worker':_0x4822d1}):{'usage':'?ipAddress=192.x.x.x&brand=Whatsminer&username=mineops&worker=S19DBD001'};_0xe61c56[_0x584ade(0x1af)](_0x4f6d63);}),_0x619b85['get'](_0x437496(0x1cf),async(_0x34aa0c,_0x5100eb)=>{const _0x53a2c6=_0x437496;let {dhcpSettings:_0x20a093}=await _0x1cb080[_0x53a2c6(0x197)]();const {settings:_0x5a2b9b,mode:_0x31dfaf,reset:_0x5b4f2a,help:_0x45bb2f}=_0x34aa0c[_0x53a2c6(0x1ca)];if(_0x5a2b9b||_0x45bb2f)try{const _0x26b95b=JSON['parse'](_0x5a2b9b);_0x20a093={..._0x20a093,..._0x26b95b};}catch(_0x350fb6){return _0x5100eb['json']({'not-parseable':_0x5a2b9b,'example':'?settings={\x22range\x22:[\x22192.168.0.2\x22,\x22192.168.4.254\x22],\x22netmask\x22:\x22255.255.242.0\x22,\x22scanThrottleCount\x22:20}&mode=discoverhttp','modes':['discover',_0x53a2c6(0x206),_0x53a2c6(0x1a9),_0x53a2c6(0x1fe),_0x53a2c6(0x18e)],'error':{'message':_0x350fb6[_0x53a2c6(0x203)],'stack':_0x350fb6['stack']}});}let _0x5566c2;if(/discover/i[_0x53a2c6(0x19a)](_0x31dfaf))_0x5566c2=await discoverMiners(_0x20a093,/true/i[_0x53a2c6(0x19a)](_0x5b4f2a),/http/i[_0x53a2c6(0x19a)](_0x31dfaf));else/sync/i['test'](_0x31dfaf)?_0x5566c2=await compareMinerStatus(_0x20a093,/true/i[_0x53a2c6(0x19a)](_0x5b4f2a),/http/i[_0x53a2c6(0x19a)](_0x31dfaf)):_0x5566c2=await scanForMinerVersions(_0x20a093,/true/i['test'](_0x5b4f2a),/http/i['test'](_0x31dfaf));_0x5100eb[_0x53a2c6(0x1af)](_0x5566c2);}),_0x619b85[_0x437496(0x18f)](_0x437496(0x182),async(_0x5e86d3,_0x46e8f5)=>{const _0x4db230=_0x437496,{ipaddress:_0x2f8231}=_0x5e86d3[_0x4db230(0x1ca)];let _0x58d64a=await _0x502df7[_0x4db230(0x197)]({'where':{'ipAddress':_0x2f8231}});const _0x3ec790=await syncMinerStatusJob(_0x58d64a,Date[_0x4db230(0x1e3)](new Date()),!![]);_0x46e8f5[_0x4db230(0x1af)](_0x3ec790);}),_0x619b85['get'](_0x437496(0x1a7),async(_0x106280,_0x10bfc0)=>{const _0x5a2d43=_0x437496,_0x55b569=[_0x5a2d43(0x199),_0x5a2d43(0x1e4),'configured','positioned'];let {mac:_0x3c48af,macAddress:_0x1866cf,macaddress:_0x16c2c1,ip:_0x590bb8,ipAddress:_0x485844,ipaddress:_0x4df71b,state:_0xe60ca8}=_0x106280['query'];(!_0xe60ca8||_0x55b569[_0x5a2d43(0x193)](_0xe60ca8)<0x0)&&_0x10bfc0[_0x5a2d43(0x1af)]({'miner-state-not-found':_0xe60ca8,'example':_0x5a2d43(0x1c4),'available-states':_0x55b569});_0x590bb8=_0x590bb8||_0x485844||_0x4df71b,_0x3c48af=_0x3c48af||_0x1866cf||_0x16c2c1;var _0x1e8919;if(_0x590bb8&&_0x590bb8[_0x5a2d43(0x1e2)])_0x1e8919={'where':{'ipAddress':{'inq':_0x590bb8[_0x5a2d43(0x1c8)](/\s*,\s*/)}}};else _0x3c48af&&_0x3c48af[_0x5a2d43(0x1e2)]&&(_0x1e8919={'where':{'macAddress':{'inq':_0x3c48af[_0x5a2d43(0x1c8)](/\s*,\s*/)}}});let _0x50ab57=await _0x502df7['find'](_0x1e8919);socketSendMiners(_0x50ab57,_0xe60ca8),_0x10bfc0[_0x5a2d43(0x1af)]({'broadcastSuccessful':!![]});});};