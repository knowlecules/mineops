/* Copyright (C) 9208-9721 Quebec, Inc - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
* Written by Jason Rudland <jason.g.rudland@gmail.com>, September 2022
*/'use strict';const _0x4f106c=_0x4d32;(function(_0x3cb9e7,_0x32304e){const _0x42fc91=_0x4d32,_0x52d5be=_0x3cb9e7();while(!![]){try{const _0x15e84c=parseInt(_0x42fc91(0xd8))/0x1*(-parseInt(_0x42fc91(0x82))/0x2)+-parseInt(_0x42fc91(0x99))/0x3+parseInt(_0x42fc91(0xb3))/0x4+parseInt(_0x42fc91(0xba))/0x5*(-parseInt(_0x42fc91(0xa8))/0x6)+parseInt(_0x42fc91(0xd6))/0x7+parseInt(_0x42fc91(0xce))/0x8+parseInt(_0x42fc91(0xb6))/0x9;if(_0x15e84c===_0x32304e)break;else _0x52d5be['push'](_0x52d5be['shift']());}catch(_0x559c59){_0x52d5be['push'](_0x52d5be['shift']());}}}(_0x1014,0x3553e));const config=require(_0x4f106c(0xa6)),svrConfig=require(_0x4f106c(0xd7)),httpProxy=require(_0x4f106c(0x9a)),proxy=httpProxy[_0x4f106c(0x89)]({'changeOrigin':!![],'cookieDomainRewrite':!![],'cookiePathRewrite':!![],'selfHandleResponse':!![]}),http=require(_0x4f106c(0x7e)),{getMinerLandingPageUrl}=require(_0x4f106c(0xc6)),{requestPost}=require(_0x4f106c(0xa5)),{authRequest}=require(_0x4f106c(0xd4)),util=require(_0x4f106c(0x80)),loopback=require(_0x4f106c(0xb8)),COLORIZE=global[_0x4f106c(0xda)],reMacAddress=/^([0-9A-FZX]{2}[:-])([0-9A-F]{2}[:-]){4}([0-9A-F]{2})$/i,reIPAddress=/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;let ipWorkerNameCache={};function _0x4d32(_0x54a3d9,_0x20e908){const _0x1014b9=_0x1014();return _0x4d32=function(_0x4d3256,_0x57bdc7){_0x4d3256=_0x4d3256-0x7e;let _0x5bbcbc=_0x1014b9[_0x4d3256];return _0x5bbcbc;},_0x4d32(_0x54a3d9,_0x20e908);}const server=http[_0x4f106c(0xb1)](async function(_0x5c5800,_0x792341){const _0x57c0be=_0x4f106c,_0x2f8c0a=loopback[_0x57c0be(0x83)](_0x57c0be(0x88)),_0x5b4175=(_0x5c5800[_0x57c0be(0xbd)]['cookie']||'')[_0x57c0be(0xa2)](/access_token=s%3A([^\.]*)\./),_0x10033d=_0x5b4175?decodeURIComponent(_0x5b4175[0x1]):_0x57c0be(0x8c),_0x21c40f=/proxy/['test'](process['env'][_0x57c0be(0x81)])?_0x57c0be(0xd0):await _0x2f8c0a[_0x57c0be(0x9e)](_0x10033d);if(!_0x21c40f)return endResponse(_0x792341,_0x57c0be(0xa9),0x191);if((Date['now']()-new Date(_0x21c40f[_0x57c0be(0xb4)]))/(0x18*0x3c*0x3c*0x3e8)>0x1)return endResponse(_0x792341,_0x57c0be(0xae),0x191);let _0x4aa817=/\/_device_\/([^\/\?#]+)(?:[\/\?#]|$)/i,_0x5c6081=_0x5c5800[_0x57c0be(0xc4)]['match'](_0x4aa817);const _0x54bcc5=_0x5c6081?_0x5c6081[0x1]:'';let _0x26753d=reIPAddress[_0x57c0be(0xd3)](_0x54bcc5)?_0x54bcc5:null;const _0x50533f=reMacAddress[_0x57c0be(0xd3)](_0x54bcc5)?_0x54bcc5:null;let _0x5345c3=_0x57c0be(0xa0),_0x568f09=ipWorkerNameCache[_0x50533f]||ipWorkerNameCache[_0x26753d];_0x568f09&&(_0x26753d=_0x568f09[_0x57c0be(0xdb)],_0x568f09&&_0x568f09[_0x57c0be(0xad)]&&(_0x5345c3=_0x568f09[_0x57c0be(0xad)]));if(_0x26753d)/landing\-page/i[_0x57c0be(0xd3)](_0x5c5800[_0x57c0be(0xc4)])?_0x5c5800[_0x57c0be(0xc4)]=getMinerLandingPageUrl(_0x57c0be(0xaf),_0x5345c3)[_0x57c0be(0xc4)]['replace'](/^.*0\.0\.0\.0/,''):_0x5c5800[_0x57c0be(0xc4)]=_0x5c5800[_0x57c0be(0xc4)]['replace'](new RegExp(_0x57c0be(0x8f)+_0x26753d+_0x57c0be(0x9b),'i'),'');else{if(_0x5c5800[_0x57c0be(0xbd)]){_0x5c5800[_0x57c0be(0xbd)][_0x57c0be(0x8b)]&&(_0x5c6081=_0x5c5800[_0x57c0be(0xbd)][_0x57c0be(0x8b)][_0x57c0be(0xa2)](_0x4aa817)||[],_0x26753d=_0x5c6081[0x1]);if(_0x26753d&&/GET/i['test'](_0x5c5800[_0x57c0be(0xc8)]))return endResponse(_0x792341,'',0x12e,{'Location':_0x57c0be(0x8f)+_0x26753d+_0x5c5800[_0x57c0be(0xc4)]});}}let _0x177360=[];_0x5c5800['on'](_0x57c0be(0xc0),_0x39ef35=>{const _0x3ffdfe=_0x57c0be;_0x177360[_0x3ffdfe(0x95)](_0x39ef35);}),_0x5c5800['on'](_0x57c0be(0x9d),()=>{const _0x3fa9ab=_0x57c0be,_0x741c0a='http://'+_0x26753d;if(_0x177360['length']){_0x5c5800[_0x3fa9ab(0xcc)]=_0x177360[_0x3fa9ab(0x87)](''),console[_0x3fa9ab(0xb5)](COLORIZE['Blue'],_0x3fa9ab(0xac),_0x5c5800[_0x3fa9ab(0xcc)]);if(/x-www-form-urlencoded/i['test'](_0x5c5800['headers'][_0x3fa9ab(0xc2)])){let _0x184249=ipWorkerNameCache[_0x26753d];if(!_0x184249)return endResponse(_0x792341,_0x3fa9ab(0x8e)+_0x26753d+_0x3fa9ab(0xca),0x1f4);let {apiVersion:_0x175e60}=_0x184249,{user:_0x3c4722,password:_0x133f70}=config[_0x3fa9ab(0xcb)][_0x175e60];_0x5c5800[_0x3fa9ab(0xc4)]=_0x5c5800['headers'][_0x3fa9ab(0xc1)]['split']('//')[0x0]+'//'+_0x26753d+_0x5c5800[_0x3fa9ab(0xc4)],_0x5c5800[_0x3fa9ab(0x97)]={'user':_0x3c4722,'password':_0x133f70},requestPost(_0x5c5800)['then'](_0x572dbf=>{const _0x136d0b=_0x3fa9ab,_0x55e3bb=/\bOK\b\s*$/i[_0x136d0b(0xd3)](_0x572dbf)?0xc8:0x1f4;endResponse(_0x792341,_0x572dbf,_0x55e3bb);})[_0x3fa9ab(0x85)](_0x2704ee=>{const _0x4258a9=_0x3fa9ab;endResponse(_0x792341,_0x2704ee[_0x4258a9(0xc3)],_0x2704ee[_0x4258a9(0xb0)]||0x1f4);});}else proxy[_0x3fa9ab(0xa7)](_0x5c5800,_0x792341,{'target':_0x741c0a});}else console[_0x3fa9ab(0xb5)](COLORIZE[_0x3fa9ab(0xcf)],_0x3fa9ab(0xdc)),proxy['web'](_0x5c5800,_0x792341,{'target':_0x741c0a});});});proxy['on']('proxyRes',async function(_0x230731,_0x4063f1,_0x35b4ad){const _0x55cbc9=_0x4f106c;console[_0x55cbc9(0xb5)](COLORIZE[_0x55cbc9(0x8a)],_0x55cbc9(0x86),_0x4063f1['url'],_0x55cbc9(0x84),_0x230731[_0x55cbc9(0xb0)],'headers:',util['inspect'](_0x230731[_0x55cbc9(0xbd)]));if(/^401/[_0x55cbc9(0xd3)](_0x230731[_0x55cbc9(0xb0)])){let _0x4ab4d3=_0x230731[_0x55cbc9(0x92)][_0x55cbc9(0xb7)][_0x55cbc9(0xa1)],_0xcdc673=ipWorkerNameCache[_0x4ab4d3];if(!_0xcdc673)return endResponse(_0x35b4ad,'Miner\x20with\x20ip\x20['+_0x4ab4d3+']\x20not\x20registered.\x0a\x0a\x20Press\x20refresh\x20button\x20to\x20reload\x20the\x20registry',0x1f4);let {apiVersion:_0x4cb944}=_0xcdc673,{user:_0x4d3017,password:_0x4f24a9}=config[_0x55cbc9(0xcb)][_0x4cb944];const _0x43c20d=await authRequest(_0x230731,_0x4063f1,_0x4d3017,_0x4f24a9)[_0x55cbc9(0xd9)](_0x266330=>{const _0x25195d=_0x55cbc9;console[_0x25195d(0xb5)](COLORIZE[_0x25195d(0xcf)],_0x25195d(0x94),_0x266330[_0x25195d(0xbd)]),_0x35b4ad[_0x25195d(0xc9)](_0x266330[_0x25195d(0xb0)],_0x266330['headers']),_0x266330[_0x25195d(0xa4)](_0x35b4ad);})[_0x55cbc9(0x85)](_0xd130b=>{const _0x10751b=_0x55cbc9;console[_0x10751b(0x9f)](COLORIZE['Red'],'Auth\x20request\x20failed:',_0xd130b),endResponse(_0x35b4ad,_0xd130b[_0x10751b(0xc3)],_0xd130b[_0x10751b(0xb0)]||0x1f4);});return _0x43c20d;}else _0x230731['headers']['access-control-allow-origin']='*',_0x35b4ad[_0x55cbc9(0xc9)](_0x230731[_0x55cbc9(0xb0)],_0x230731[_0x55cbc9(0xbd)]),_0x230731[_0x55cbc9(0xa4)](_0x35b4ad);}),proxy['on']('proxyReq',function(_0x28cf3e,_0x4db49e,_0xf2877,_0x2513e8){const _0x334c7f=_0x4f106c;console[_0x334c7f(0xb5)](COLORIZE['Cyan'],_0x334c7f(0x98),_0x4db49e[_0x334c7f(0xc4)],_0x28cf3e['url'],util['inspect'](_0x4db49e[_0x334c7f(0xbd)]));if(!_0x4db49e[_0x334c7f(0xcc)]||!Object[_0x334c7f(0xbb)](_0x4db49e[_0x334c7f(0xcc)])[_0x334c7f(0x9c)])return;console[_0x334c7f(0xb5)](COLORIZE[_0x334c7f(0x93)],_0x334c7f(0xd2),_0x4db49e[_0x334c7f(0xcc)]),_0x28cf3e[_0x334c7f(0xbd)]=_0x4db49e[_0x334c7f(0xbd)],_0x28cf3e[_0x334c7f(0xc5)](_0x334c7f(0x7f),_0x334c7f(0xd5)),_0x28cf3e[_0x334c7f(0xb9)](_0x4db49e[_0x334c7f(0xcc)]);}),proxy['on'](_0x4f106c(0x9f),function(_0x321837,_0x2638f3,_0x1870e9){const _0x3c38ea=_0x4f106c;/(ECONNREFUSED|ETIMEDOUT)/i['test'](_0x321837[_0x3c38ea(0xc3)])?console[_0x3c38ea(0xb5)](COLORIZE[_0x3c38ea(0xbf)],_0x3c38ea(0x91),_0x321837[_0x3c38ea(0xc3)],_0x2638f3['headers']):console[_0x3c38ea(0x9f)](COLORIZE['Red'],_0x3c38ea(0x8d),_0x321837[_0x3c38ea(0xc3)],_0x2638f3[_0x3c38ea(0xbd)],_0x1870e9[_0x3c38ea(0xbd)]),endResponse(_0x1870e9,_0x321837[_0x3c38ea(0xc3)],0x1f4);});function endResponse(_0x13a2c8,_0x232920,_0x42fe62,_0x4442a4){const _0x5e786f=_0x4f106c;_0x13a2c8[_0x5e786f(0xc9)](_0x42fe62,_0x4442a4||{'Content-Type':_0x5e786f(0x96)});if(!_0x232920)return _0x13a2c8[_0x5e786f(0x9d)]();_0x13a2c8[_0x5e786f(0x9d)](_0x232920);}console[_0x4f106c(0xbc)](COLORIZE[_0x4f106c(0xcf)],_0x4f106c(0xaa)+config['proxyPort']),server[_0x4f106c(0xcd)](config[_0x4f106c(0xd1)]);function registerProxy({workerName:_0x349401,accountName:_0x6a227a,macAddress:_0x10c3d5,ipAddress:_0x5383da,minerTyped:_0x40bb35,apiVersion:_0x5e60f2}){const _0x285333=_0x4f106c;if(!(_0x10c3d5&&_0x5383da&&_0x40bb35&&_0x5e60f2))return console[_0x285333(0x9f)](_0x285333(0xa3)+_0x349401+',accountName=\x20'+_0x6a227a+',macAddress=\x20'+_0x10c3d5+_0x285333(0xb2)+_0x5383da+_0x285333(0xbe)+_0x40bb35+_0x285333(0x90));ipWorkerNameCache[_0x10c3d5]={'ipAddress':_0x5383da,'macAddress':_0x10c3d5,'workerName':_0x349401,'minerTyped':_0x40bb35,'apiVersion':_0x5e60f2},ipWorkerNameCache[_0x5383da]=ipWorkerNameCache[_0x10c3d5];if(_0x349401){let _0xaaed95=_0x6a227a+'.'+_0x349401;ipWorkerNameCache[_0xaaed95]=ipWorkerNameCache[_0x10c3d5];}}function _0x1014(){const _0x5d3954=['Auth\x20request\x20success:','push','text/plain','auth','Proxy\x20request\x20intercept\x20headers:','739935gPriAi','http-proxy','(?:/_device_)?','length','end','findById','error','Antminer','host','match','Invalid\x20argument\x20when\x20registering\x20miner\x20to\x20proxy:\x20workerName=\x20','pipe','../../common/utilities/fetch','../../common/config.json','web','1404762TynxGZ','Unauthourized\x20access!','[proxy]\x20listening\x20on\x20port\x20','port','Proxy\x20body:','apiVersion','Token\x20expired.\x20Login\x20again\x20to\x20use\x20the\x20proxy.','0.0.0.0','statusCode','createServer',',ipAddress=\x20','1200308ERAXdt','created','debug','3361815klhgdE','_headers','loopback','write','5mmAqug','keys','log','headers',',minerTyped=\x20','Red','data','origin','Content-Type','message','url','setHeader','../../common/utilities/miner-settings','exports','method','writeHead',']\x20not\x20registered.\x0a\x0a\x20Press\x20refresh\x20button\x20to\x20reload\x20the\x20registry','minerApis','body','listen','771752lTedfm','Blue','debugProxyToken','proxyPort','BODY:','test','./auth-request.js','keep-alive','758345icBXCd','../config.json','251qGVHvh','then','colorize','ipAddress','No\x20body\x20to\x20proxy.','http','connection','util','NODE_DEBUG','1428UCVvhe','getModel','Status:','catch','Proxy\x20response\x20intercept\x20url:','join','AccessToken','createProxyServer','Magenta','referer','NKhQBeeXFV1DwxpsoFNEkXjRlw57218lvrgsBPb2zbQuwxszyom3d2V8c2woXRl8','Proxy\x20error:','Miner\x20with\x20ip\x20[','/_device_/',',apiVersion','Proxy\x20error\x20debug:','req','Green'];_0x1014=function(){return _0x5d3954;};return _0x1014();}function getWorkerUrl({workerName:_0x568da5,accountName:_0x1728bd,macAddress:_0x227c98}){const _0x26c86e=_0x4f106c;return _0x1728bd=!_0x1728bd?'':_0x1728bd,svrConfig[_0x26c86e(0xa1)]+':'+svrConfig[_0x26c86e(0xab)]+'/miners?worker='+encodeURIComponent(_0x568da5)+'&accountName='+encodeURIComponent(_0x1728bd)+'&macAddress='+encodeURIComponent(_0x227c98);}module[_0x4f106c(0xc7)]={'registerProxy':registerProxy,'getWorkerUrl':getWorkerUrl};