/* Copyright (C) 9208-9721 Quebec, Inc - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
* Written by Jason Rudland <jason.g.rudland@gmail.com>, September 2022
*/'use strict';const _0x7cc027=_0x1e02;(function(_0x7db6b8,_0x1e4999){const _0x145d83=_0x1e02,_0x679f2a=_0x7db6b8();while(!![]){try{const _0x1c6c67=-parseInt(_0x145d83(0x141))/0x1*(parseInt(_0x145d83(0x154))/0x2)+-parseInt(_0x145d83(0x13b))/0x3+parseInt(_0x145d83(0x17a))/0x4+parseInt(_0x145d83(0x13f))/0x5*(parseInt(_0x145d83(0x143))/0x6)+parseInt(_0x145d83(0x13d))/0x7+parseInt(_0x145d83(0x15f))/0x8+parseInt(_0x145d83(0x155))/0x9;if(_0x1c6c67===_0x1e4999)break;else _0x679f2a['push'](_0x679f2a['shift']());}catch(_0x24ea84){_0x679f2a['push'](_0x679f2a['shift']());}}}(_0x270b,0xd8cf3));function _0x1e02(_0x1b8fa3,_0x17b054){const _0x270b2c=_0x270b();return _0x1e02=function(_0x1e02ac,_0x50562c){_0x1e02ac=_0x1e02ac-0x13a;let _0x2cce97=_0x270b2c[_0x1e02ac];return _0x2cce97;},_0x1e02(_0x1b8fa3,_0x17b054);}const config=require(_0x7cc027(0x14b)),svrConfig=require(_0x7cc027(0x14d)),httpProxy=require('http-proxy'),proxy=httpProxy[_0x7cc027(0x196)]({'changeOrigin':!![],'cookieDomainRewrite':!![],'cookiePathRewrite':!![],'selfHandleResponse':!![]}),http=require(_0x7cc027(0x171)),{getMinerLandingPageUrl}=require(_0x7cc027(0x15c)),{requestPost}=require(_0x7cc027(0x16e)),{authRequest}=require(_0x7cc027(0x194)),util=require(_0x7cc027(0x186)),loopback=require(_0x7cc027(0x169)),COLORIZE=global[_0x7cc027(0x18c)],reMacAddress=/^([0-9A-FZX]{2}[:-])([0-9A-F]{2}[:-]){4}([0-9A-F]{2})$/i,reIPAddress=/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;let ipWorkerNameCache={};const server=http['createServer'](async function(_0x298da3,_0x5cb0e3){const _0x138591=_0x7cc027,_0x2927f4=loopback[_0x138591(0x13e)](_0x138591(0x18b)),_0x21abed=(_0x298da3[_0x138591(0x140)][_0x138591(0x159)]||'')[_0x138591(0x167)](/access_token=s%3A([^\.]*)\./),_0x291676=_0x21abed?decodeURIComponent(_0x21abed[0x1]):_0x138591(0x166),_0x30b858=/proxy/['test'](process['env'][_0x138591(0x162)])?_0x138591(0x16d):await _0x2927f4[_0x138591(0x178)](_0x291676);if(!_0x30b858)return endResponse(_0x5cb0e3,_0x138591(0x151),0x191);if((Date[_0x138591(0x165)]()-new Date(_0x30b858[_0x138591(0x18a)]))/(0x18*0x3c*0x3c*0x3e8)>0x1)return endResponse(_0x5cb0e3,_0x138591(0x17b),0x191);let _0x315b10=/\/_device_\/([^\/\?#]+)(?:[\/\?#]|$)/i,_0x2bea50=_0x298da3['url'][_0x138591(0x167)](_0x315b10);const _0x33d108=_0x2bea50?_0x2bea50[0x1]:'';let _0x49a903=reIPAddress[_0x138591(0x164)](_0x33d108)?_0x33d108:null;const _0x42216c=reMacAddress['test'](_0x33d108)?_0x33d108:null;let _0x45eaf2=_0x138591(0x195),_0x147dd9=ipWorkerNameCache[_0x42216c]||ipWorkerNameCache[_0x49a903];_0x147dd9&&(_0x49a903=_0x147dd9[_0x138591(0x14f)],_0x147dd9&&_0x147dd9[_0x138591(0x179)]&&(_0x45eaf2=_0x147dd9['apiVersion']));if(_0x49a903)/landing\-page/i['test'](_0x298da3['url'])?_0x298da3[_0x138591(0x145)]=getMinerLandingPageUrl(_0x138591(0x172),_0x45eaf2)[_0x138591(0x145)][_0x138591(0x148)](/^.*0\.0\.0\.0/,''):_0x298da3[_0x138591(0x145)]=_0x298da3[_0x138591(0x145)][_0x138591(0x148)](new RegExp(_0x138591(0x13c)+_0x49a903+_0x138591(0x144),'i'),'');else{if(_0x298da3['headers']){_0x298da3['headers'][_0x138591(0x16c)]&&(_0x2bea50=_0x298da3[_0x138591(0x140)][_0x138591(0x16c)][_0x138591(0x167)](_0x315b10)||[],_0x49a903=_0x2bea50[0x1]);if(_0x49a903&&/GET/i[_0x138591(0x164)](_0x298da3[_0x138591(0x152)]))return endResponse(_0x5cb0e3,'',0x12e,{'Location':_0x138591(0x13c)+_0x49a903+_0x298da3[_0x138591(0x145)]});}}let _0x378899=[];_0x298da3['on'](_0x138591(0x17f),_0x38c55d=>{_0x378899['push'](_0x38c55d);}),_0x298da3['on'](_0x138591(0x189),()=>{const _0x445ea6=_0x138591,_0x31cc37=_0x445ea6(0x149)+_0x49a903;if(_0x378899['length']){_0x298da3[_0x445ea6(0x17d)]=_0x378899[_0x445ea6(0x181)](''),console['debug'](COLORIZE[_0x445ea6(0x17e)],_0x445ea6(0x15d),_0x298da3[_0x445ea6(0x17d)]);if(/x-www-form-urlencoded/i[_0x445ea6(0x164)](_0x298da3[_0x445ea6(0x140)][_0x445ea6(0x198)])){let _0x208563=ipWorkerNameCache[_0x49a903];if(!_0x208563)return endResponse(_0x5cb0e3,_0x445ea6(0x176)+_0x49a903+_0x445ea6(0x184),0x1f4);let {apiVersion:_0xa54d51}=_0x208563,{user:_0x241725,password:_0x5e4fd6}=config[_0x445ea6(0x180)][_0xa54d51];_0x298da3['url']=_0x298da3[_0x445ea6(0x140)][_0x445ea6(0x14e)][_0x445ea6(0x190)]('//')[0x0]+'//'+_0x49a903+_0x298da3[_0x445ea6(0x145)],_0x298da3[_0x445ea6(0x147)]={'user':_0x241725,'password':_0x5e4fd6},requestPost(_0x298da3)['then'](_0x4817e4=>{const _0x3f996b=_0x445ea6,_0x3022c4=/\bOK\b\s*$/i[_0x3f996b(0x164)](_0x4817e4)?0xc8:0x1f4;endResponse(_0x5cb0e3,_0x4817e4,_0x3022c4);})[_0x445ea6(0x187)](_0x3052e4=>{const _0x40735c=_0x445ea6;endResponse(_0x5cb0e3,_0x3052e4[_0x40735c(0x177)],_0x3052e4[_0x40735c(0x173)]||0x1f4);});}else proxy['web'](_0x298da3,_0x5cb0e3,{'target':_0x31cc37});}else console['debug'](COLORIZE[_0x445ea6(0x17e)],_0x445ea6(0x142)),proxy['web'](_0x298da3,_0x5cb0e3,{'target':_0x31cc37});});});proxy['on']('proxyRes',async function(_0x52d79d,_0x3e5f68,_0x4f554c){const _0xbcd607=_0x7cc027;console[_0xbcd607(0x14c)](COLORIZE[_0xbcd607(0x192)],_0xbcd607(0x15b),_0x3e5f68[_0xbcd607(0x145)],_0xbcd607(0x197),_0x52d79d[_0xbcd607(0x173)],'headers:',util[_0xbcd607(0x16f)](_0x52d79d[_0xbcd607(0x140)]));if(/^401/[_0xbcd607(0x164)](_0x52d79d[_0xbcd607(0x173)])){let _0x36f0bd=_0x52d79d['req'][_0xbcd607(0x174)][_0xbcd607(0x175)],_0x4bf34b=ipWorkerNameCache[_0x36f0bd];if(!_0x4bf34b)return endResponse(_0x4f554c,_0xbcd607(0x176)+_0x36f0bd+_0xbcd607(0x184),0x1f4);let {apiVersion:_0x45d228}=_0x4bf34b,{user:_0x4ef69b,password:_0x3ed348}=config[_0xbcd607(0x180)][_0x45d228];const _0x44b46e=await authRequest(_0x52d79d,_0x3e5f68,_0x4ef69b,_0x3ed348)[_0xbcd607(0x153)](_0x18f3aa=>{const _0x45fded=_0xbcd607;console[_0x45fded(0x14c)](COLORIZE['Blue'],'Auth\x20request\x20success:',_0x18f3aa[_0x45fded(0x140)]),_0x4f554c[_0x45fded(0x185)](_0x18f3aa['statusCode'],_0x18f3aa[_0x45fded(0x140)]),_0x18f3aa[_0x45fded(0x191)](_0x4f554c);})[_0xbcd607(0x187)](_0x10a9e5=>{const _0x2e27c0=_0xbcd607;console[_0x2e27c0(0x188)](COLORIZE['Red'],'Auth\x20request\x20failed:',_0x10a9e5),endResponse(_0x4f554c,_0x10a9e5[_0x2e27c0(0x177)],_0x10a9e5[_0x2e27c0(0x173)]||0x1f4);});return _0x44b46e;}else _0x52d79d[_0xbcd607(0x140)][_0xbcd607(0x160)]='*',_0x4f554c[_0xbcd607(0x185)](_0x52d79d[_0xbcd607(0x173)],_0x52d79d[_0xbcd607(0x140)]),_0x52d79d['pipe'](_0x4f554c);}),proxy['on'](_0x7cc027(0x18e),function(_0x40a2bf,_0x5c2ec2,_0x48e355,_0x335700){const _0x58d87c=_0x7cc027;console[_0x58d87c(0x14c)](COLORIZE[_0x58d87c(0x17c)],_0x58d87c(0x168),_0x5c2ec2[_0x58d87c(0x145)],_0x40a2bf[_0x58d87c(0x145)],util[_0x58d87c(0x16f)](_0x5c2ec2[_0x58d87c(0x140)]));if(!_0x5c2ec2['body']||!Object[_0x58d87c(0x156)](_0x5c2ec2[_0x58d87c(0x17d)])[_0x58d87c(0x15a)])return;console[_0x58d87c(0x14c)](COLORIZE[_0x58d87c(0x183)],_0x58d87c(0x16b),_0x5c2ec2[_0x58d87c(0x17d)]),_0x40a2bf[_0x58d87c(0x140)]=_0x5c2ec2[_0x58d87c(0x140)],_0x40a2bf[_0x58d87c(0x15e)](_0x58d87c(0x14a),'keep-alive'),_0x40a2bf[_0x58d87c(0x182)](_0x5c2ec2[_0x58d87c(0x17d)]);}),proxy['on'](_0x7cc027(0x188),function(_0x3a60a8,_0x5b0fd4,_0x1d1d47){const _0xfe7387=_0x7cc027;/(ECONNREFUSED|ETIMEDOUT)/i[_0xfe7387(0x164)](_0x3a60a8[_0xfe7387(0x177)])?console[_0xfe7387(0x14c)](COLORIZE[_0xfe7387(0x150)],_0xfe7387(0x18f),_0x3a60a8[_0xfe7387(0x177)],_0x5b0fd4['headers']):console[_0xfe7387(0x188)](COLORIZE['Red'],_0xfe7387(0x13a),_0x3a60a8[_0xfe7387(0x177)],_0x5b0fd4[_0xfe7387(0x140)],_0x1d1d47[_0xfe7387(0x140)]),endResponse(_0x1d1d47,_0x3a60a8[_0xfe7387(0x177)],0x1f4);});function endResponse(_0x47affa,_0x21ab6e,_0x29db1c,_0x530fc5){const _0x131e60=_0x7cc027;_0x47affa[_0x131e60(0x185)](_0x29db1c,_0x530fc5||{'Content-Type':_0x131e60(0x158)});if(!_0x21ab6e)return _0x47affa[_0x131e60(0x189)]();_0x47affa[_0x131e60(0x189)](_0x21ab6e);}function _0x270b(){const _0x2217c8=[']\x20not\x20registered.\x0a\x0a\x20Press\x20refresh\x20button\x20to\x20reload\x20the\x20registry','writeHead','util','catch','error','end','created','AccessToken','colorize','exports','proxyReq','Proxy\x20error\x20debug:','split','pipe','Magenta','&macAddress=','./auth-request.js','Antminer','createProxyServer','Status:','Content-Type','Proxy\x20error:','5252610CpIfdR','/_device_/','4862116AAIDps','getModel','170AXoIdC','headers','12871sGzJOh','No\x20body\x20to\x20proxy.','174036mMIRSt','(?:/_device_)?','url','/miners?worker=','auth','replace','http://','connection','../../common/config.json','debug','../config.json','origin','ipAddress','Red','Unauthourized\x20access!','method','then','94tJMMeO','5180832LFtEdU','keys','Invalid\x20argument\x20when\x20registering\x20miner\x20to\x20proxy:\x20workerName=\x20','text/plain','cookie','length','Proxy\x20response\x20intercept\x20url:','../../common/utilities/miner-settings','Proxy\x20body:','setHeader','5540392Xdqywj','access-control-allow-origin',',apiVersion','NODE_DEBUG','&accountName=','test','now','NKhQBeeXFV1DwxpsoFNEkXjRlw57218lvrgsBPb2zbQuwxszyom3d2V8c2woXRl8','match','Proxy\x20request\x20intercept\x20headers:','loopback',',minerTyped=\x20','BODY:','referer','debugProxyToken','../../common/utilities/fetch','inspect','proxyPort','http','0.0.0.0','statusCode','_headers','host','Miner\x20with\x20ip\x20[','message','findById','apiVersion','1179476hwEbIm','Token\x20expired.\x20Login\x20again\x20to\x20use\x20the\x20proxy.','Cyan','body','Blue','data','minerApis','join','write','Green'];_0x270b=function(){return _0x2217c8;};return _0x270b();}console['log'](COLORIZE[_0x7cc027(0x17e)],'[proxy]\x20listening\x20on\x20port\x20'+config[_0x7cc027(0x170)]),server['listen'](config['proxyPort']);function registerProxy({workerName:_0x18927e,accountName:_0x32f0d5,macAddress:_0x399ed8,ipAddress:_0x19d890,minerTyped:_0x2a0a45,apiVersion:_0x316f75}){const _0x283efc=_0x7cc027;if(!(_0x399ed8&&_0x19d890&&_0x2a0a45&&_0x316f75))return console[_0x283efc(0x188)](_0x283efc(0x157)+_0x18927e+',accountName=\x20'+_0x32f0d5+',macAddress=\x20'+_0x399ed8+',ipAddress=\x20'+_0x19d890+_0x283efc(0x16a)+_0x2a0a45+_0x283efc(0x161));ipWorkerNameCache[_0x399ed8]={'ipAddress':_0x19d890,'macAddress':_0x399ed8,'workerName':_0x18927e,'minerTyped':_0x2a0a45,'apiVersion':_0x316f75},ipWorkerNameCache[_0x19d890]=ipWorkerNameCache[_0x399ed8];if(_0x18927e){let _0x2cd921=_0x32f0d5+'.'+_0x18927e;ipWorkerNameCache[_0x2cd921]=ipWorkerNameCache[_0x399ed8];}}function getWorkerUrl({workerName:_0x4c1080,accountName:_0x4f9264,macAddress:_0x167eed}){const _0x6de26c=_0x7cc027;return _0x4f9264=!_0x4f9264?'':_0x4f9264,svrConfig[_0x6de26c(0x175)]+':'+svrConfig['port']+_0x6de26c(0x146)+encodeURIComponent(_0x4c1080)+_0x6de26c(0x163)+encodeURIComponent(_0x4f9264)+_0x6de26c(0x193)+encodeURIComponent(_0x167eed);}module[_0x7cc027(0x18d)]={'registerProxy':registerProxy,'getWorkerUrl':getWorkerUrl};