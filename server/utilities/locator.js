/* Copyright (C) 9208-9721 Quebec, Inc - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
* Written by Jason Rudland <jason.g.rudland@gmail.com>, September 2022
*/'use strict';const _0x4d970a=_0x2480;(function(_0x46a74f,_0x58a2bc){const _0x1af083=_0x2480,_0x5912ae=_0x46a74f();while(!![]){try{const _0x2c8461=parseInt(_0x1af083(0x1ec))/0x1*(parseInt(_0x1af083(0x1dd))/0x2)+-parseInt(_0x1af083(0x1fc))/0x3+parseInt(_0x1af083(0x202))/0x4+parseInt(_0x1af083(0x1e5))/0x5*(-parseInt(_0x1af083(0x20c))/0x6)+parseInt(_0x1af083(0x1e7))/0x7+parseInt(_0x1af083(0x204))/0x8*(parseInt(_0x1af083(0x203))/0x9)+parseInt(_0x1af083(0x206))/0xa*(parseInt(_0x1af083(0x208))/0xb);if(_0x2c8461===_0x58a2bc)break;else _0x5912ae['push'](_0x5912ae['shift']());}catch(_0x5b90c1){_0x5912ae['push'](_0x5912ae['shift']());}}}(_0x999d,0xbab90));const dgram=require(_0x4d970a(0x1fd)),{StringDecoder}=require('string_decoder'),{getLocalInterface}=require(_0x4d970a(0x201)),{provisionMiner}=require(_0x4d970a(0x205)),{socketSend}=require('./ws-server'),{ipInSubnet}=require(_0x4d970a(0x1f1)),locatorPorts=[0x379b,0x22b8];function _0x999d(){const _0x5d137d=['3568960UeoFAP','72WqaDJT','321416AfFsef','./provision-miner','10RbybQQ','Locator\x20server\x20debounced:\x20','8478514qyykKz','Locator\x20server\x20received:\x20','brand','.\x20debounceTime:\x20','6LZysFm','match','stack','[locator]\x20service\x20unavailable.\x20Exits\x20when\x20network\x20scan\x20is\x20enabled.','exports','address','16FVvTEi','test','0.0.0','then','\x20seconds\x20and\x20to\x20clear?\x20','error','[locator]\x20UDP\x20server\x20listening\x20','bind','6964770fUAjcP','forEach','7310674epKhWB','udp4','Antminer','router','Locator\x20server\x20error:\x0a','72031sWiTdi','[locator]\x20Locator\x20service\x20configured\x20to\x20debounce\x20within\x20','exit','replace','port','./arpscan','\x1b[32m%s\x1b[0m','log','Whatsminer','[locator]\x20Network\x20interface\x20not\x20found.\x20Verify\x20the\x20dhcpSettings\x20in\x20the\x20dataCenterSettings.\x20The\x20server\x20ip\x20must\x20fall\x20within\x20the\x20dhcp\x20range!','Innosilicon','\x1b[31m%s\x1b[0m','\x20having\x20MAC:\x20','write','listening','close','4341870hllKpx','dgram','message','Locator\x20server\x20ignoring\x20IP\x20not\x20in\x20dhcp\x20settings\x20range:\x20\x20','\x20from\x20','./net-interfaces'];_0x999d=function(){return _0x5d137d;};return _0x999d();}let debounceTime=0xf*0x3e8,priorLocate={},server=null;function configPriorLocate(_0x59324e,_0xcc35fb){const _0x531d42=_0x4d970a;debounceTime=_0x59324e*0x3e8,console['log'](_0x531d42(0x1f2),_0x531d42(0x1ed)+_0x59324e+_0x531d42(0x1e1)+_0xcc35fb),_0xcc35fb&&(priorLocate={});}let isIpInSubnet=_0x3c5c67=>/(\d+\.){3}\d+/[_0x4d970a(0x1de)](_0x3c5c67);function createIpInSubnetHandler(_0x476a98){const {range:_0x1df93a,netmask:_0x565925,router:_0x111cea,broadcast:_0x1ac278}=_0x476a98;isIpInSubnet=ipInSubnet(_0x1df93a,_0x565925,_0x111cea,_0x1ac278);}function start(_0x32e47b,_0x45bae0){const _0x42f597=_0x4d970a;let _0xf6c445=_0x32e47b[_0x42f597(0x1ea)][0x0];_0xf6c445=/^10\./[_0x42f597(0x1de)](_0xf6c445)?_0xf6c445[_0x42f597(0x1ef)](/\d+\.\d+\.\d+$/,_0x42f597(0x1df)):_0xf6c445[_0x42f597(0x1ef)](/\d+\.\d+$/,'0.0');const _0x1a48f0=getLocalInterface(_0xf6c445,_0x32e47b['broadcast']);!_0x1a48f0&&(console[_0x42f597(0x1f3)](_0x42f597(0x1f7),_0x42f597(0x1f5),_0x32e47b),console[_0x42f597(0x1f3)](_0x42f597(0x1f7),_0x42f597(0x20f)),_0x45bae0&&process[_0x42f597(0x1ee)](0x0));createIpInSubnetHandler(_0x32e47b);if(!_0x1a48f0)return;const _0x1d4052=new StringDecoder('utf8');locatorPorts[_0x42f597(0x1e6)](_0x498a9f);function _0x498a9f(_0x296572){const _0xfd981=_0x42f597,_0x206ae6=dgram['createSocket'](_0xfd981(0x1e8));_0x206ae6['on'](_0xfd981(0x1e2),_0x21298d=>{const _0x46edcc=_0xfd981;console[_0x46edcc(0x1f3)](_0x46edcc(0x1eb)+_0x21298d[_0x46edcc(0x20e)]),_0x206ae6[_0x46edcc(0x1fb)]();}),_0x206ae6['on'](_0xfd981(0x1fe),(_0x57898d,_0x50163c)=>{const _0x3223d3=_0xfd981,_0x256176=_0x1d4052[_0x3223d3(0x1f9)](_0x57898d),_0x457fe0=_0x50163c[_0x3223d3(0x1dc)],_0x279fcc=(_0x256176[_0x3223d3(0x20d)](/\b((?:[0-9a-f]{2}[:-]){5}(?:[0-9a-f]{2}))(?:\b|$)/i)||[])[0x1],_0x4c5e85=_0x279fcc||_0x457fe0,_0x34b287=priorLocate[_0x4c5e85];if(!_0x34b287||_0x34b287<Date['now']()-debounceTime){priorLocate[_0x4c5e85]=Date['now']();const _0x56504b=_0x3223d3(0x209)+_0x256176+_0x3223d3(0x200)+_0x457fe0+':'+_0x50163c[_0x3223d3(0x1f0)]+_0x3223d3(0x1f8)+_0x279fcc+'.';console[_0x3223d3(0x1f3)](_0x56504b),socketSend({'text':_0x56504b});let _0xe4564={'brand':_0x3223d3(0x1e9)};if(/MAC:/[_0x3223d3(0x1de)](_0x256176))_0xe4564[_0x3223d3(0x20a)]=_0x3223d3(0x1f4);else _0x50163c[_0x3223d3(0x1f0)]!==0x379c&&(_0xe4564['brand']=_0x3223d3(0x1f6));if(isIpInSubnet(_0x457fe0))provisionMiner({'ipAddress':_0x457fe0,'minerTyped':_0xe4564})[_0x3223d3(0x1e0)](_0x17b518=>{console['log'](_0x17b518);});else{const _0x5b6862=_0x3223d3(0x1ff)+_0x457fe0;console[_0x3223d3(0x1f3)](_0x5b6862),socketSend({'text':_0x5b6862});}}else{if(isIpInSubnet(_0x457fe0)){const _0x1a2a12=_0x3223d3(0x207)+_0x256176+_0x3223d3(0x200)+_0x457fe0+':'+_0x50163c[_0x3223d3(0x1f0)]+_0x3223d3(0x1f8)+_0x279fcc+_0x3223d3(0x20b)+debounceTime;console[_0x3223d3(0x1f3)](_0x1a2a12);}}}),_0x206ae6['on'](_0xfd981(0x1fa),()=>{const _0x6b586a=_0xfd981,_0x833c28=_0x206ae6[_0x6b586a(0x1dc)]();console[_0x6b586a(0x1f3)](_0x6b586a(0x1f2),_0x6b586a(0x1e3)+_0x833c28[_0x6b586a(0x1dc)]+':'+_0x833c28[_0x6b586a(0x1f0)]);}),_0x206ae6[_0xfd981(0x1e4)](_0x296572);}}function _0x2480(_0x3370fe,_0x4f2c19){const _0x999d93=_0x999d();return _0x2480=function(_0x24801c,_0x5ec851){_0x24801c=_0x24801c-0x1db;let _0x152c00=_0x999d93[_0x24801c];return _0x152c00;},_0x2480(_0x3370fe,_0x4f2c19);}module[_0x4d970a(0x1db)]={'start':start,'configPriorLocate':configPriorLocate};