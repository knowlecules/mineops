/* Copyright (C) 9208-9721 Quebec, Inc - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
* Written by Jason Rudland <jason.g.rudland@gmail.com>, September 2022
*/'use strict';const _0x165613=_0x36d9;(function(_0x518f11,_0x2c36aa){const _0x2cac30=_0x36d9,_0x34212f=_0x518f11();while(!![]){try{const _0x1ebb76=parseInt(_0x2cac30(0x82))/0x1*(parseInt(_0x2cac30(0x7a))/0x2)+parseInt(_0x2cac30(0x93))/0x3+parseInt(_0x2cac30(0x76))/0x4*(-parseInt(_0x2cac30(0x86))/0x5)+-parseInt(_0x2cac30(0x95))/0x6*(-parseInt(_0x2cac30(0x7f))/0x7)+parseInt(_0x2cac30(0x84))/0x8+parseInt(_0x2cac30(0x7b))/0x9+-parseInt(_0x2cac30(0x8d))/0xa*(parseInt(_0x2cac30(0x73))/0xb);if(_0x1ebb76===_0x2c36aa)break;else _0x34212f['push'](_0x34212f['shift']());}catch(_0x3826d3){_0x34212f['push'](_0x34212f['shift']());}}}(_0x2f5b,0xcc1a4));function _0x2f5b(){const _0x5a04ee=['./arpscan','719938MvcGAh','router','867312aqhEMD','.\x20debounceTime:\x20','42990yujRJC','./net-interfaces','address','replace','brand','broadcast','match','30990BkvSlA','[locator]\x20service\x20unavailable.\x20Exits\x20when\x20network\x20scan\x20is\x20enabled.','udp4','close','[locator]\x20UDP\x20server\x20listening\x20','Whatsminer','621429qbjbSF','then','78HtTKwM','stack','listening','utf8','forEach','message','\x1b[31m%s\x1b[0m','port','error','Locator\x20server\x20ignoring\x20IP\x20not\x20in\x20dhcp\x20settings\x20range:\x20\x20','\x20from\x20','\x20having\x20MAC:\x20','Locator\x20server\x20received:\x20','string_decoder','6248FbESQm','bind','test','56emmNSV','[locator]\x20Network\x20interface\x20not\x20found.\x20Verify\x20the\x20dhcpSettings\x20in\x20the\x20dataCenterSettings.\x20The\x20server\x20ip\x20must\x20fall\x20within\x20the\x20dhcp\x20range!','Locator\x20server\x20error:\x0a','now','2AHssAs','8340858hALMhe','\x1b[32m%s\x1b[0m','log','write','406189sQVJXL','Antminer'];_0x2f5b=function(){return _0x5a04ee;};return _0x2f5b();}const dgram=require('dgram'),{StringDecoder}=require(_0x165613(0x72)),{getLocalInterface}=require(_0x165613(0x87)),{provisionMiner}=require('./provision-miner'),{socketSend}=require('./ws-server'),{ipInSubnet}=require(_0x165613(0x81)),locatorPorts=[0x379b,0x22b8];let debounceTime=0xf*0x3e8,priorLocate={},server=null;function configPriorLocate(_0x311185,_0x5b06c7){const _0x153e1e=_0x165613;debounceTime=_0x311185*0x3e8,console[_0x153e1e(0x7d)](_0x153e1e(0x7c),'[locator]\x20Locator\x20service\x20configured\x20to\x20debounce\x20within\x20'+_0x311185+'\x20seconds\x20and\x20to\x20clear?\x20'+_0x5b06c7),_0x5b06c7&&(priorLocate={});}let isIpInSubnet=_0x2bf23d=>/(\d+\.){3}\d+/[_0x165613(0x75)](_0x2bf23d);function createIpInSubnetHandler(_0x47854c){const {range:_0xb5f476,netmask:_0x586eec,router:_0x135a23,broadcast:_0x2cf01b}=_0x47854c;isIpInSubnet=ipInSubnet(_0xb5f476,_0x586eec,_0x135a23,_0x2cf01b);}function _0x36d9(_0xccbd42,_0x1d08bd){const _0x2f5b7e=_0x2f5b();return _0x36d9=function(_0x36d9ca,_0x5279c0){_0x36d9ca=_0x36d9ca-0x6f;let _0x3fab6d=_0x2f5b7e[_0x36d9ca];return _0x3fab6d;},_0x36d9(_0xccbd42,_0x1d08bd);}function start(_0x2e90a8,_0x2c6c89){const _0x18d313=_0x165613;let _0x50439e=_0x2e90a8[_0x18d313(0x83)][0x0];_0x50439e=/^10\./[_0x18d313(0x75)](_0x50439e)?_0x50439e[_0x18d313(0x89)](/\d+\.\d+\.\d+$/,'0.0.0'):_0x50439e['replace'](/\d+\.\d+$/,'0.0');const _0x44053e=getLocalInterface(_0x50439e,_0x2e90a8[_0x18d313(0x8b)]);!_0x44053e&&(console[_0x18d313(0x7d)](_0x18d313(0x9b),_0x18d313(0x77),_0x2e90a8),console[_0x18d313(0x7d)]('\x1b[31m%s\x1b[0m',_0x18d313(0x8e)),_0x2c6c89&&process['exit'](0x0));createIpInSubnetHandler(_0x2e90a8);if(!_0x44053e)return;const _0x3ac874=new StringDecoder(_0x18d313(0x98));locatorPorts[_0x18d313(0x99)](_0x59808a);function _0x59808a(_0x152f16){const _0x124e0a=_0x18d313,_0x4ec0f9=dgram['createSocket'](_0x124e0a(0x8f));_0x4ec0f9['on'](_0x124e0a(0x9d),_0x5450c1=>{const _0x2d8377=_0x124e0a;console[_0x2d8377(0x7d)](_0x2d8377(0x78)+_0x5450c1[_0x2d8377(0x96)]),_0x4ec0f9[_0x2d8377(0x90)]();}),_0x4ec0f9['on'](_0x124e0a(0x9a),(_0x3135df,_0x473c23)=>{const _0x380d7d=_0x124e0a,_0x1e0016=_0x3ac874[_0x380d7d(0x7e)](_0x3135df),_0x43c329=_0x473c23[_0x380d7d(0x88)],_0xde19e0=(_0x1e0016[_0x380d7d(0x8c)](/\b((?:[0-9a-f]{2}[:-]){5}(?:[0-9a-f]{2}))(?:\b|$)/i)||[])[0x1],_0x472690=_0xde19e0||_0x43c329,_0x409359=priorLocate[_0x472690];if(!_0x409359||_0x409359<Date[_0x380d7d(0x79)]()-debounceTime){priorLocate[_0x472690]=Date[_0x380d7d(0x79)]();const _0x348ebd=_0x380d7d(0x71)+_0x1e0016+'\x20from\x20'+_0x43c329+':'+_0x473c23[_0x380d7d(0x9c)]+_0x380d7d(0x70)+_0xde19e0+'.';console[_0x380d7d(0x7d)](_0x348ebd),socketSend({'text':_0x348ebd});let _0x4c3c5e={'brand':_0x380d7d(0x80)};if(/MAC:/[_0x380d7d(0x75)](_0x1e0016))_0x4c3c5e[_0x380d7d(0x8a)]=_0x380d7d(0x92);else _0x473c23['port']!==0x379c&&(_0x4c3c5e['brand']='Innosilicon');if(isIpInSubnet(_0x43c329))provisionMiner({'ipAddress':_0x43c329,'minerTyped':_0x4c3c5e})[_0x380d7d(0x94)](_0x3daf09=>{const _0x557f2b=_0x380d7d;console[_0x557f2b(0x7d)](_0x3daf09);});else{const _0x16b873=_0x380d7d(0x9e)+_0x43c329;console[_0x380d7d(0x7d)](_0x16b873),socketSend({'text':_0x16b873});}}else{if(isIpInSubnet(_0x43c329)){const _0x57c699='Locator\x20server\x20debounced:\x20'+_0x1e0016+_0x380d7d(0x6f)+_0x43c329+':'+_0x473c23[_0x380d7d(0x9c)]+'\x20having\x20MAC:\x20'+_0xde19e0+_0x380d7d(0x85)+debounceTime;console[_0x380d7d(0x7d)](_0x57c699);}}}),_0x4ec0f9['on'](_0x124e0a(0x97),()=>{const _0xb0cc81=_0x124e0a,_0x2290bd=_0x4ec0f9[_0xb0cc81(0x88)]();console[_0xb0cc81(0x7d)](_0xb0cc81(0x7c),_0xb0cc81(0x91)+_0x2290bd[_0xb0cc81(0x88)]+':'+_0x2290bd['port']);}),_0x4ec0f9[_0x124e0a(0x74)](_0x152f16);}}module['exports']={'start':start,'configPriorLocate':configPriorLocate};