/* Copyright (C) 9208-9721 Quebec, Inc - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
* Written by Jason Rudland <jason.g.rudland@gmail.com>, September 2022
*/'use strict';const _0x4b9350=_0x526f;(function(_0x4d035a,_0x53832b){const _0x577aed=_0x526f,_0x3a2d6c=_0x4d035a();while(!![]){try{const _0xff0008=-parseInt(_0x577aed(0x1e6))/0x1*(parseInt(_0x577aed(0x1e8))/0x2)+parseInt(_0x577aed(0x1f2))/0x3*(-parseInt(_0x577aed(0x204))/0x4)+parseInt(_0x577aed(0x201))/0x5*(parseInt(_0x577aed(0x206))/0x6)+parseInt(_0x577aed(0x1e1))/0x7*(parseInt(_0x577aed(0x205))/0x8)+-parseInt(_0x577aed(0x207))/0x9*(-parseInt(_0x577aed(0x1e0))/0xa)+-parseInt(_0x577aed(0x211))/0xb*(parseInt(_0x577aed(0x1e3))/0xc)+-parseInt(_0x577aed(0x1fe))/0xd*(parseInt(_0x577aed(0x20d))/0xe);if(_0xff0008===_0x53832b)break;else _0x3a2d6c['push'](_0x3a2d6c['shift']());}catch(_0x1aa211){_0x3a2d6c['push'](_0x3a2d6c['shift']());}}}(_0xc907,0x49c22));const dgram=require(_0x4b9350(0x203)),{StringDecoder}=require(_0x4b9350(0x1f7)),{getLocalInterface}=require(_0x4b9350(0x210)),{provisionMiner}=require(_0x4b9350(0x1e2)),{socketSend}=require('./ws-server'),{ipInSubnet}=require(_0x4b9350(0x213)),locatorPorts=[0x379b,0x22b8];function _0x526f(_0x2d7617,_0x3fec4c){const _0xc9074e=_0xc907();return _0x526f=function(_0x526f68,_0x570fcd){_0x526f68=_0x526f68-0x1df;let _0x430fee=_0xc9074e[_0x526f68];return _0x430fee;},_0x526f(_0x2d7617,_0x3fec4c);}function _0xc907(){const _0x4cd053=['[locator]\x20Network\x20interface\x20not\x20found.\x20Verify\x20the\x20dhcpSettings\x20in\x20the\x20dataCenterSettings.\x20The\x20server\x20ip\x20must\x20fall\x20within\x20the\x20dhcp\x20range!','now','forEach','Locator\x20server\x20ignoring\x20IP\x20not\x20in\x20dhcp\x20settings\x20range:\x20\x20','6362636TRdWwh','Locator\x20server\x20received:\x20','0.0.0','./net-interfaces','13607ngLEDL','address','./arpscan','log','10LPWfzd','2355052pJcafp','./provision-miner','132NOOESu','stack','[locator]\x20Locator\x20service\x20configured\x20to\x20debounce\x20within\x20','99277PZHBwm','Innosilicon','2JIZUkT','[locator]\x20service\x20unavailable.\x20Exits\x20when\x20network\x20scan\x20is\x20enabled.','createSocket','port','\x20seconds\x20and\x20to\x20clear?\x20','router','\x1b[32m%s\x1b[0m','message','broadcast','brand','759FZUdnU','close','write','replace','\x1b[31m%s\x1b[0m','string_decoder','.\x20debounceTime:\x20','\x20from\x20','utf8','listening','then','test','13CHSefr','0.0','match','414255djcIOJ','bind','dgram','1480SPYcHK','8XhuVJY','30qkbuvp','1911519YnvDUq','Locator\x20server\x20error:\x0a'];_0xc907=function(){return _0x4cd053;};return _0xc907();}let debounceTime=0xf*0x3e8,priorLocate={},server=null;function configPriorLocate(_0x34bd05,_0x520eeb){const _0x3d0f54=_0x4b9350;debounceTime=_0x34bd05*0x3e8,console[_0x3d0f54(0x1df)](_0x3d0f54(0x1ee),_0x3d0f54(0x1e5)+_0x34bd05+_0x3d0f54(0x1ec)+_0x520eeb),_0x520eeb&&(priorLocate={});}let isIpInSubnet=_0x4222e6=>/(\d+\.){3}\d+/['test'](_0x4222e6);function createIpInSubnetHandler(_0x702633){const {range:_0x248269,netmask:_0xdb51cd,router:_0x5b2bba,broadcast:_0x333809}=_0x702633;isIpInSubnet=ipInSubnet(_0x248269,_0xdb51cd,_0x5b2bba,_0x333809);}function start(_0x58da22,_0x25b5a6){const _0x170936=_0x4b9350;let _0xe7a7d0=_0x58da22[_0x170936(0x1ed)][0x0];_0xe7a7d0=/^10\./['test'](_0xe7a7d0)?_0xe7a7d0[_0x170936(0x1f5)](/\d+\.\d+\.\d+$/,_0x170936(0x20f)):_0xe7a7d0['replace'](/\d+\.\d+$/,_0x170936(0x1ff));const _0x5d2dd6=getLocalInterface(_0xe7a7d0,_0x58da22[_0x170936(0x1f0)]);!_0x5d2dd6&&(console[_0x170936(0x1df)](_0x170936(0x1f6),_0x170936(0x209),_0x58da22),console[_0x170936(0x1df)](_0x170936(0x1f6),_0x170936(0x1e9)),_0x25b5a6&&process['exit'](0x0));createIpInSubnetHandler(_0x58da22);if(!_0x5d2dd6)return;const _0x40f2ab=new StringDecoder(_0x170936(0x1fa));locatorPorts[_0x170936(0x20b)](_0x436960);function _0x436960(_0xcaa143){const _0x45808d=_0x170936,_0x56bb10=dgram[_0x45808d(0x1ea)]('udp4');_0x56bb10['on']('error',_0x237db0=>{const _0x98b262=_0x45808d;console['log'](_0x98b262(0x208)+_0x237db0[_0x98b262(0x1e4)]),_0x56bb10[_0x98b262(0x1f3)]();}),_0x56bb10['on'](_0x45808d(0x1ef),(_0x4baf7d,_0xb948ca)=>{const _0x3d5e2e=_0x45808d,_0x102d55=_0x40f2ab[_0x3d5e2e(0x1f4)](_0x4baf7d),_0x32afee=_0xb948ca[_0x3d5e2e(0x212)],_0x498363=(_0x102d55[_0x3d5e2e(0x200)](/\b((?:[0-9a-f]{2}[:-]){5}(?:[0-9a-f]{2}))(?:\b|$)/i)||[])[0x1],_0x5436f8=_0x498363||_0x32afee,_0x4939f6=priorLocate[_0x5436f8];if(!_0x4939f6||_0x4939f6<Date['now']()-debounceTime){priorLocate[_0x5436f8]=Date[_0x3d5e2e(0x20a)]();const _0x21c1f5=_0x3d5e2e(0x20e)+_0x102d55+_0x3d5e2e(0x1f9)+_0x32afee+':'+_0xb948ca[_0x3d5e2e(0x1eb)]+'\x20having\x20MAC:\x20'+_0x498363+'.';console[_0x3d5e2e(0x1df)](_0x21c1f5),socketSend({'text':_0x21c1f5});let _0x562572={'brand':'Antminer'};if(/MAC:/[_0x3d5e2e(0x1fd)](_0x102d55))_0x562572[_0x3d5e2e(0x1f1)]='Whatsminer';else _0xb948ca['port']!==0x379c&&(_0x562572['brand']=_0x3d5e2e(0x1e7));if(isIpInSubnet(_0x32afee))provisionMiner({'ipAddress':_0x32afee,'minerTyped':_0x562572})[_0x3d5e2e(0x1fc)](_0x321333=>{const _0x23caaa=_0x3d5e2e;console[_0x23caaa(0x1df)](_0x321333);});else{const _0x20667c=_0x3d5e2e(0x20c)+_0x32afee;console['log'](_0x20667c),socketSend({'text':_0x20667c});}}else{if(isIpInSubnet(_0x32afee)){const _0x1a5923='Locator\x20server\x20debounced:\x20'+_0x102d55+_0x3d5e2e(0x1f9)+_0x32afee+':'+_0xb948ca[_0x3d5e2e(0x1eb)]+'\x20having\x20MAC:\x20'+_0x498363+_0x3d5e2e(0x1f8)+debounceTime;console[_0x3d5e2e(0x1df)](_0x1a5923);}}}),_0x56bb10['on'](_0x45808d(0x1fb),()=>{const _0x4e845c=_0x45808d,_0x240b41=_0x56bb10[_0x4e845c(0x212)]();console['log'](_0x4e845c(0x1ee),'[locator]\x20UDP\x20server\x20listening\x20'+_0x240b41['address']+':'+_0x240b41['port']);}),_0x56bb10[_0x45808d(0x202)](_0xcaa143);}}module['exports']={'start':start,'configPriorLocate':configPriorLocate};