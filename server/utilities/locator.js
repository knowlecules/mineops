/* Copyright (C) 9208-9721 Quebec, Inc - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
* Written by Jason Rudland <jason.g.rudland@gmail.com>, September 2022
*/'use strict';const _0x14b7d5=_0x5d30;function _0x412a(){const _0x24ccad=['\x1b[32m%s\x1b[0m','dgram','close','udp4','listening','createSocket','router','150326wJrcmP','2810hSPjIG','390iyciqD','\x20from\x20','Whatsminer','236772LyHfQa','[locator]\x20Locator\x20service\x20configured\x20to\x20debounce\x20within\x20','exports','\x1b[31m%s\x1b[0m','now','./arpscan','[locator]\x20Network\x20interface\x20not\x20found.\x20Verify\x20the\x20dhcpSettings\x20in\x20the\x20dataCenterSettings.\x20The\x20server\x20ip\x20must\x20fall\x20within\x20the\x20dhcp\x20range!','3QjpKHh','stack','Locator\x20server\x20error:\x0a','\x20having\x20MAC:\x20','error','message','5716690QADYse','port','0.0','Locator\x20server\x20ignoring\x20IP\x20not\x20in\x20dhcp\x20settings\x20range:\x20\x20','6EWDlxh','284lYtuqm','log','Innosilicon','write','brand','4429348JiPzsc','test','4523784PdInGB','forEach','[locator]\x20UDP\x20server\x20listening\x20','4248588ZQJqjx','utf8','376IZgWHO','exit','[locator]\x20service\x20unavailable.\x20Exits\x20when\x20network\x20scan\x20is\x20enabled.','address','replace'];_0x412a=function(){return _0x24ccad;};return _0x412a();}(function(_0x15e627,_0x31b73f){const _0x32901e=_0x5d30,_0x3ce805=_0x15e627();while(!![]){try{const _0x29c6a5=-parseInt(_0x32901e(0xa6))/0x1*(-parseInt(_0x32901e(0x90))/0x2)+parseInt(_0x32901e(0x9b))/0x3*(parseInt(_0x32901e(0xb0))/0x4)+-parseInt(_0x32901e(0xa1))/0x5+parseInt(_0x32901e(0xa5))/0x6*(parseInt(_0x32901e(0xab))/0x7)+parseInt(_0x32901e(0xb2))/0x8*(-parseInt(_0x32901e(0x94))/0x9)+parseInt(_0x32901e(0x91))/0xa*(parseInt(_0x32901e(0x8f))/0xb)+parseInt(_0x32901e(0xad))/0xc;if(_0x29c6a5===_0x31b73f)break;else _0x3ce805['push'](_0x3ce805['shift']());}catch(_0xfae224){_0x3ce805['push'](_0x3ce805['shift']());}}}(_0x412a,0x985c9));const dgram=require(_0x14b7d5(0xb8)),{StringDecoder}=require('string_decoder'),{getLocalInterface}=require('./net-interfaces'),{provisionMiner}=require('./provision-miner'),{socketSend}=require('./ws-server'),{ipInSubnet}=require(_0x14b7d5(0x99)),locatorPorts=[0x379b,0x22b8];let debounceTime=0xf*0x3e8,priorLocate={},server=null;function _0x5d30(_0x35ef55,_0x11ca74){const _0x412a47=_0x412a();return _0x5d30=function(_0x5d30a4,_0x22d4ab){_0x5d30a4=_0x5d30a4-0x8b;let _0xf7eae1=_0x412a47[_0x5d30a4];return _0xf7eae1;},_0x5d30(_0x35ef55,_0x11ca74);}function configPriorLocate(_0x3f2216,_0x47618f){const _0x488d23=_0x14b7d5;debounceTime=_0x3f2216*0x3e8,console[_0x488d23(0xa7)](_0x488d23(0xb7),_0x488d23(0x95)+_0x3f2216+'\x20seconds\x20and\x20to\x20clear?\x20'+_0x47618f),_0x47618f&&(priorLocate={});}let isIpInSubnet=_0x2495f3=>/(\d+\.){3}\d+/[_0x14b7d5(0xac)](_0x2495f3);function createIpInSubnetHandler(_0x295628){const {range:_0x25f21b,netmask:_0x53c052,router:_0x4438d4,broadcast:_0x5c6f83}=_0x295628;isIpInSubnet=ipInSubnet(_0x25f21b,_0x53c052,_0x4438d4,_0x5c6f83);}function start(_0x185b5e,_0x4b66a9){const _0xac52e2=_0x14b7d5;let _0x5ec692=_0x185b5e[_0xac52e2(0x8e)][0x0];_0x5ec692=/^10\./[_0xac52e2(0xac)](_0x5ec692)?_0x5ec692[_0xac52e2(0xb6)](/\d+\.\d+\.\d+$/,'0.0.0'):_0x5ec692[_0xac52e2(0xb6)](/\d+\.\d+$/,_0xac52e2(0xa3));const _0x47f53c=getLocalInterface(_0x5ec692,_0x185b5e['broadcast']);!_0x47f53c&&(console['log'](_0xac52e2(0x97),_0xac52e2(0x9a),_0x185b5e),console[_0xac52e2(0xa7)]('\x1b[31m%s\x1b[0m',_0xac52e2(0xb4)),_0x4b66a9&&process[_0xac52e2(0xb3)](0x0));createIpInSubnetHandler(_0x185b5e);if(!_0x47f53c)return;const _0x29e7c7=new StringDecoder(_0xac52e2(0xb1));locatorPorts[_0xac52e2(0xae)](_0x4991ee);function _0x4991ee(_0x1691d9){const _0x4761fb=_0xac52e2,_0x3890ce=dgram[_0x4761fb(0x8d)](_0x4761fb(0x8b));_0x3890ce['on'](_0x4761fb(0x9f),_0x281f10=>{const _0x56fb4a=_0x4761fb;console[_0x56fb4a(0xa7)](_0x56fb4a(0x9d)+_0x281f10[_0x56fb4a(0x9c)]),_0x3890ce[_0x56fb4a(0xb9)]();}),_0x3890ce['on'](_0x4761fb(0xa0),(_0x143fc4,_0x5988eb)=>{const _0x2c704e=_0x4761fb,_0x34067d=_0x29e7c7[_0x2c704e(0xa9)](_0x143fc4),_0x359666=_0x5988eb[_0x2c704e(0xb5)],_0x31d6af=(_0x34067d['match'](/\b((?:[0-9a-f]{2}[:-]){5}(?:[0-9a-f]{2}))(?:\b|$)/i)||[])[0x1],_0x1a2459=_0x31d6af||_0x359666,_0x46f2cd=priorLocate[_0x1a2459];if(!_0x46f2cd||_0x46f2cd<Date[_0x2c704e(0x98)]()-debounceTime){priorLocate[_0x1a2459]=Date[_0x2c704e(0x98)]();const _0x11d2f6='Locator\x20server\x20received:\x20'+_0x34067d+_0x2c704e(0x92)+_0x359666+':'+_0x5988eb[_0x2c704e(0xa2)]+_0x2c704e(0x9e)+_0x31d6af+'.';console['log'](_0x11d2f6),socketSend({'text':_0x11d2f6});let _0xf1a179={'brand':'Antminer'};if(/MAC:/[_0x2c704e(0xac)](_0x34067d))_0xf1a179[_0x2c704e(0xaa)]=_0x2c704e(0x93);else _0x5988eb[_0x2c704e(0xa2)]!==0x379c&&(_0xf1a179['brand']=_0x2c704e(0xa8));if(isIpInSubnet(_0x359666))provisionMiner({'ipAddress':_0x359666,'minerTyped':_0xf1a179})['then'](_0x447497=>{console['log'](_0x447497);});else{const _0x575891=_0x2c704e(0xa4)+_0x359666;console[_0x2c704e(0xa7)](_0x575891),socketSend({'text':_0x575891});}}else{if(isIpInSubnet(_0x359666)){const _0x3b315f='Locator\x20server\x20debounced:\x20'+_0x34067d+_0x2c704e(0x92)+_0x359666+':'+_0x5988eb[_0x2c704e(0xa2)]+_0x2c704e(0x9e)+_0x31d6af+'.\x20debounceTime:\x20'+debounceTime;console[_0x2c704e(0xa7)](_0x3b315f);}}}),_0x3890ce['on'](_0x4761fb(0x8c),()=>{const _0x3ec1dc=_0x4761fb,_0x89b708=_0x3890ce[_0x3ec1dc(0xb5)]();console['log']('\x1b[32m%s\x1b[0m',_0x3ec1dc(0xaf)+_0x89b708[_0x3ec1dc(0xb5)]+':'+_0x89b708['port']);}),_0x3890ce['bind'](_0x1691d9);}}module[_0x14b7d5(0x96)]={'start':start,'configPriorLocate':configPriorLocate};