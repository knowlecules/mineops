/* Copyright (C) 9208-9721 Quebec, Inc - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
* Written by Jason Rudland <jason.g.rudland@gmail.com>, September 2022
*/'use strict';const _0x121258=_0x546a;function _0x546a(_0x3d23b1,_0x3f046d){const _0x54d6a2=_0x54d6();return _0x546a=function(_0x546aeb,_0x1d9fbc){_0x546aeb=_0x546aeb-0xc8;let _0x4e8547=_0x54d6a2[_0x546aeb];return _0x4e8547;},_0x546a(_0x3d23b1,_0x3f046d);}(function(_0x2efb10,_0x3f8d61){const _0x3c0da1=_0x546a,_0x274ef3=_0x2efb10();while(!![]){try{const _0x16faf9=parseInt(_0x3c0da1(0xe8))/0x1+parseInt(_0x3c0da1(0xe9))/0x2+parseInt(_0x3c0da1(0xde))/0x3+parseInt(_0x3c0da1(0xd3))/0x4*(parseInt(_0x3c0da1(0xe4))/0x5)+parseInt(_0x3c0da1(0xcc))/0x6+-parseInt(_0x3c0da1(0xe0))/0x7*(-parseInt(_0x3c0da1(0xe3))/0x8)+-parseInt(_0x3c0da1(0xe5))/0x9*(parseInt(_0x3c0da1(0xee))/0xa);if(_0x16faf9===_0x3f8d61)break;else _0x274ef3['push'](_0x274ef3['shift']());}catch(_0x3b79ad){_0x274ef3['push'](_0x274ef3['shift']());}}}(_0x54d6,0xc92f4));const iprange=require(_0x121258(0xc8)),{inspect}=require(_0x121258(0xf3)),IpSubnetCalculator=require(_0x121258(0xf5)),{getVersionInfo}=require(_0x121258(0xef)),{arphosts}=require('./arpscan'),{getMinerSystemInfo}=require(_0x121258(0xf4)),promiseLimit=require('promise-limit');let hostList={};function _0x54d6(){const _0x13bd0f=['test','exports','toString','116ciAfFp','debug','log','[scan]\x20miner\x20ipAddresses\x20left\x20to\x20respond:','map','from','values','split','forEach','sort','[scan]\x20miner\x20already\x20deleted:\x20','1086012SxeWob','prefixSize','126jUwBli','join','cgminer','118848jcVfay','111130XCKckt','9qDUyBU','slice','catch','2066JSagBx','2699464wqIYiS','http','macAddress','length','[scan]\x20checkMiner\x20ignoring\x20version\x20command\x20failure\x20:\x20','20717630xZNBDh','./cgminer-api','push','keys','warn','util','../../common/utilities/miner-settings','ip-subnet-calculator','iprange','failed','label','netmask','1620306LtnoYx','calculateCIDRPrefix','scanThrottleCount','all'];_0x54d6=function(){return _0x13bd0f;};return _0x54d6();}async function scanForMinerVersions(_0x3e1a59,_0x45456c,_0x3fc1ef=![],_0x3de139){const _0x27937f=_0x121258;async function _0x136c70(_0x440d55){const _0x19ddc5=_0x546a,{ip:_0x30328a,mac:_0x3b95f5,label:_0x1cb23a}=_0x440d55,{version:_0x398bb1,source:_0x46756a}=await checkMiner(_0x30328a,_0x3b95f5,_0x1cb23a)[_0x19ddc5(0xe7)](_0x25da70=>{const _0x3835ab=_0x19ddc5;++_0x4f4532;const _0x561d14=inspect(_0x25da70,![],0x5,!![]),_0x245644=Buffer[_0x3835ab(0xd8)](_0x561d14)[_0x3835ab(0xd2)]('base64')[_0x3835ab(0xe6)](-0x20);!_0x1d9d89[_0x245644]&&(_0x1d9d89[_0x245644]={'error':_0x561d14,'ipAddresses':[]}),_0x1d9d89[_0x245644]['ipAddresses'][_0x3835ab(0xf0)](_0x30328a),console[_0x3835ab(0xf2)]('[scan]\x20checkMiner\x20threw\x20an\x20error\x20for:\x20'+_0x30328a+',\x20'+_0x3b95f5,_0x561d14);})||{};return hostList[_0x19ddc5(0xec)]<=_0x4d60da[_0x19ddc5(0xec)]*0.05&&console[_0x19ddc5(0xd5)](_0x19ddc5(0xd6),Object[_0x19ddc5(0xf1)](hostList)),_0x398bb1?(!_0x398bb1[_0x19ddc5(0xca)]?(_0x27bb7c[_0x19ddc5(0xcf)][_0x19ddc5(0xf0)](_0x30328a),_0x27bb7c[_0x46756a][_0x19ddc5(0xf0)](_0x30328a)):_0x5871fe['push'](_0x30328a),_0x5444cd['push'](_0x398bb1),_0x4f9a4c[_0x398bb1['macAddress']]=_0x398bb1):_0x50c7ff[_0x19ddc5(0xf0)](_0x30328a),_0x398bb1;}let _0x5444cd=[],_0x50c7ff=[],_0x5871fe=[],_0x1d9d89={},_0x27bb7c={'cgminer':[],'http':[],'cgminer+http':[],'failed':[],'all':[]},_0x4f4532=0x0,_0x4f9a4c={};const _0x5bf7dd=new Date(),_0x2764aa=_0x3e1a59[_0x27937f(0xce)]||0x80;let _0x28e6f2=promiseLimit(_0x2764aa),_0x4d60da=null;return!_0x3fc1ef&&(_0x4d60da=await arphosts(_0x3e1a59,_0x45456c)['catch'](_0x39f5c3=>{const _0x118a04=_0x27937f;console[_0x118a04(0xf2)]('[scanForMinerVersions]\x20Unexpected\x20ARP\x20scan\x20failed\x20with\x20error,\x20trying\x20http\x20next',_0x39f5c3);})),!_0x4d60da&&(_0x4d60da=getHostsInRange(_0x3e1a59)),_0x3de139&&(_0x4d60da=_0x4d60da['filter'](_0x55dbf7=>_0x3de139['indexOf'](_0x55dbf7['ip'])>=0x0)),_0x45456c&&(hostList={}),_0x4d60da[_0x27937f(0xd7)](_0x6ddcfb=>hostList[_0x6ddcfb['ip']]=_0x6ddcfb),_0x4d60da=Object[_0x27937f(0xd9)](hostList),_0x4d60da[_0x27937f(0xec)]&&await Promise[_0x27937f(0xcf)](_0x4d60da['map'](_0xca794f=>{return _0x28e6f2(()=>_0x136c70(_0xca794f));})),_0x27bb7c['cgminer'][_0x27937f(0xdc)](ipDesc),_0x27bb7c[_0x27937f(0xea)][_0x27937f(0xdc)](ipDesc),_0x27bb7c[_0x27937f(0xc9)]['sort'](ipDesc),_0x27bb7c[_0x27937f(0xcf)]['sort'](ipDesc),_0x50c7ff[_0x27937f(0xdc)](ipDesc),_0x5871fe[_0x27937f(0xdc)](ipDesc),_0x50c7ff[_0x27937f(0xec)]&&console[_0x27937f(0xd5)]('Failed\x20to\x20get\x20version\x20from\x20ipAddresses\x20['+_0x50c7ff['length']+']',_0x50c7ff),{'stats':{'startTime':_0x5bf7dd,'endTime':new Date(),'found':{'all':_0x27bb7c[_0x27937f(0xcf)][_0x27937f(0xec)],'cgminer':_0x27bb7c[_0x27937f(0xe2)][_0x27937f(0xec)],'http':_0x27bb7c[_0x27937f(0xea)]['length'],'cgminer+http':_0x27bb7c['cgminer+http'][_0x27937f(0xec)]},'failed':_0x50c7ff[_0x27937f(0xec)],'skipped':_0x5871fe['length']},'minerVersions':Object[_0x27937f(0xd9)](_0x4f9a4c),'failedIps':_0x50c7ff,'skippedIps':_0x5871fe,'successIps':_0x27bb7c,'exceptions':_0x1d9d89};}const ipAsNum=_0x16b859=>Number(_0x16b859[_0x121258(0xda)]('.')[_0x121258(0xd7)](_0x4c81d9=>('00'+_0x4c81d9)[_0x121258(0xe6)](-0x3))[_0x121258(0xe1)]('')),ipDesc=(_0x3667de,_0x3c45a2)=>{return ipAsNum(_0x3667de)-ipAsNum(_0x3c45a2);};async function getScanCache(_0x562c14,_0x5657c1,_0x4be6ad,_0x4ef400){const _0x3337ea=_0x121258;return(!Object[_0x3337ea(0xf1)](hostList)[_0x3337ea(0xec)]||_0x5657c1)&&await scanForMinerVersions(_0x562c14,_0x5657c1,_0x4be6ad,_0x4ef400),hostList;}function getHostsInRange(_0x1afc0e){const _0x37254a=_0x121258,{range:_0x46ac88}=_0x1afc0e,_0x21d11f=IpSubnetCalculator[_0x37254a(0xcd)](_0x46ac88[0x0],_0x1afc0e[_0x37254a(0xcb)]);let _0x2c975e=iprange(_0x46ac88[0x0]+'/'+_0x21d11f[_0x37254a(0xdf)]),_0xa15a9b=0x0,_0x5a9cc2=_0x2c975e[_0x37254a(0xec)],_0x2bf299=[];for(var _0x1d5a3d=0x0;_0x1d5a3d<_0x46ac88['length'];_0x1d5a3d+=0x2){let _0x5ad46a=_0x46ac88[_0x1d5a3d],_0x272c47=_0x46ac88[_0x1d5a3d+0x1];_0x2c975e[_0x37254a(0xdb)]((_0x8d4508,_0x397e12)=>{if(_0x8d4508==_0x5ad46a)_0xa15a9b=_0x397e12;else _0x8d4508==_0x272c47&&(_0x5a9cc2=_0x397e12);});let _0xf3091=_0x2c975e[_0x37254a(0xe6)](_0xa15a9b,_0x5a9cc2+0x1);_0xf3091[_0x37254a(0xdb)](_0x1a5b37=>{const _0xcfefb1=null;_0x2bf299['push']({'ip':_0x1a5b37,'mac':_0xcfefb1});});}return _0x2bf299;}async function checkMiner(_0xfb3fe,_0x52c183,_0xcca28b='unknown'){const _0x309712=_0x121258;let _0x29377e=await getVersionInfo(_0xfb3fe,_0x52c183)[_0x309712(0xe7)](_0x1cdd61=>{const _0x66e789=_0x309712;return console[_0x66e789(0xd4)](_0x66e789(0xed)+_0xfb3fe+',\x20'+_0x52c183,_0x1cdd61),null;}),_0x4eeb04=_0x309712(0xe2);if(/^[X]/i[_0x309712(0xd0)](_0x29377e['macAddress'])){_0x4eeb04='cgminer+http';const _0x314eb8=await getMinerSystemInfo({'ipAddress':_0xfb3fe,'timeout':0xfa0},_0x29377e);_0x29377e={..._0x29377e,..._0x314eb8};}return!_0x29377e&&(!hostList[_0xfb3fe]?console[_0x309712(0xd4)](_0x309712(0xdd)+_0xfb3fe):delete hostList[_0xfb3fe]),_0x29377e&&!_0x29377e[_0x309712(0xeb)]&&(_0x29377e[_0x309712(0xeb)]=_0x52c183),{'version':_0x29377e,'source':_0x4eeb04};}module[_0x121258(0xd1)]={'scanForMinerVersions':scanForMinerVersions,'getScanCache':getScanCache,'ipDesc':ipDesc};