/* Copyright (C) 9208-9721 Quebec, Inc - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
* Written by Jason Rudland <jason.g.rudland@gmail.com>, September 2022
*/'use strict';const _0x2c7e1a=_0x3977;(function(_0x613bfc,_0x3d7c9c){const _0x53a94a=_0x3977,_0x5ee803=_0x613bfc();while(!![]){try{const _0x5b0c47=parseInt(_0x53a94a(0x81))/0x1+-parseInt(_0x53a94a(0x6b))/0x2+-parseInt(_0x53a94a(0x82))/0x3+-parseInt(_0x53a94a(0x8b))/0x4*(parseInt(_0x53a94a(0x7d))/0x5)+parseInt(_0x53a94a(0x85))/0x6+-parseInt(_0x53a94a(0x73))/0x7+parseInt(_0x53a94a(0x96))/0x8;if(_0x5b0c47===_0x3d7c9c)break;else _0x5ee803['push'](_0x5ee803['shift']());}catch(_0x2a5de7){_0x5ee803['push'](_0x5ee803['shift']());}}}(_0x598d,0x3b32e));const iprange=require(_0x2c7e1a(0x6c)),{inspect}=require(_0x2c7e1a(0x8e)),IpSubnetCalculator=require(_0x2c7e1a(0x6f)),{getVersionInfo}=require(_0x2c7e1a(0x77)),{arphosts}=require(_0x2c7e1a(0x7b)),{getMinerSystemInfo}=require('../../common/utilities/miner-settings'),promiseLimit=require(_0x2c7e1a(0x70));function _0x598d(){const _0x191f45=['407069mJNYDu','891297YEkTmG','ipAddresses','[scan]\x20miner\x20ipAddresses\x20left\x20to\x20respond:','427488oJwAYH','keys','cgminer','split','cgminer+http','[scanForMinerVersions]\x20Unexpected\x20ARP\x20scan\x20failed\x20with\x20error,\x20trying\x20http\x20next','750764PZQCsn','scanThrottleCount','forEach','util','exports','base64','catch','failed','prefixSize','indexOf','map','5309800MgxAds','length','unknown','all','http','sort','189380xYwpfK','iprange','join','push','ip-subnet-calculator','promise-limit','warn','values','2240588eGWCZw','slice','label','[scan]\x20miner\x20already\x20deleted:\x20','./cgminer-api','filter','test','log','./arpscan','toString','5aheJjG','netmask','macAddress','[scan]\x20checkMiner\x20ignoring\x20version\x20command\x20failure\x20:\x20'];_0x598d=function(){return _0x191f45;};return _0x598d();}let hostList={};function _0x3977(_0x512599,_0xe98f8e){const _0x598d6=_0x598d();return _0x3977=function(_0x3977e5,_0x2e0a8e){_0x3977e5=_0x3977e5-0x6a;let _0xa64192=_0x598d6[_0x3977e5];return _0xa64192;},_0x3977(_0x512599,_0xe98f8e);}async function scanForMinerVersions(_0x4090cc,_0x55fc66,_0x3423c9=![],_0x52e3fa){const _0x4dc6eb=_0x2c7e1a;async function _0x560e67(_0x5e9842){const _0x1c5aa3=_0x3977,{ip:_0x91131a,mac:_0x108cf8,label:_0x3a3817}=_0x5e9842,{version:_0x3c6a4b,source:_0x167bd0}=await checkMiner(_0x91131a,_0x108cf8,_0x3a3817)['catch'](_0x38d32b=>{const _0x387632=_0x3977;++_0x284c7f;const _0x4ab0c0=inspect(_0x38d32b,![],0x5,!![]),_0x1168fd=Buffer['from'](_0x4ab0c0)[_0x387632(0x7c)](_0x387632(0x90))[_0x387632(0x74)](-0x20);!_0x5d1747[_0x1168fd]&&(_0x5d1747[_0x1168fd]={'error':_0x4ab0c0,'ipAddresses':[]}),_0x5d1747[_0x1168fd][_0x387632(0x83)][_0x387632(0x6e)](_0x91131a),console[_0x387632(0x71)]('[scan]\x20checkMiner\x20threw\x20an\x20error\x20for:\x20'+_0x91131a+',\x20'+_0x108cf8,_0x4ab0c0);})||{};return hostList[_0x1c5aa3(0x97)]<=_0x4d89fd[_0x1c5aa3(0x97)]*0.05&&console[_0x1c5aa3(0x7a)](_0x1c5aa3(0x84),Object['keys'](hostList)),_0x3c6a4b?(!_0x3c6a4b[_0x1c5aa3(0x75)]?(_0xd45e6e[_0x1c5aa3(0x99)][_0x1c5aa3(0x6e)](_0x91131a),_0xd45e6e[_0x167bd0][_0x1c5aa3(0x6e)](_0x91131a)):_0x4cad8f['push'](_0x91131a),_0x20a5b1[_0x1c5aa3(0x6e)](_0x3c6a4b),_0x1302de[_0x3c6a4b[_0x1c5aa3(0x7f)]]=_0x3c6a4b):_0x4e9720[_0x1c5aa3(0x6e)](_0x91131a),_0x3c6a4b;}let _0x20a5b1=[],_0x4e9720=[],_0x4cad8f=[],_0x5d1747={},_0xd45e6e={'cgminer':[],'http':[],'cgminer+http':[],'failed':[],'all':[]},_0x284c7f=0x0,_0x1302de={};const _0x51b972=new Date(),_0x35a033=_0x4090cc[_0x4dc6eb(0x8c)]||0x80;let _0x18099b=promiseLimit(_0x35a033),_0x4d89fd=null;return!_0x3423c9&&(_0x4d89fd=await arphosts(_0x4090cc,_0x55fc66)[_0x4dc6eb(0x91)](_0x32187e=>{const _0x1566b3=_0x4dc6eb;console[_0x1566b3(0x71)](_0x1566b3(0x8a),_0x32187e);})),!_0x4d89fd&&(_0x4d89fd=getHostsInRange(_0x4090cc)),_0x52e3fa&&(_0x4d89fd=_0x4d89fd[_0x4dc6eb(0x78)](_0x4852bf=>_0x52e3fa[_0x4dc6eb(0x94)](_0x4852bf['ip'])>=0x0)),_0x55fc66&&(hostList={}),_0x4d89fd[_0x4dc6eb(0x95)](_0x28316a=>hostList[_0x28316a['ip']]=_0x28316a),_0x4d89fd=Object[_0x4dc6eb(0x72)](hostList),_0x4d89fd[_0x4dc6eb(0x97)]&&await Promise[_0x4dc6eb(0x99)](_0x4d89fd['map'](_0x3e6c6e=>{return _0x18099b(()=>_0x560e67(_0x3e6c6e));})),_0xd45e6e[_0x4dc6eb(0x87)][_0x4dc6eb(0x6a)](ipDesc),_0xd45e6e[_0x4dc6eb(0x9a)][_0x4dc6eb(0x6a)](ipDesc),_0xd45e6e[_0x4dc6eb(0x92)]['sort'](ipDesc),_0xd45e6e[_0x4dc6eb(0x99)]['sort'](ipDesc),_0x4e9720['sort'](ipDesc),_0x4cad8f[_0x4dc6eb(0x6a)](ipDesc),_0x4e9720[_0x4dc6eb(0x97)]&&console[_0x4dc6eb(0x7a)]('Failed\x20to\x20get\x20version\x20from\x20ipAddresses\x20['+_0x4e9720[_0x4dc6eb(0x97)]+']',_0x4e9720),{'stats':{'startTime':_0x51b972,'endTime':new Date(),'found':{'all':_0xd45e6e[_0x4dc6eb(0x99)][_0x4dc6eb(0x97)],'cgminer':_0xd45e6e[_0x4dc6eb(0x87)]['length'],'http':_0xd45e6e[_0x4dc6eb(0x9a)][_0x4dc6eb(0x97)],'cgminer+http':_0xd45e6e['cgminer+http'][_0x4dc6eb(0x97)]},'failed':_0x4e9720[_0x4dc6eb(0x97)],'skipped':_0x4cad8f[_0x4dc6eb(0x97)]},'minerVersions':Object['values'](_0x1302de),'failedIps':_0x4e9720,'skippedIps':_0x4cad8f,'successIps':_0xd45e6e,'exceptions':_0x5d1747};}const ipAsNum=_0x2d86de=>Number(_0x2d86de[_0x2c7e1a(0x88)]('.')[_0x2c7e1a(0x95)](_0x13158e=>('00'+_0x13158e)[_0x2c7e1a(0x74)](-0x3))[_0x2c7e1a(0x6d)]('')),ipDesc=(_0x486e53,_0x1ff54e)=>{return ipAsNum(_0x486e53)-ipAsNum(_0x1ff54e);};async function getScanCache(_0x4ba7a6,_0x23aee9,_0x56ea27,_0x2aadc4){const _0xab2cb4=_0x2c7e1a;return(!Object[_0xab2cb4(0x86)](hostList)[_0xab2cb4(0x97)]||_0x23aee9)&&await scanForMinerVersions(_0x4ba7a6,_0x23aee9,_0x56ea27,_0x2aadc4),hostList;}function getHostsInRange(_0x247f67){const _0x5d2bfc=_0x2c7e1a,{range:_0x2998ff}=_0x247f67,_0x1fbb8e=IpSubnetCalculator['calculateCIDRPrefix'](_0x2998ff[0x0],_0x247f67[_0x5d2bfc(0x7e)]);let _0x202429=iprange(_0x2998ff[0x0]+'/'+_0x1fbb8e[_0x5d2bfc(0x93)]),_0x1bdc36=0x0,_0x70470e=_0x202429[_0x5d2bfc(0x97)],_0x2c4e91=[];for(var _0x2da77f=0x0;_0x2da77f<_0x2998ff['length'];_0x2da77f+=0x2){let _0x5788aa=_0x2998ff[_0x2da77f],_0x14ed53=_0x2998ff[_0x2da77f+0x1];_0x202429[_0x5d2bfc(0x8d)]((_0x14c633,_0xe88961)=>{if(_0x14c633==_0x5788aa)_0x1bdc36=_0xe88961;else _0x14c633==_0x14ed53&&(_0x70470e=_0xe88961);});let _0x158204=_0x202429[_0x5d2bfc(0x74)](_0x1bdc36,_0x70470e+0x1);_0x158204[_0x5d2bfc(0x8d)](_0x38507b=>{const _0x47b10f=null;_0x2c4e91['push']({'ip':_0x38507b,'mac':_0x47b10f});});}return _0x2c4e91;}async function checkMiner(_0x26d3c2,_0x209a69,_0x258e11=_0x2c7e1a(0x98)){const _0x3d3176=_0x2c7e1a;let _0x18b3cc=await getVersionInfo(_0x26d3c2,_0x209a69)['catch'](_0x47921e=>{const _0x57240a=_0x3977;return console['debug'](_0x57240a(0x80)+_0x26d3c2+',\x20'+_0x209a69,_0x47921e),null;}),_0x35e6ce='cgminer';if(/^[X]/i[_0x3d3176(0x79)](_0x18b3cc[_0x3d3176(0x7f)])){_0x35e6ce=_0x3d3176(0x89);const _0x5675c9=await getMinerSystemInfo({'ipAddress':_0x26d3c2,'timeout':0xfa0},_0x18b3cc);_0x18b3cc={..._0x18b3cc,..._0x5675c9};}return!_0x18b3cc&&(!hostList[_0x26d3c2]?console['debug'](_0x3d3176(0x76)+_0x26d3c2):delete hostList[_0x26d3c2]),_0x18b3cc&&!_0x18b3cc[_0x3d3176(0x7f)]&&(_0x18b3cc[_0x3d3176(0x7f)]=_0x209a69),{'version':_0x18b3cc,'source':_0x35e6ce};}module[_0x2c7e1a(0x8f)]={'scanForMinerVersions':scanForMinerVersions,'getScanCache':getScanCache,'ipDesc':ipDesc};