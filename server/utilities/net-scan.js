/* Copyright (C) 9208-9721 Quebec, Inc - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
* Written by Jason Rudland <jason.g.rudland@gmail.com>, September 2022
*/'use strict';function _0x240e(_0xf23749,_0x1818cc){const _0x56d53a=_0x56d5();return _0x240e=function(_0x240eda,_0x3af89d){_0x240eda=_0x240eda-0x179;let _0x1e1e83=_0x56d53a[_0x240eda];return _0x1e1e83;},_0x240e(_0xf23749,_0x1818cc);}const _0x3d8943=_0x240e;(function(_0x4dfcc1,_0x86b7b4){const _0x119cbc=_0x240e,_0x3f97b1=_0x4dfcc1();while(!![]){try{const _0x335234=parseInt(_0x119cbc(0x17e))/0x1*(-parseInt(_0x119cbc(0x18e))/0x2)+-parseInt(_0x119cbc(0x17a))/0x3*(-parseInt(_0x119cbc(0x181))/0x4)+-parseInt(_0x119cbc(0x1a6))/0x5*(parseInt(_0x119cbc(0x180))/0x6)+-parseInt(_0x119cbc(0x18f))/0x7+parseInt(_0x119cbc(0x198))/0x8+parseInt(_0x119cbc(0x18b))/0x9+parseInt(_0x119cbc(0x17d))/0xa*(-parseInt(_0x119cbc(0x197))/0xb);if(_0x335234===_0x86b7b4)break;else _0x3f97b1['push'](_0x3f97b1['shift']());}catch(_0x46f16a){_0x3f97b1['push'](_0x3f97b1['shift']());}}}(_0x56d5,0x4f1c5));const iprange=require(_0x3d8943(0x1a4)),{inspect}=require(_0x3d8943(0x18a)),IpSubnetCalculator=require('ip-subnet-calculator'),{getVersionInfo}=require(_0x3d8943(0x193)),{arphosts}=require(_0x3d8943(0x18c)),{getMinerSystemInfo}=require(_0x3d8943(0x17f)),promiseLimit=require('promise-limit');let hostList={};function _0x56d5(){const _0x9977b9=['17412Ajjdye','2060140HMkoni','catch','Failed\x20to\x20get\x20version\x20from\x20ipAddresses\x20[','sort','label','ipAddresses','cgminer+http','base64','debug','util','5359266yVFriG','./arpscan','exports','14910uloIwX','612038elahRk','failed','push','macAddress','./cgminer-api','all','netmask','cgminer','415943liCSBL','3109904CPnwqB','keys','scanThrottleCount','[scanForMinerVersions]\x20Unexpected\x20ARP\x20scan\x20failed\x20with\x20error,\x20trying\x20http\x20next','prefixSize','unknown','filter','forEach','length','from','[scan]\x20miner\x20already\x20deleted:\x20','values','iprange','log','820eChTez','http','warn','slice','3WXFugz','indexOf','map','10QlcpEg','77azHCWA','../../common/utilities/miner-settings'];_0x56d5=function(){return _0x9977b9;};return _0x56d5();}async function scanForMinerVersions(_0x3e8fb3,_0x36bfc6,_0x97d5c5=![],_0x2d5cf2){const _0x39f1ef=_0x3d8943;async function _0x3e92dc(_0x546580){const _0x1fde62=_0x240e,{ip:_0x194019,mac:_0x5f3cda,label:_0x701df1}=_0x546580,{version:_0xa3144d,source:_0x47a84f}=await checkMiner(_0x194019,_0x5f3cda,_0x701df1)[_0x1fde62(0x182)](_0x350f3f=>{const _0x4f7210=_0x1fde62;++_0x123333;const _0x3a2ca2=inspect(_0x350f3f,![],0x5,!![]),_0x215a57=Buffer[_0x4f7210(0x1a1)](_0x3a2ca2)['toString'](_0x4f7210(0x188))[_0x4f7210(0x179)](-0x20);!_0x41c4e6[_0x215a57]&&(_0x41c4e6[_0x215a57]={'error':_0x3a2ca2,'ipAddresses':[]}),_0x41c4e6[_0x215a57][_0x4f7210(0x186)][_0x4f7210(0x191)](_0x194019),console[_0x4f7210(0x1a8)]('[scan]\x20checkMiner\x20threw\x20an\x20error\x20for:\x20'+_0x194019+',\x20'+_0x5f3cda,_0x3a2ca2);})||{};return hostList['length']<=_0x37d27f[_0x1fde62(0x1a0)]*0.05&&console[_0x1fde62(0x1a5)]('[scan]\x20miner\x20ipAddresses\x20left\x20to\x20respond:',Object[_0x1fde62(0x199)](hostList)),_0xa3144d?(!_0xa3144d[_0x1fde62(0x185)]?(_0x58397d[_0x1fde62(0x194)][_0x1fde62(0x191)](_0x194019),_0x58397d[_0x47a84f][_0x1fde62(0x191)](_0x194019)):_0x665707[_0x1fde62(0x191)](_0x194019),_0x238710['push'](_0xa3144d),_0x33e835[_0xa3144d[_0x1fde62(0x192)]]=_0xa3144d):_0x446d71[_0x1fde62(0x191)](_0x194019),_0xa3144d;}let _0x238710=[],_0x446d71=[],_0x665707=[],_0x41c4e6={},_0x58397d={'cgminer':[],'http':[],'cgminer+http':[],'failed':[],'all':[]},_0x123333=0x0,_0x33e835={};const _0x16ca8d=new Date(),_0x55faf7=_0x3e8fb3[_0x39f1ef(0x19a)]||0x80;let _0x3fb94e=promiseLimit(_0x55faf7),_0x37d27f=null;return!_0x97d5c5&&(_0x37d27f=await arphosts(_0x3e8fb3,_0x36bfc6)[_0x39f1ef(0x182)](_0x5454b5=>{const _0x373034=_0x39f1ef;console['warn'](_0x373034(0x19b),_0x5454b5);})),!_0x37d27f&&(_0x37d27f=getHostsInRange(_0x3e8fb3)),_0x2d5cf2&&(_0x37d27f=_0x37d27f[_0x39f1ef(0x19e)](_0x99553c=>_0x2d5cf2[_0x39f1ef(0x17b)](_0x99553c['ip'])>=0x0)),_0x36bfc6&&(hostList={}),_0x37d27f['map'](_0x33fb8c=>hostList[_0x33fb8c['ip']]=_0x33fb8c),_0x37d27f=Object[_0x39f1ef(0x1a3)](hostList),_0x37d27f[_0x39f1ef(0x1a0)]&&await Promise[_0x39f1ef(0x194)](_0x37d27f[_0x39f1ef(0x17c)](_0x3ffa96=>{return _0x3fb94e(()=>_0x3e92dc(_0x3ffa96));})),_0x58397d['cgminer'][_0x39f1ef(0x184)](ipDesc),_0x58397d[_0x39f1ef(0x1a7)][_0x39f1ef(0x184)](ipDesc),_0x58397d[_0x39f1ef(0x190)][_0x39f1ef(0x184)](ipDesc),_0x58397d[_0x39f1ef(0x194)]['sort'](ipDesc),_0x446d71[_0x39f1ef(0x184)](ipDesc),_0x665707[_0x39f1ef(0x184)](ipDesc),_0x446d71[_0x39f1ef(0x1a0)]&&console[_0x39f1ef(0x1a5)](_0x39f1ef(0x183)+_0x446d71['length']+']',_0x446d71),{'stats':{'startTime':_0x16ca8d,'endTime':new Date(),'found':{'all':_0x58397d['all'][_0x39f1ef(0x1a0)],'cgminer':_0x58397d[_0x39f1ef(0x196)]['length'],'http':_0x58397d['http']['length'],'cgminer+http':_0x58397d[_0x39f1ef(0x187)][_0x39f1ef(0x1a0)]},'failed':_0x446d71[_0x39f1ef(0x1a0)],'skipped':_0x665707[_0x39f1ef(0x1a0)]},'minerVersions':Object[_0x39f1ef(0x1a3)](_0x33e835),'failedIps':_0x446d71,'skippedIps':_0x665707,'successIps':_0x58397d,'exceptions':_0x41c4e6};}const ipAsNum=_0x21d208=>Number(_0x21d208['split']('.')[_0x3d8943(0x17c)](_0x529916=>('00'+_0x529916)[_0x3d8943(0x179)](-0x3))['join']('')),ipDesc=(_0x1e47eb,_0x5f30fc)=>{return ipAsNum(_0x1e47eb)-ipAsNum(_0x5f30fc);};async function getScanCache(_0x569876,_0x3ce222,_0x3c980c,_0x3007fd){const _0xcfbf80=_0x3d8943;return(!Object[_0xcfbf80(0x199)](hostList)[_0xcfbf80(0x1a0)]||_0x3ce222)&&await scanForMinerVersions(_0x569876,_0x3ce222,_0x3c980c,_0x3007fd),hostList;}function getHostsInRange(_0x2887fa){const _0x5590c0=_0x3d8943,{range:_0x1914de}=_0x2887fa,_0x403c5f=IpSubnetCalculator['calculateCIDRPrefix'](_0x1914de[0x0],_0x2887fa[_0x5590c0(0x195)]);let _0x51f565=iprange(_0x1914de[0x0]+'/'+_0x403c5f[_0x5590c0(0x19c)]),_0x5f1c38=0x0,_0x463b16=_0x51f565['length'],_0x2c31fd=[];for(var _0x493966=0x0;_0x493966<_0x1914de[_0x5590c0(0x1a0)];_0x493966+=0x2){let _0x50b69a=_0x1914de[_0x493966],_0x352e4f=_0x1914de[_0x493966+0x1];_0x51f565['forEach']((_0x5aef4f,_0x17f17b)=>{if(_0x5aef4f==_0x50b69a)_0x5f1c38=_0x17f17b;else _0x5aef4f==_0x352e4f&&(_0x463b16=_0x17f17b);});let _0xbb69fb=_0x51f565[_0x5590c0(0x179)](_0x5f1c38,_0x463b16+0x1);_0xbb69fb[_0x5590c0(0x19f)](_0x483398=>{const _0x4ba962=_0x5590c0,_0x1c05bd=null;_0x2c31fd[_0x4ba962(0x191)]({'ip':_0x483398,'mac':_0x1c05bd});});}return _0x2c31fd;}async function checkMiner(_0x28044d,_0x2f4444,_0x51e331=_0x3d8943(0x19d)){const _0x24d6ee=_0x3d8943;let _0x39103b=await getVersionInfo(_0x28044d,_0x2f4444)[_0x24d6ee(0x182)](_0x347b19=>{const _0x457179=_0x24d6ee;return console[_0x457179(0x189)]('[scan]\x20checkMiner\x20ignoring\x20version\x20command\x20failure\x20:\x20'+_0x28044d+',\x20'+_0x2f4444,_0x347b19),null;}),_0x3d9e22=_0x24d6ee(0x196);if(/^[X]/i['test'](_0x39103b[_0x24d6ee(0x192)])){_0x3d9e22=_0x24d6ee(0x187);const _0x58e9d2=await getMinerSystemInfo({'ipAddress':_0x28044d,'timeout':0xfa0},_0x39103b);_0x39103b={..._0x39103b,..._0x58e9d2};}return!_0x39103b&&(!hostList[_0x28044d]?console[_0x24d6ee(0x189)](_0x24d6ee(0x1a2)+_0x28044d):delete hostList[_0x28044d]),_0x39103b&&!_0x39103b[_0x24d6ee(0x192)]&&(_0x39103b[_0x24d6ee(0x192)]=_0x2f4444),{'version':_0x39103b,'source':_0x3d9e22};}module[_0x3d8943(0x18d)]={'scanForMinerVersions':scanForMinerVersions,'getScanCache':getScanCache,'ipDesc':ipDesc};