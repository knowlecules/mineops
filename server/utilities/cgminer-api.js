/* Copyright (C) 9208-9721 Quebec, Inc - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
* Written by Jason Rudland <jason.g.rudland@gmail.com>, September 2022
*/'use strict';const _0x4c799c=_0x1d27;(function(_0x3a8a8e,_0x20e5da){const _0xaa14b9=_0x1d27,_0x4070f8=_0x3a8a8e();while(!![]){try{const _0x2f1a5b=parseInt(_0xaa14b9(0xc4))/0x1+-parseInt(_0xaa14b9(0xb9))/0x2*(-parseInt(_0xaa14b9(0xbe))/0x3)+parseInt(_0xaa14b9(0xc9))/0x4+-parseInt(_0xaa14b9(0x9c))/0x5*(-parseInt(_0xaa14b9(0xaf))/0x6)+parseInt(_0xaa14b9(0xbd))/0x7+-parseInt(_0xaa14b9(0xc0))/0x8*(parseInt(_0xaa14b9(0xc6))/0x9)+-parseInt(_0xaa14b9(0xa3))/0xa*(parseInt(_0xaa14b9(0xe2))/0xb);if(_0x2f1a5b===_0x20e5da)break;else _0x4070f8['push'](_0x4070f8['shift']());}catch(_0x41adc7){_0x4070f8['push'](_0x4070f8['shift']());}}}(_0x4f11,0x4c19c));function _0x1d27(_0x315dae,_0x32bffe){const _0x4f111d=_0x4f11();return _0x1d27=function(_0x1d2758,_0x54fcbb){_0x1d2758=_0x1d2758-0x9c;let _0x53b825=_0x4f111d[_0x1d2758];return _0x53b825;},_0x1d27(_0x315dae,_0x32bffe);}const net=require('net'),{inspect}=require(_0x4c799c(0xb0)),cgminerPort=0xfbc,CONN_TIMEOUT=0xbb8,SOCK_TIMEOUT=0xfa0,MSG_TIMEOUT=0x1f40,label='cgminer-api',commandAlwaysArray={'pools':!![],'devs':!![],'edevs':!![],'procs':!![],'notify':!![],'devdetails':!![],'stats':!![],'estats':!![]};function MinerRPCClient(_0x52bc98,_0xf7e948){const _0x45986f=_0x4c799c;let _0x9000af=this;_0x9000af[_0x45986f(0xa9)]=_0x52bc98||_0x45986f(0xce),_0x9000af[_0x45986f(0xc2)]=_0xf7e948||cgminerPort;}MinerRPCClient[_0x4c799c(0xcd)]['get']=function(_0x2e366e,_0x2b3fc,_0x3bd8e0){const _0xe44327=_0x4c799c;let _0x1a83c8=this;if(/\+/[_0xe44327(0xb2)](_0x2e366e))return _0x3bd8e0(new Error(_0xe44327(0xc3)));typeof _0x2b3fc=='function'&&(_0x3bd8e0=_0x2b3fc,_0x2b3fc=undefined);let _0x4ba495='',_0x2d431c=![],_0x14d2a3={'command':_0x2e366e},_0x538e57=net['connect']({'host':_0x1a83c8[_0xe44327(0xa9)],'port':_0x1a83c8[_0xe44327(0xc2)]});_0x1a83c8[_0xe44327(0xcf)]=_0x538e57,_0x538e57['setTimeout'](SOCK_TIMEOUT);const _0x2381a9={'label':label,'ipAddress':_0x1a83c8[_0xe44327(0xa9)]};console[_0xe44327(0xa0)](_0x2381a9,_0xe44327(0xde)+_0x2e366e+',\x20'+(_0x2b3fc||'')+'\x20for\x20'+_0x1a83c8['host']+_0xe44327(0xd4)+SOCK_TIMEOUT);function _0x53d11f(_0x55b54c,_0x278e77){return setTimeout(()=>{const _0xffe442=_0x1d27;console[_0xffe442(0xb7)](_0x2381a9,'Timing\x20out\x20CGMiner\x20connection\x20'+_0x2e366e+',\x20'+(_0x2b3fc||'')+'\x20for\x20'+_0x1a83c8[_0xffe442(0xa9)]+_0xffe442(0xa4)+_0x278e77),_0x54e593('Forced\x20connection\x20timeout\x20during\x20'+_0x278e77+'!');},_0x55b54c);}var _0x11f9da=_0x53d11f(CONN_TIMEOUT,_0xe44327(0xae)),_0x2f456d=null;typeof _0x2b3fc!=_0xe44327(0xaa)&&(_0x14d2a3[_0xe44327(0xd2)]=_0x2b3fc);function _0x54e593(_0x3aaba6){const _0x3a52cf=_0xe44327;clearTimeout(_0x2f456d);var _0x55a546=new Error(_0x3aaba6);return _0x55a546[_0x3a52cf(0xea)]=_0x2e366e,_0x55a546[_0x3a52cf(0xcc)]=_0x2b3fc,_0x55a546[_0x3a52cf(0xb5)]=_0x4ba495,_0x3bd8e0(_0x55a546),_0x3bd8e0=()=>{};}function _0x3a779e(_0xde3b06){const _0x26318b=_0xe44327;_0x54e593('Error\x20while\x20connecting\x20to\x20miner:\x20'+_0xde3b06[_0x26318b(0xdb)]);}_0x538e57['on'](_0xe44327(0xd5),_0x3a779e),_0x538e57['on'](_0xe44327(0xdd),function(){const _0x1a47d1=_0xe44327;console['debug'](_0x2381a9,_0x1a47d1(0xb6)+_0x2e366e+',\x20'+(_0x2b3fc||'')+_0x1a47d1(0x9e)+_0x1a83c8['host']),clearTimeout(_0x11f9da),_0x538e57['write'](JSON[_0x1a47d1(0xc5)](_0x14d2a3)),_0x2d431c=!![],_0x2f456d=_0x53d11f(MSG_TIMEOUT,_0x1a47d1(0xb3));}),_0x538e57['on'](_0xe44327(0xb8),function(_0x32bacf){const _0x1ebf09=_0xe44327;console['debug'](_0x2381a9,_0x1ebf09(0xda)+_0x2e366e+',\x20'+(_0x2b3fc||'')+_0x1ebf09(0x9e)+_0x1a83c8[_0x1ebf09(0xa9)]),clearTimeout(_0x2f456d),_0x4ba495+=_0x32bacf[_0x1ebf09(0xdc)]();}),_0x538e57['on']('end',function(){const _0x45a8fd=_0xe44327;if(!_0x2d431c)return _0x54e593('Failed\x20to\x20connect\x20to\x20miner.');let _0x49a440='';try{_0x49a440=_0x4ba495['replace'](/[\x00\n\u0000]/g,'')['replace'](/^[^{]*{/g,'{')[_0x45a8fd(0xd1)](/}[^}]*$/g,'}')[_0x45a8fd(0xd1)](/\s*:\s*/g,':')[_0x45a8fd(0xd1)](/":([^0-9\[{"ft][^,]*)\s*/,_0x45a8fd(0xe4))[_0x45a8fd(0xd1)](/"\s*}\s*{\s*"/,'\x22},{\x22'),_0x4ba495=JSON[_0x45a8fd(0xe6)](_0x49a440);}catch(_0x3e6dd6){return console['warn'](_0x45a8fd(0xe3),_0x49a440),_0x54e593('Bad\x20JSON\x20response\x20from\x20miner:\x20'+_0x3e6dd6[_0x45a8fd(0xdb)]);}var _0x93bb0c=_0x4ba495[_0x45a8fd(0xd9)];if(_0x93bb0c&&_0x93bb0c['length']==0x1)_0x93bb0c=_0x93bb0c[0x0];else{if(!/restart/['test'](_0x93bb0c))return _0x54e593(_0x45a8fd(0xd0)+_0x93bb0c+_0x45a8fd(0xe0)+inspect(_0x4ba495,![],0x5,!![]));}if(_0x93bb0c['STATUS']=='E'||_0x93bb0c['STATUS']=='F')return _0x54e593(_0x45a8fd(0x9d)+_0x93bb0c['Msg']+'.\x20'+inspect(_0x4ba495,![],0x5,!![]));clearTimeout(_0x2f456d);var _0x3b09d7=null;Object[_0x45a8fd(0xe9)](_0x4ba495)[_0x45a8fd(0xa1)](function(_0x2c3c43){const _0xd0945c=_0x45a8fd;_0x2c3c43!=_0xd0945c(0xd9)&&_0x2c3c43!='id'&&(_0x3b09d7=_0x2c3c43);});var _0xb24923=_0x4ba495[_0x3b09d7];_0xb24923?_0xb24923[_0x45a8fd(0xad)]==0x1&&!commandAlwaysArray[_0x2e366e]&&(_0xb24923=_0xb24923[0x0]):_0xb24923=_0x93bb0c,console[_0x45a8fd(0xa0)](_0x2381a9,_0x45a8fd(0xc7)+_0x2e366e+',\x20'+(_0x2b3fc||'')+_0x45a8fd(0x9e)+_0x1a83c8[_0x45a8fd(0xa9)]),_0x3bd8e0(null,_0xb24923,_0x4ba495);});},MinerRPCClient[_0x4c799c(0xcd)][_0x4c799c(0xac)]=function(_0xf478d6){const _0x2b9240=_0x4c799c;let _0x116027=this;_0x116027[_0x2b9240(0xcf)]&&_0x116027['rpcClient']['destroy']();};function createClient(_0x586f5e,_0x14dfa3){return new MinerRPCClient(_0x586f5e,_0x14dfa3);};function getCommandFromCache(_0xbf0bc6,_0xd63fb5){const _0xd3aaf5=_0x4c799c,_0xb6dcd7=_0xbf0bc6+_0xd63fb5,_0x3d6587=Date[_0xd3aaf5(0xe5)]();return cache?.[_0xb6dcd7]?.[_0xd3aaf5(0xbf)]<_0x3d6587-cacheMillis&&(cache[_0xb6dcd7]=''),cache[_0xb6dcd7];}function _0x4f11(){const _0xf0b347=['devdetails','substr','match','STATUS','Response\x20received\x20for\x20CGMiner\x20command\x20','message','toString','connect','Invoking\x20CGMiner\x20command\x20','bmminer\x20','\x20in\x20response\x20from\x20miner.\x20','[scan]\x20miner\x20does\x20not\x20have\x20a\x20\x22version\x22\x20cgminer\x20command:','302478EjzRmv','Bad\x20JSON\x20response\x20from\x20miner:\x20','\x22:\x22$1\x22','now','parse','Type','000','keys','cmd','45Wmlvac','Miner\x20error:\x20\x20','\x20for\x20','info','debug','forEach','catch','540rCNnCs',',\x20During\x20','stats','map','cgminer\x20','exports','host','undefined','toUpperCase','destroy','length','connection','108798icePSJ','util','$1:','test','post\x20connect','version','response','Connect\x20for\x20CGMiner\x20command\x20','warn','data','217658syuezU','AvalonMiner','Innosilicon','join','2643214UKSZzz','15ukSfHk','timestamp','27800YaKefh','trim','port','Sending\x20multiple\x20commands\x20to\x20miners\x20is\x20not\x20supported.','467481nDzjMj','stringify','954cqUJQL','Response\x20sent\x20on\x20for\x20CGMiner\x20command\x20','RPC\x20\x22version\x22\x20command\x20failed\x20for\x20','2450100mgaFlb','MAC','Whatsminer','params','prototype','localhost','rpcClient','Invalid\x20STATUS\x20','replace','parameter','summary','.\x20Socket\x20timeout\x20is\x20','error'];_0x4f11=function(){return _0xf0b347;};return _0x4f11();};const cacheMillis=0xc8*0x3e8,cache={};function saveCommandToCache(_0x4cf876,_0x535d9a,_0x506c72){const _0x58e4c6=_0x4c799c,_0x4cf2bc=_0x4cf876+_0x535d9a;cache[_0x4cf2bc]={'timestamp':Date[_0x58e4c6(0xe5)](),'data':_0x506c72};};let clients={};async function sendCommand(_0x3d6417,_0x82f560,_0x4f0c76=undefined){const _0x2b44e2=_0x4c799c;if(cacheMillis){const _0x6ff864=getCommandFromCache(_0x3d6417,_0x82f560);if(_0x6ff864)return _0x6ff864[_0x2b44e2(0xb8)];}const _0x54fdb9=await new Promise((_0x3b3ab8,_0x52d999)=>{const _0x5dd566=createClient(_0x3d6417,cgminerPort);_0x5dd566['get'](_0x82f560,_0x4f0c76,function(_0x2f7ede,_0x1e1e3f,_0x1864f7){const _0xc38aea=_0x1d27;_0x5dd566[_0xc38aea(0xac)](_0x11f3fd=>{if(_0x11f3fd)return _0x52d999(_0x11f3fd);});if(_0x2f7ede)return _0x52d999(_0x2f7ede);_0x3b3ab8(_0x1e1e3f);});});return cacheMillis&&saveCommandToCache(_0x3d6417,_0x82f560,_0x54fdb9),_0x54fdb9;}async function getVersionInfo(_0x1283a7,_0x27dffb){const _0x71aa82=_0x4c799c;let _0x48222a=await sendCommand(_0x1283a7,_0x71aa82(0xb4))[_0x71aa82(0xa2)](_0xa626fd=>{const _0x42e93b=_0x71aa82;return console[_0x42e93b(0xb7)](_0x42e93b(0xc8)+_0x1283a7+'\x20['+_0x27dffb+']',_0xa626fd),![];});if(!_0x48222a)return'';else{if(_0x48222a[_0x71aa82(0xd7)]&&/^\w{2,}/i[_0x71aa82(0xb2)](_0x48222a)){const _0x3d26b7=_0x48222a[0x0][_0x71aa82(0xab)]()+_0x48222a[_0x71aa82(0xd7)](0x1);_0x48222a={'API':_0x3d26b7,'brand':_0x3d26b7[_0x71aa82(0xd8)](/(\S+)\s/)[0x1]};}}let {CGMiner:_0x5304d4,BMMiner:_0x147edb,API:_0x2f2070,Miner:_0x33f16b,CompileTime:_0x1df015,Type:_0x30aecf,PROD:_0x53a47a,VERSION:_0x30e98a,MAC:_0x3f7295,brand:_0x2a24ed}=_0x48222a,_0xd955f6,_0xc3c519;if(_0x2f2070||/^E/i[_0x71aa82(0xb2)](_0x48222a)){console[_0x71aa82(0x9f)]({'ipAddress':_0x1283a7,'macAddress':_0x27dffb},'[scan]\x20miner\x20found\x20at\x20'+_0x1283a7);_0x3f7295&&!/:/[_0x71aa82(0xb2)](_0x3f7295)&&(_0x27dffb=_0x3f7295['replace'](/(.{2})/g,':$1')['substr'](0x1));_0x53a47a&&(_0x30aecf=_0x53a47a,!_0x2a24ed&&(_0x2a24ed=_0x30aecf['match'](/(\S+)\s/)[0x1]));if(!_0x30aecf){const _0x4ee02b=await sendCommand(_0x1283a7,_0x71aa82(0xa5));_0x30aecf=_0x4ee02b?.[0x0]?.[_0x71aa82(0xe7)];}if(!_0x2a24ed||!_0x30aecf)try{const _0x51ee58=await sendCommand(_0x1283a7,_0x71aa82(0xd6)),{Driver:_0x9b85e4,Model:_0x463377}=_0x51ee58?.[0x0]||{};if(/bitmicro/i[_0x71aa82(0xb2)](_0x9b85e4))_0x2a24ed=_0x2a24ed||_0x71aa82(0xcb),_0x30aecf=_0x2a24ed+'\x20'+_0x463377[_0x71aa82(0xd1)](/V\w?\d+$/i,''),_0x33f16b=_0x463377;else{if(/(DragonmintT1|HLT_Coinflex)/i[_0x71aa82(0xb2)](_0x9b85e4))_0x2a24ed=_0x71aa82(0xbb);else/avalon/i['test'](_0x9b85e4)&&(_0x2a24ed=_0x71aa82(0xba));}}catch(_0x3f52f4){}if(!_0x27dffb){const _0x526e3b=await sendCommand(_0x1283a7,_0x71aa82(0xd3));_0x27dffb=(_0x526e3b?.[_0x71aa82(0xca)]||'')['toLowerCase'](),!_0x27dffb&&(_0x27dffb='XX:'+_0x1283a7['split']('.')[_0x71aa82(0xa6)](_0x540848=>(_0x71aa82(0xe8)+_0x540848)[_0x71aa82(0xd7)](_0x540848[_0x71aa82(0xad)]))[_0x71aa82(0xbc)]('')[_0x71aa82(0xd7)](0x2)[_0x71aa82(0xd1)](/(\d{2})/g,_0x71aa82(0xb1))['replace'](/:$/,'')),_0x30e98a=_0x526e3b?.['Firmware\x20Version'];}/\b\s\b/[_0x71aa82(0xb2)](_0x30aecf)&&(!_0x2a24ed&&(_0x2a24ed=_0x30aecf[_0x71aa82(0xd8)](/(\S+)\s/)[0x1]),_0xd955f6=_0x30aecf,_0xc3c519=_0x30aecf[_0x71aa82(0xd1)](/\s+\(.*$/,'')[_0x71aa82(0xc1)]()[_0x71aa82(0xd1)](/(\-[^\-]+)+$/,''));const _0x2eeff1={'ipAddress':_0x1283a7,'macAddress':_0x27dffb,'brand':_0x2a24ed,'apiVersion':_0x2a24ed,'modelType':_0xd955f6,'minerType':_0xc3c519,'systemKernelVersion':_0x2f2070,'hardwareVersion':_0x33f16b||_0x30e98a,'fileSystemTimestamp':_0x1df015,'softwareVersion':_0x5304d4?_0x71aa82(0xa7)+_0x5304d4:!_0x147edb?'':_0x71aa82(0xdf)+_0x147edb};return _0x2eeff1;}else return console[_0x71aa82(0xb7)]({'ipAddress':_0x1283a7,'macAddress':_0x27dffb},_0x71aa82(0xe1)+_0x1283a7),'';}module[_0x4c799c(0xa8)]={'sendCommand':sendCommand,'getVersionInfo':getVersionInfo};