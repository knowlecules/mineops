/* Copyright (C) 9208-9721 Quebec, Inc - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
* Written by Jason Rudland <jason.g.rudland@gmail.com>, September 2022
*/'use strict';const _0x4811e8=_0x43f3;(function(_0x5be27b,_0x2bf061){const _0xd4857a=_0x43f3,_0x4ff557=_0x5be27b();while(!![]){try{const _0x114b5a=-parseInt(_0xd4857a(0x224))/0x1+-parseInt(_0xd4857a(0x227))/0x2+parseInt(_0xd4857a(0x22c))/0x3*(parseInt(_0xd4857a(0x20f))/0x4)+parseInt(_0xd4857a(0x219))/0x5*(-parseInt(_0xd4857a(0x200))/0x6)+parseInt(_0xd4857a(0x1fe))/0x7*(-parseInt(_0xd4857a(0x1ec))/0x8)+-parseInt(_0xd4857a(0x21a))/0x9*(parseInt(_0xd4857a(0x213))/0xa)+-parseInt(_0xd4857a(0x209))/0xb*(-parseInt(_0xd4857a(0x1fc))/0xc);if(_0x114b5a===_0x2bf061)break;else _0x4ff557['push'](_0x4ff557['shift']());}catch(_0x3a177a){_0x4ff557['push'](_0x4ff557['shift']());}}}(_0x3d5f,0x3d51f));function _0x43f3(_0x1bfaa7,_0x3ef5c4){const _0x3d5f70=_0x3d5f();return _0x43f3=function(_0x43f3cf,_0x29e2de){_0x43f3cf=_0x43f3cf-0x1ea;let _0x58c9fb=_0x3d5f70[_0x43f3cf];return _0x58c9fb;},_0x43f3(_0x1bfaa7,_0x3ef5c4);}const net=require(_0x4811e8(0x21b)),{inspect}=require(_0x4811e8(0x202)),cgminerPort=0xfbc,CONN_TIMEOUT=0xbb8,SOCK_TIMEOUT=0xfa0,MSG_TIMEOUT=0x1f40,label=_0x4811e8(0x236),commandAlwaysArray={'pools':!![],'devs':!![],'edevs':!![],'procs':!![],'notify':!![],'devdetails':!![],'stats':!![],'estats':!![]};function MinerRPCClient(_0x46ecb3,_0x3eb2d9){const _0x131e7d=_0x4811e8;let _0xe33771=this;_0xe33771[_0x131e7d(0x22b)]=_0x46ecb3||_0x131e7d(0x238),_0xe33771[_0x131e7d(0x23e)]=_0x3eb2d9||cgminerPort;}MinerRPCClient[_0x4811e8(0x1ed)]['get']=function(_0x189042,_0x4c6602,_0x43ddc0){const _0x1b768a=_0x4811e8;let _0x487e7d=this;if(/\+/[_0x1b768a(0x208)](_0x189042))return _0x43ddc0(new Error(_0x1b768a(0x21f)));typeof _0x4c6602==_0x1b768a(0x239)&&(_0x43ddc0=_0x4c6602,_0x4c6602=undefined);let _0x46a7c6='',_0xba847f=![],_0x208a6d={'command':_0x189042},_0x261525=net['connect']({'host':_0x487e7d['host'],'port':_0x487e7d['port']});_0x487e7d[_0x1b768a(0x1f4)]=_0x261525,_0x261525['setTimeout'](SOCK_TIMEOUT);const _0x4e3c0a={'label':label,'ipAddress':_0x487e7d[_0x1b768a(0x22b)]};console[_0x1b768a(0x1f2)](_0x4e3c0a,_0x1b768a(0x20d)+_0x189042+',\x20'+(_0x4c6602||'')+_0x1b768a(0x1f9)+_0x487e7d[_0x1b768a(0x22b)]+_0x1b768a(0x1f3)+SOCK_TIMEOUT);function _0x28d717(_0x4b6a3c,_0x3d7e53){return setTimeout(()=>{const _0x473790=_0x43f3;console[_0x473790(0x215)](_0x4e3c0a,_0x473790(0x233)+_0x189042+',\x20'+(_0x4c6602||'')+_0x473790(0x1f9)+_0x487e7d[_0x473790(0x22b)]+',\x20During\x20'+_0x3d7e53),_0x24c350(_0x473790(0x1f5)+_0x3d7e53+'!');},_0x4b6a3c);}var _0x132f9e=_0x28d717(CONN_TIMEOUT,'connection'),_0xe80421=null;typeof _0x4c6602!=_0x1b768a(0x203)&&(_0x208a6d[_0x1b768a(0x204)]=_0x4c6602);function _0x24c350(_0x53184c){const _0x399d69=_0x1b768a;clearTimeout(_0xe80421);var _0x397720=new Error(_0x53184c);return _0x397720[_0x399d69(0x22e)]=_0x189042,_0x397720[_0x399d69(0x20b)]=_0x4c6602,_0x397720[_0x399d69(0x212)]=_0x46a7c6,_0x43ddc0(_0x397720),_0x43ddc0=()=>{};}function _0x4656d4(_0x1e2800){const _0x4d3530=_0x1b768a;_0x24c350('Error\x20while\x20connecting\x20to\x20miner:\x20'+_0x1e2800[_0x4d3530(0x230)]);}_0x261525['on'](_0x1b768a(0x20e),_0x4656d4),_0x261525['on'](_0x1b768a(0x20a),function(){const _0x5bba3a=_0x1b768a;console[_0x5bba3a(0x1f2)](_0x4e3c0a,_0x5bba3a(0x1ff)+_0x189042+',\x20'+(_0x4c6602||'')+_0x5bba3a(0x1f9)+_0x487e7d[_0x5bba3a(0x22b)]),clearTimeout(_0x132f9e),_0x261525['write'](JSON[_0x5bba3a(0x1eb)](_0x208a6d)),_0xba847f=!![],_0xe80421=_0x28d717(MSG_TIMEOUT,_0x5bba3a(0x1fa));}),_0x261525['on']('data',function(_0x1cf969){const _0x306422=_0x1b768a;console[_0x306422(0x1f2)](_0x4e3c0a,_0x306422(0x21d)+_0x189042+',\x20'+(_0x4c6602||'')+_0x306422(0x1f9)+_0x487e7d[_0x306422(0x22b)]),clearTimeout(_0xe80421),_0x46a7c6+=_0x1cf969[_0x306422(0x206)]();}),_0x261525['on'](_0x1b768a(0x231),function(){const _0x437c3e=_0x1b768a;if(!_0xba847f)return _0x24c350(_0x437c3e(0x201));let _0x6a020c='';try{_0x6a020c=_0x46a7c6['replace'](/[\x00\n\u0000]/g,'')[_0x437c3e(0x222)](/^[^{]*{/g,'{')[_0x437c3e(0x222)](/}[^}]*$/g,'}')[_0x437c3e(0x222)](/\s*:\s*/g,':')[_0x437c3e(0x222)](/":([^0-9\[{"ft][^,]*)\s*/,'\x22:\x22$1\x22')[_0x437c3e(0x222)](/"\s*}\s*{\s*"/,_0x437c3e(0x1f6)),_0x46a7c6=JSON[_0x437c3e(0x21c)](_0x6a020c);}catch(_0x3cc2fe){return console[_0x437c3e(0x215)](_0x437c3e(0x1fb),_0x6a020c),_0x24c350('Bad\x20JSON\x20response\x20from\x20miner:\x20'+_0x3cc2fe['message']);}var _0x52a76d=_0x46a7c6[_0x437c3e(0x234)];if(_0x52a76d&&_0x52a76d[_0x437c3e(0x23c)]==0x1)_0x52a76d=_0x52a76d[0x0];else{if(!/restart/[_0x437c3e(0x208)](_0x52a76d))return _0x24c350(_0x437c3e(0x218)+_0x52a76d+_0x437c3e(0x1f7)+inspect(_0x46a7c6,![],0x5,!![]));}if(_0x52a76d[_0x437c3e(0x234)]=='E'||_0x52a76d[_0x437c3e(0x234)]=='F')return _0x24c350(_0x437c3e(0x1f1)+_0x52a76d['Msg']+'.\x20'+inspect(_0x46a7c6,![],0x5,!![]));clearTimeout(_0xe80421);var _0x1145f8=null;Object['keys'](_0x46a7c6)['forEach'](function(_0x4e426a){const _0x21639a=_0x437c3e;_0x4e426a!=_0x21639a(0x234)&&_0x4e426a!='id'&&(_0x1145f8=_0x4e426a);});var _0x20cd70=_0x46a7c6[_0x1145f8];_0x20cd70?_0x20cd70[_0x437c3e(0x23c)]==0x1&&!commandAlwaysArray[_0x189042]&&(_0x20cd70=_0x20cd70[0x0]):_0x20cd70=_0x52a76d,console[_0x437c3e(0x1f2)](_0x4e3c0a,'Response\x20sent\x20on\x20for\x20CGMiner\x20command\x20'+_0x189042+',\x20'+(_0x4c6602||'')+_0x437c3e(0x1f9)+_0x487e7d['host']),_0x43ddc0(null,_0x20cd70,_0x46a7c6);});},MinerRPCClient['prototype'][_0x4811e8(0x23a)]=function(_0x1a7cb9){const _0x52f4e0=_0x4811e8;let _0x5a7627=this;_0x5a7627[_0x52f4e0(0x1f4)]&&_0x5a7627[_0x52f4e0(0x1f4)][_0x52f4e0(0x23a)]();};function createClient(_0x2beade,_0x44b2e1){return new MinerRPCClient(_0x2beade,_0x44b2e1);};function getCommandFromCache(_0x2fb27c,_0x1bd4df){const _0x366427=_0x4811e8,_0x5200ef=_0x2fb27c+_0x1bd4df,_0x5b8e4a=Date[_0x366427(0x229)]();return cache?.[_0x5200ef]?.[_0x366427(0x1f8)]<_0x5b8e4a-cacheMillis&&(cache[_0x5200ef]=''),cache[_0x5200ef];};const cacheMillis=0xc8*0x3e8,cache={};function saveCommandToCache(_0x63edb2,_0x4b8d92,_0x3254dc){const _0x46f607=_0x4811e8,_0xd2a187=_0x63edb2+_0x4b8d92;cache[_0xd2a187]={'timestamp':Date[_0x46f607(0x229)](),'data':_0x3254dc};};let clients={};async function sendCommand(_0x55413a,_0x57b60e,_0x4e7fdb=undefined){const _0x59b58d=_0x4811e8;if(cacheMillis){const _0x3d2c3b=getCommandFromCache(_0x55413a,_0x57b60e);if(_0x3d2c3b)return _0x3d2c3b[_0x59b58d(0x225)];}const _0x31b42b=await new Promise((_0x29c511,_0x5a4e93)=>{const _0x4c6c8a=_0x59b58d,_0x36d247=createClient(_0x55413a,cgminerPort);_0x36d247[_0x4c6c8a(0x237)](_0x57b60e,_0x4e7fdb,function(_0x349c92,_0xb5f735,_0x56d94d){_0x36d247['destroy'](_0x53ee10=>{if(_0x53ee10)return _0x5a4e93(_0x53ee10);});if(_0x349c92)return _0x5a4e93(_0x349c92);_0x29c511(_0xb5f735);});});return cacheMillis&&saveCommandToCache(_0x55413a,_0x57b60e,_0x31b42b),_0x31b42b;}async function getVersionInfo(_0x140b3d,_0x4d79f8){const _0x3d8b08=_0x4811e8;let _0x52b53f=await sendCommand(_0x140b3d,_0x3d8b08(0x22f))[_0x3d8b08(0x21e)](_0x5b4753=>{const _0x2487de=_0x3d8b08;return console[_0x2487de(0x215)](_0x2487de(0x207)+_0x140b3d+'\x20['+_0x4d79f8+']',_0x5b4753),![];});if(!_0x52b53f)return'';else{if(_0x52b53f[_0x3d8b08(0x211)]&&/^\w{2,}/i['test'](_0x52b53f)){const _0x3afe07=_0x52b53f[0x0][_0x3d8b08(0x22a)]()+_0x52b53f[_0x3d8b08(0x211)](0x1);_0x52b53f={'API':_0x3afe07,'brand':_0x3afe07[_0x3d8b08(0x1fd)](/(\S+)\s/)[0x1]};}}let {CGMiner:_0x69a899,BMMiner:_0x1b1fa0,API:_0x3bf3e6,Miner:_0x77327e,CompileTime:_0x329932,Type:_0x494e0e,PROD:_0xf5b90a,VERSION:_0x50dbea,MAC:_0x47711c,brand:_0x331129}=_0x52b53f,_0x534e5b,_0x2b8388;if(_0x3bf3e6||/^E/i[_0x3d8b08(0x208)](_0x52b53f)){console[_0x3d8b08(0x221)]({'ipAddress':_0x140b3d,'macAddress':_0x4d79f8},_0x3d8b08(0x1ea)+_0x140b3d);_0x47711c&&!/:/[_0x3d8b08(0x208)](_0x47711c)&&(_0x4d79f8=_0x47711c['replace'](/(.{2})/g,_0x3d8b08(0x214))['substr'](0x1));_0xf5b90a&&(_0x494e0e=_0xf5b90a,!_0x331129&&(_0x331129=_0x494e0e[_0x3d8b08(0x1fd)](/(\S+)\s/)[0x1]));if(!_0x494e0e){const _0x7ad007=await sendCommand(_0x140b3d,_0x3d8b08(0x23d));_0x494e0e=_0x7ad007?.[0x0]?.[_0x3d8b08(0x1ef)];}if(!_0x331129||!_0x494e0e)try{const _0x204229=await sendCommand(_0x140b3d,_0x3d8b08(0x217)),{Driver:_0x58b496,Model:_0x13e419}=_0x204229?.[0x0]||{};if(/bitmicro/i[_0x3d8b08(0x208)](_0x58b496))_0x331129=_0x331129||'Whatsminer',_0x494e0e=_0x331129+'\x20'+_0x13e419[_0x3d8b08(0x222)](/V\w?\d+$/i,''),_0x77327e=_0x13e419;else{if(/(DragonmintT1|HLT_Coinflex)/i[_0x3d8b08(0x208)](_0x58b496))_0x331129=_0x3d8b08(0x210);else/avalon/i[_0x3d8b08(0x208)](_0x58b496)&&(_0x331129=_0x3d8b08(0x226));}}catch(_0x30f557){}if(!_0x4d79f8){const _0x585697=await sendCommand(_0x140b3d,_0x3d8b08(0x1f0));_0x4d79f8=(_0x585697?.[_0x3d8b08(0x216)]||'')[_0x3d8b08(0x205)](),!_0x4d79f8&&(_0x4d79f8=_0x3d8b08(0x223)+_0x140b3d[_0x3d8b08(0x228)]('.')[_0x3d8b08(0x1ee)](_0xd22ed4=>(_0x3d8b08(0x22d)+_0xd22ed4)[_0x3d8b08(0x211)](_0xd22ed4[_0x3d8b08(0x23c)]))[_0x3d8b08(0x23f)]('')[_0x3d8b08(0x211)](0x2)['replace'](/(\d{2})/g,'$1:')[_0x3d8b08(0x222)](/:$/,'')),_0x50dbea=_0x585697?.['Firmware\x20Version'];}/\b\s\b/[_0x3d8b08(0x208)](_0x494e0e)&&(!_0x331129&&(_0x331129=_0x494e0e[_0x3d8b08(0x1fd)](/(\S+)\s/)[0x1]),_0x534e5b=_0x494e0e,_0x2b8388=_0x494e0e['replace'](/\s+\(.*$/,'')[_0x3d8b08(0x20c)]()[_0x3d8b08(0x222)](/(\-[^\-]+)+$/,''));const _0x1f236d={'ipAddress':_0x140b3d,'macAddress':_0x4d79f8,'brand':_0x331129,'apiVersion':_0x331129,'modelType':_0x534e5b,'minerType':_0x2b8388,'systemKernelVersion':_0x3bf3e6,'hardwareVersion':_0x77327e||_0x50dbea,'fileSystemTimestamp':_0x329932,'softwareVersion':_0x69a899?_0x3d8b08(0x232)+_0x69a899:!_0x1b1fa0?'':_0x3d8b08(0x23b)+_0x1b1fa0};return _0x1f236d;}else return console[_0x3d8b08(0x215)]({'ipAddress':_0x140b3d,'macAddress':_0x4d79f8},_0x3d8b08(0x235)+_0x140b3d),'';}module[_0x4811e8(0x220)]={'sendCommand':sendCommand,'getVersionInfo':getVersionInfo};function _0x3d5f(){const _0x1cdc76=['toUpperCase','host','129NTBOTJ','000','cmd','version','message','end','cgminer\x20','Timing\x20out\x20CGMiner\x20connection\x20','STATUS','[scan]\x20miner\x20does\x20not\x20have\x20a\x20\x22version\x22\x20cgminer\x20command:','cgminer-api','get','localhost','function','destroy','bmminer\x20','length','stats','port','join','[scan]\x20miner\x20found\x20at\x20','stringify','1196344UtKGvn','prototype','map','Type','summary','Miner\x20error:\x20\x20','debug','.\x20Socket\x20timeout\x20is\x20','rpcClient','Forced\x20connection\x20timeout\x20during\x20','\x22},{\x22','\x20in\x20response\x20from\x20miner.\x20','timestamp','\x20for\x20','post\x20connect','Bad\x20JSON\x20response\x20from\x20miner:\x20','24UTXsEw','match','14LFbeuc','Connect\x20for\x20CGMiner\x20command\x20','117186UCWQto','Failed\x20to\x20connect\x20to\x20miner.','util','undefined','parameter','toLowerCase','toString','RPC\x20\x22version\x22\x20command\x20failed\x20for\x20','test','8020529UNvQfn','connect','params','trim','Invoking\x20CGMiner\x20command\x20','error','25140nCInlP','Innosilicon','substr','response','140LUKlzO',':$1','warn','MAC','devdetails','Invalid\x20STATUS\x20','5XQibeM','242325OrWUHE','net','parse','Response\x20received\x20for\x20CGMiner\x20command\x20','catch','Sending\x20multiple\x20commands\x20to\x20miners\x20is\x20not\x20supported.','exports','info','replace','XX:','383398MdXcAT','data','AvalonMiner','796802unhMyS','split','now'];_0x3d5f=function(){return _0x1cdc76;};return _0x3d5f();}